"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[62566],{62566:(ot,g,n)=>{n.r(g),n.d(g,{NotificationCategoriesModule:()=>nt});var p=n(26575),T=n(31610),l=n(51273),m=n(23420),f=n(35461),u=n(85054);const S=[{type:"buttons",fixed:!0,buttons:[{name:"save",template:"grid-save-button"},{name:"edit",template:"grid-edit-button"},{name:"delete",template:"grid-delete-button"},{name:"cancel",template:"grid-cancel-button"}]},{dataField:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string"},{dataField:"SpecifiedTenantId",caption:"\u6307\u5b9a\u79df\u6236",dataType:"string",visible:!1},{dataField:"id",visible:!1},{dataField:"idCode",caption:"idCode",dataType:"string",filterOperations:f.I$.text,validationRules:[u.L]},{dataField:"name",caption:"\u901a\u77e5\u5206\u985e\u540d\u7a31",dataType:"string",filterOperations:f.I$.text,validationRules:[u.L]},{dataField:"sortingNumber",caption:"\u6392\u5e8f",dataType:"number",visible:!1},{dataField:"concurrencyStamp",visible:!1},{dataField:"parentNotificationCategoryId",caption:"",dataType:"string",visible:!1}],C={index:"/api/app/notification-categories",get:"/api/app/notification-categories",create:"/api/app/notification-categories",update:"/api/app/notification-categories",delete:"/api/app/notification-categories"},I=[{dataField:"SpecifiedTenantId",path:"/api/app/jbnotifier-admin/customized-users/tenant-lookup",pathForSelectedDisplay:"/api/app/jbnotifier-admin/customized-tenants"}],h=[{dataField:"id",mapping:["notificationCategory","id"]},{dataField:"concurrencyStamp",mapping:["concurrencyStamp"]},{dataField:"tenantId",queryStringKey:"TenantId",mapping:["tenantId"]},{name:"tenantCode",queryStringKey:"TenantId",mapping:["tenant"]},{name:"tenantName",queryStringKey:"TenantId",mapping:["tenant","name"]},{dataField:"parentNotificationCategoryId",queryStringKey:"ParentNotificationCategoryId",mapping:["parentNotificationCategoryId"]},{name:"parentNotificationCategoryCode",queryStringKey:"ParentNotificationCategoryId",mapping:["parentNotificationCategory"]},{name:"parentNotificationCategoryName",queryStringKey:"ParentNotificationCategoryId",mapping:["parentNotificationCategory"]},{dataField:"name",queryStringKey:"Name",mapping:["notificationCategory","name"]},{dataField:"idCode",queryStringKey:"IdCode",mapping:["notificationCategory","idCode"]},{dataField:"sortingNumber",mapping:["notificationCategory","sortingNumber"]},{dataField:"SpecifiedTenantId",mapping:["tenant","id"]}],w={popup:{title:"JbNotifier::Permission:NotificationCategories",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"SpecifiedTenantId",editorType:"dxSelectBox"},{dataField:"idCode",editorType:"dxTextBox"},{dataField:"name",editorType:"dxTextBox"},{dataField:"sortingNumber",editorType:"dxNumberBox",editorOptions:{min:1}}],elementAttr:{class:"custom-form custom-form--edit"}}},F={popup:{title:"JbNotifier::Permission:NotificationCategories",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"SpecifiedTenantId",editorType:"dxSelectBox",editorOptions:{disabled:!0}},{dataField:"idCode",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"name",editorType:"dxTextBox"},{dataField:"sortingNumber",editorType:"dxNumberBox",editorOptions:{min:1}}],elementAttr:{class:"custom-form custom-form--edit"}}},b=[];var t=n(29039),_=n(33854),P=n(72783),M=n(59444),D=n(21194),R=n(67846),O=n(13443),V=n(65343),A=n(5476),J=n(92931),E=n(10313),K=n(64766),v=n(14932),Q=n(65787),Z=n(90070),B=n(88912),y=n(12305),G=n(11423),U=n(20285);const L=["grid"],Y=["treeview"];function $(o,c){1&o&&t.GkF(0)}const k=o=>({$implicit:o});function W(o,c){if(1&o&&(t.ynx(0),t.YNc(1,$,1,0,"ng-container",17),t.BQk()),2&o){const e=c.$implicit,a=t.oxw().$implicit,i=t.oxw();t.xp6(),t.Q6J("ngTemplateOutlet",i.templateStore.getGridTemplates(a.key))("ngTemplateOutletContext",t.VKq(2,k,e))}}function z(o,c){if(1&o&&(t.ynx(0),t.YNc(1,W,2,4,"ng-container",16),t.BQk()),2&o){const e=c.$implicit;t.xp6(),t.Q6J("dxTemplateOf",e.key)}}function j(o,c){if(1&o&&(t.TgZ(0,"div"),t._UZ(1,"app-bottom-toolbar-btns",12),t.qZA()),2&o){t.oxw();const e=t.MAs(16);t.xp6(),t.Q6J("grid",e)}}const H=o=>({of:o}),X=()=>({class:"custom-tree-view"}),q=[{path:"",component:(()=>{class o{constructor(e,a,i,s,r){this.gridDataSourceService=e,this.templateStore=a,this.restService=i,this.configStateService=s,this.tenantChooser=r,this.columns=S,this.cRUDEndpoints=C,this.dataFieldLookupSourceMapping=I,this.dataFieldTranslationKeysMapping=b,this.relatedDataValueAndQueryStringKeyMapping=h,this.editingPropertiesForCreating=w,this.editingPropertiesForUpdating=F,this.treeViewLoading=!1,this.gridProperties={toolbar:{visible:!1},height:0},this.treeViewDataSource=[],this.isNeedToScrollToItem=!1,this.setGridDataSource=d=>{this.gridDataSource=this.gridDataSourceService.getDataSource(C,h),this.gridDataSource.filter(["parentNotificationCategoryId","=",d])},this.configStateService.getOne$("currentUser").subscribe(d=>{d.tenantId&&(this.editingPropertiesForCreating.form.items[0].visible=!1,this.editingPropertiesForUpdating.form.items[0].visible=!1,this.columns[1].visible=!1)})}ngOnInit(){this.tenantChooser.tenantId$.subscribe(e=>{this.SpecifiedTenantId=e,this.setGridDataSource(),this.setTreeViewDataSource(e),this.SpecifiedTenantIdWhenEditingForCreate=null})}onInitNewRow(e){e.data.parentNotificationCategoryId=this.parentNotificationCategoryId}onEditorPreparing(e){"SpecifiedTenantId"!==e.dataField||"dataRow"!==e.parentType||"null"===this.SpecifiedTenantId&&"null"===this.SpecifiedTenantIdWhenEditingForCreate||this.SpecifiedTenantIdWhenEditingForCreate&&(e.editorOptions.disabled=!0,e.editorOptions.value=this.SpecifiedTenantIdWhenEditingForCreate,e.setValue(this.SpecifiedTenantIdWhenEditingForCreate))}onContentReady(){this.parentNotificationCategoryId&&this.isNeedToScrollToItem&&(this.treeview.instance.scrollToItem(this.parentNotificationCategoryId),this.isNeedToScrollToItem=!1)}onRowClick(e){if(e.event.target.classList.contains("dx-button-content"))return;const a=this.treeViewDataSource.find(i=>i.id===e.data.id);this.setGridDataSource(e.data.id),this.treeview.instance.expandItem(a),this.treeview.instance.selectItem(a),this.parentNotificationCategoryId=e.data.id,this.SpecifiedTenantIdWhenEditingForCreate=e.data.SpecifiedTenantId||"null",this.treeview.instance.scrollToItem(this.parentNotificationCategoryId)}onRowInserted(e){this.setTreeViewDataSource(this.SpecifiedTenantId,e.data.parentNotificationCategoryId),this.isNeedToScrollToItem=!0}onRowRemoved(e){this.treeViewDataSource=this.treeViewDataSource.filter(a=>a.id!==e.data.id),this.isNeedToScrollToItem=!0}setTreeViewDataSource(e,a){this.treeViewLoading=!0,this.restService.request({method:"GET",url:"/api/app/notification-categories/treeview",params:{SpecifiedTenantId:e}}).subscribe(i=>{const s=i.items.map(r=>({id:r.id,name:r.name,parentId:r.parentId||"notificationCategories",tenantId:r.tenantId||"null",selected:r.id===a,expanded:r.id===a}));this.treeViewDataSource=s,this.treeViewDataSource.unshift({id:"notificationCategories",name:"\u901a\u77e5\u5206\u985e",parentId:null,selected:!0,expanded:!0}),this.treeViewLoading=!1})}onTreeViewItemClick(e){this.setGridDataSource("notificationCategories"===e.itemData.id?null:e.itemData.id),this.treeview.instance.expandItem(e.itemData),this.treeview.instance.selectItem(e.itemData),this.parentNotificationCategoryId=e.itemData.id,this.SpecifiedTenantIdWhenEditingForCreate=e.node.itemData.tenantId}reloadTreeView(){this.setTreeViewDataSource(this.SpecifiedTenantId,this.parentNotificationCategoryId),this.isNeedToScrollToItem=!0}static#t=this.\u0275fac=function(a){return new(a||o)(t.Y36(_.I),t.Y36(P.z),t.Y36(l.vgb),t.Y36(l.XJE),t.Y36(M.L))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-notification-categories"]],viewQuery:function(a,i){if(1&a&&(t.Gf(L,5),t.Gf(Y,5)),2&a){let s;t.iGM(s=t.CRH())&&(i.grid=s.first),t.iGM(s=t.CRH())&&(i.treeview=s.first)}},decls:21,vars:29,consts:[[1,"notification-categories-container"],[1,"notification-categories"],[1,"notification-categories-tree-view"],["treeViewContainer",""],["shadingColor","rgba(0,0,0,0.3)",3,"container","position","visible","showIndicator","showPane","shading","hideOnOutsideClick"],["appGridAddButton","",3,"onClick"],["appTreeView","","selectionMode","single","dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","scrollDirection","both",3,"dataSource","elementAttr","onItemClick","onContentReady"],["treeview",""],[1,"notification-categories-data-grid"],[1,"grid-toolbar"],[1,"grid-after-tool-bar"],[3,"grid","click"],[3,"grid"],["appGridFeature","","appGridFeatureNotification","",3,"dataFieldTranslationKeysMapping","datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","gridProperties","isEditingDataAsync","onInitNewRow","onEditorPreparing","onRowClick","onRowInserted","onRowRemoved"],["grid",""],[4,"ngFor","ngForOf"],[4,"dxTemplate","dxTemplateOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(a,i){if(1&a){const s=t.EpF();t.TgZ(0,"div",0),t._UZ(1,"app-tenant-chooser"),t.TgZ(2,"div",1)(3,"div",2,3),t._UZ(5,"dx-load-panel",4),t.TgZ(6,"dx-button",5),t.NdJ("onClick",function(){t.CHM(s);const d=t.MAs(16);return t.KtG(d.instance.addRow())}),t.qZA(),t.TgZ(7,"dx-tree-view",6,7),t.NdJ("onItemClick",function(d){return i.onTreeViewItemClick(d)})("onContentReady",function(){return i.onContentReady()}),t.qZA()(),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"app-grid-reload-button",11),t.NdJ("click",function(){return i.reloadTreeView()}),t.qZA(),t._UZ(13,"app-grid-column-chooser",12)(14,"app-grid-general-filter",12),t.qZA()(),t.TgZ(15,"dx-data-grid",13,14),t.NdJ("onInitNewRow",function(d){return i.onInitNewRow(d)})("onEditorPreparing",function(d){return i.onEditorPreparing(d)})("onRowClick",function(d){return i.onRowClick(d)})("onRowInserted",function(d){return i.onRowInserted(d)})("onRowRemoved",function(d){return i.onRowRemoved(d)}),t.YNc(17,z,2,1,"ng-container",15),t.ALo(18,"keyvalue"),t.YNc(19,j,2,1,"div",16),t.qZA(),t._UZ(20,"app-notification-pager",12),t.qZA()()()}if(2&a){const s=t.MAs(4),r=t.MAs(16);t.xp6(5),t.Q6J("container",s)("position",t.VKq(26,H,s))("visible",i.treeViewLoading)("showIndicator",!0)("showPane",!0)("shading",!1)("hideOnOutsideClick",!1),t.xp6(2),t.Q6J("dataSource",i.treeViewDataSource)("elementAttr",t.DdM(28,X)),t.xp6(5),t.Q6J("grid",r),t.xp6(),t.Q6J("grid",r),t.xp6(),t.Q6J("grid",r),t.xp6(),t.Q6J("dataFieldTranslationKeysMapping",i.dataFieldTranslationKeysMapping)("datafieldValueQueryStringKeyMapping",i.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",i.dataFieldLookupSourceMapping)("editingPropertiesForCreating",i.editingPropertiesForCreating)("editingPropertiesForUpdating",i.editingPropertiesForUpdating)("columns",i.columns)("dataSource",i.gridDataSource)("gridProperties",i.gridProperties)("isEditingDataAsync",!1),t.xp6(2),t.Q6J("ngForOf",t.lcZ(18,24,i.templateStore.gridTemplates)),t.xp6(2),t.Q6J("dxTemplateOf","bottom-toolbar"),t.xp6(),t.Q6J("grid",r)}},dependencies:[D.D,p.sg,p.tP,R.S,O._,V.f,A.m,J.R,E.w,K.K,Q.p6,v.u,Z.e,B.Z,y.D,G.q,U.u,p.Nd],styles:[".notification-categories[_ngcontent-%COMP%]{display:flex}.notification-categories-tree-view[_ngcontent-%COMP%]{width:25%;border-right:1px solid var(--gray-3);height:90%;overflow:hidden}.notification-categories-tree-view[_ngcontent-%COMP%]   dx-tree-view[_ngcontent-%COMP%]{height:calc(100% - 40px)}.notification-categories-data-grid[_ngcontent-%COMP%]{width:75%;padding:0 8px;display:flex;flex-direction:column}.notification-categories-data-grid[_ngcontent-%COMP%]     .dx-datagrid-header-panel{display:none}.notification-categories-data-grid[_ngcontent-%COMP%]     dx-data-grid{flex:1}.notification-categories[_ngcontent-%COMP%]     .dx-row.dx-data-row.dx-row-lines:hover{cursor:pointer}.notification-categories-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.notification-categories-container[_ngcontent-%COMP%]   .notification-categories[_ngcontent-%COMP%]{flex:1;overflow:hidden}.grid-toolbar[_ngcontent-%COMP%]{padding:0 8px}.grid-toolbar[_ngcontent-%COMP%]   .grid-after-tool-bar[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}"]})}return o})(),canActivate:[l.a1M,l.nG9]}];let tt=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(q),m.Bz]})}return o})();var et=n(5533),it=n(41992);let nt=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[it.e,p.ez,tt,T.m,et.P,v.V,y.D]})}return o})()}}]);
//# sourceMappingURL=62566.12a46bcab894616a.js.map