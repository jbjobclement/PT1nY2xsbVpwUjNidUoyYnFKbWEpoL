"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[28815],{28815:(de,g,a)=>{a.r(g),a.d(g,{ReceiverGroupsModule:()=>oe});var l=a(96814),I=a(31610),c=a(88762),m=a(23758),v=a(35461),u=a(85054);const y=[{type:"buttons",fixed:!0,buttons:[{name:"save",template:"grid-save-button"},{name:"edit",template:"grid-edit-button"},{name:"delete",template:"grid-delete-button"},{name:"cancel",template:"grid-cancel-button"}]},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string"},{dataField:"SpecifiedTenantId",caption:"\u6307\u5b9a\u79df\u6236",dataType:"string",visible:!1},{dataField:"id",dataType:"string",visible:!1},{dataField:"idCode",caption:"idCode",dataType:"string",validationRules:[u.L],filterOperations:v.I$.text},{dataField:"name",caption:"\u63a5\u6536\u8005\u7fa4\u7d44\u540d\u7a31",dataType:"string",validationRules:[u.L],filterOperations:v.I$.text},{dataField:"sortingNumber",caption:"\u9806\u5e8f",dataType:"number",visible:!1},{dataField:"tenantId",caption:"",dataType:"string",visible:!1},{dataField:"subTenantId",caption:"\u5b50\u79df\u6236",dataType:"string",visible:!1},{name:"subTenantName",caption:"",dataType:"string",visible:!1},{dataField:"receiverIds",dataType:"object",caption:"\u63a5\u6536\u8005",visible:!1,editCellTemplate:"receiverIds",calculateCellValue:i=>i.receiverIds.map(t=>t.id)},{dataField:"parentReceiverGroupId",caption:"",dataType:"string",visible:!1},{name:"receivers",dataType:"object",visible:!1},{dataField:"concurrencyStamp",visible:!1}],f={index:"/api/app/receiver-groups",get:"/api/app/receiver-groups",create:"/api/app/receiver-groups",update:"/api/app/receiver-groups",delete:"/api/app/receiver-groups"},b=[{dataField:"subTenantId",path:"/api/app/receiver-groups/sub-tenant-lookup"},{dataField:"receiverIds",path:"/api/app/receiver-groups/receiver-lookup"},{dataField:"SpecifiedTenantId",path:"/api/app/jbnotifier-admin/customized-users/tenant-lookup",pathForSelectedDisplay:"/api/app/jbnotifier-admin/customized-tenants"}],R=[],h=[{dataField:"id",mapping:["receiverGroup","id"]},{dataField:"concurrencyStamp",mapping:["receiverGroup","concurrencyStamp"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenant","name"]},{dataField:"receiverIds",queryStringKey:"receivers",mapping:["receivers"]},{dataField:"name",queryStringKey:"Name",mapping:["receiverGroup","name"]},{dataField:"idCode",queryStringKey:"IdCode",mapping:["receiverGroup","idCode"]},{dataField:"sortingNumber",queryStringKey:"SortingNumber",mapping:["receiverGroup","sortingNumber"]},{dataField:"subTenantId",queryStringKey:"SubTenantId",mapping:["subTenant","id"]},{dataField:"subTenantName",queryStringKey:"SubTenantName",mapping:["subTenant","name"]},{name:"receivers",mapping:["receivers"]},{dataField:"SpecifiedTenantId",mapping:["tenant","id"]}],_={popup:{title:"JbNotifier::Permission:ReceiverGroups",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"SpecifiedTenantId",editorType:"dxSelectBox"},{dataField:"idCode",editorType:"dxTextBox",validationRules:[u.L]},{dataField:"name",editorType:"dxTextBox",validationRules:[u.L]},{dataField:"subTenantId",editorType:"dxSelectBox",editorOptions:{displayExpr:"displayName"}},{dataField:"receiverIds",label:{visible:!1}},{dataField:"sortingNumber",editorType:"dxNumberBox"}],elementAttr:{class:"custom-form custom-form--edit"}}},G={popup:{title:"JbNotifier::Permission:ReceiverGroups",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"SpecifiedTenantId",editorType:"dxSelectBox",editorOptions:{disabled:!0}},{dataField:"idCode",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"name",editorType:"dxTextBox"},{dataField:"subTenantId",editorType:"dxSelectBox",editorOptions:{displayExpr:"displayName",disabled:!0}},{dataField:"receiverIds",label:{visible:!1}},{dataField:"sortingNumber",editorType:"dxNumberBox"}],elementAttr:{class:"custom-form custom-form--edit"}}};var e=a(19212),D=a(67),M=a(72783),N=a(59444),P=a(21194),O=a(67846),V=a(13443),A=a(65343),J=a(5476),E=a(92931),Z=a(10313),Q=a(16358),T=a(95051),K=a(20843),B=a(25012),U=a(17105),C=a(12305),S=a(51189),L=a(20285),$=a(11423),x=a(34906);const W=["grid"],Y=["treeview"];function j(i,p){1&i&&e.GkF(0)}const k=i=>({$implicit:i});function z(i,p){if(1&i&&(e.ynx(0),e.YNc(1,j,1,0,"ng-container",19),e.BQk()),2&i){const t=p.$implicit,o=e.oxw().$implicit,n=e.oxw();e.xp6(),e.Q6J("ngTemplateOutlet",n.templateStore.getGridTemplates(o.key))("ngTemplateOutletContext",e.VKq(2,k,t))}}function H(i,p){if(1&i&&(e.ynx(0),e.YNc(1,z,2,4,"ng-container",16),e.BQk()),2&i){const t=p.$implicit;e.xp6(),e.Q6J("dxTemplateOf",t.key)}}function X(i,p){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-bottom-toolbar-btns",10),e.qZA()),2&i){e.oxw();const t=e.MAs(18);e.xp6(),e.Q6J("grid",t)}}function q(i,p){if(1&i){const t=e.EpF();e.TgZ(0,"app-notification-tag-box",20),e.NdJ("valueChange",function(n){const r=e.CHM(t).$implicit;return e.KtG(r.setValue(n))}),e.qZA()}if(2&i){const t=p.$implicit;e.Q6J("dataSource",t.column.editorOptions.dataSource)("rowData",t.data.receivers)("label",t.column.caption)("isRequired",t.column.validationRules&&"required"===t.column.validationRules[0].type)("value",t.data.receiverIds)}}const ee=i=>({of:i}),te=()=>({class:"custom-tree-view"}),ie=[{path:"",component:(()=>{class i{constructor(t,o,n,s,r){this.gridDataSourceService=t,this.templateStore=o,this.restService=n,this.tenantChooser=s,this.configStateService=r,this.columns=y,this.treeViewLoading=!1,this.cRUDEndpoints=f,this.dataFieldLookupSourceMapping=b,this.dataFieldTranslationKeysMapping=R,this.relatedDataValueAndQueryStringKeyMapping=h,this.editingPropertiesForCreating=_,this.editingPropertiesForUpdating=G,this.gridProperties={hoverStateEnabled:!0,toolbar:{visible:!1},height:0},this.treeViewDataSource=[],this.isNeedToScrollToItem=!1,this.setGridDataSource=d=>{this.gridDataSource=this.gridDataSourceService.getDataSource(f,h),this.gridDataSource.filter(["ParentReceiverGroupId","=",d])},this.configStateService.getOne$("currentUser").subscribe(d=>{d.tenantId&&(this.editingPropertiesForCreating.form.items[0].visible=!1,this.editingPropertiesForUpdating.form.items[0].visible=!1,this.columns[1].visible=!1)})}ngOnInit(){this.tenantChooser.tenantId$.subscribe(t=>{this.SpecifiedTenantId=t,this.setGridDataSource(),this.setTreeViewDataSource(t),this.SpecifiedTenantIdWhenEditingForCreate=null})}onInitNewRow(t){t.data.parentReceiverGroupId=this.parentReceiverGroupId,t.data.receiverIds=[]}onEditorPreparing(t){"SpecifiedTenantId"!==t.dataField||"dataRow"!==t.parentType||"null"===this.SpecifiedTenantId&&"null"===this.SpecifiedTenantIdWhenEditingForCreate||this.SpecifiedTenantIdWhenEditingForCreate&&(t.editorOptions.disabled=!0,t.editorOptions.value=this.SpecifiedTenantIdWhenEditingForCreate,t.setValue(this.SpecifiedTenantIdWhenEditingForCreate))}onContentReady(){this.parentReceiverGroupId&&this.isNeedToScrollToItem&&(this.treeview.instance.scrollToItem(this.parentReceiverGroupId),this.isNeedToScrollToItem=!1)}onRowClick(t){if(t.event.target.classList.contains("dx-button-content"))return;const o=this.treeViewDataSource.find(n=>n.id===t.data.id);this.setGridDataSource(t.data.id),this.treeview.instance.expandItem(o),this.treeview.instance.selectItem(o),this.parentReceiverGroupId=t.data.id,this.SpecifiedTenantIdWhenEditingForCreate=t.data.SpecifiedTenantId,this.treeview.instance.scrollToItem(this.parentReceiverGroupId)}onRowInserted(t){this.setTreeViewDataSource(this.SpecifiedTenantId,t.data.parentReceiverGroupId),this.isNeedToScrollToItem=!0}onRowRemoved(t){this.treeViewDataSource=this.treeViewDataSource.filter(o=>o.id!==t.data.id),this.isNeedToScrollToItem=!0}setTreeViewDataSource(t,o){this.treeViewLoading=!0,this.restService.request({method:"GET",url:"/api/app/receiver-groups/treeview",params:{SpecifiedTenantId:t}}).subscribe(n=>{const s=n.items.map(r=>({id:r.id,name:r.name,parentId:r.parentId||"receiverGroups",tenantId:r.tenantId||"null",selected:r.id===o,expanded:r.id===o}));this.treeViewDataSource=s,this.treeViewDataSource.unshift({id:"receiverGroups",name:"\u63a5\u6536\u8005\u7fa4\u7d44",parentId:null,selected:!0,expanded:!0}),this.treeViewLoading=!1})}onTreeViewItemClick(t){this.setGridDataSource("receiverGroups"===t.itemData.id?null:t.itemData.id),this.treeview.instance.expandItem(t.itemData),this.treeview.instance.selectItem(t.itemData),this.parentReceiverGroupId=t.itemData.id,this.SpecifiedTenantIdWhenEditingForCreate=t.node.itemData.tenantId}reloadTreeView(){this.setTreeViewDataSource(this.SpecifiedTenantId,this.parentReceiverGroupId),this.isNeedToScrollToItem=!0}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(D.I),e.Y36(M.z),e.Y36(c.vgb),e.Y36(N.L),e.Y36(c.XJE))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-receiver-groups"]],viewQuery:function(o,n){if(1&o&&(e.Gf(W,5),e.Gf(Y,5)),2&o){let s;e.iGM(s=e.CRH())&&(n.grid=s.first),e.iGM(s=e.CRH())&&(n.treeview=s.first)}},decls:24,vars:31,consts:[[1,"receiver-groups-container"],[1,"receiver-groups"],[1,"receiver-groups-tree-view"],["treeViewContainer",""],["shadingColor","rgba(0,0,0,0.3)",3,"container","position","visible","showIndicator","showPane","shading","hideOnOutsideClick"],["appGridAddButton","",3,"onClick"],["appTreeView","","selectionMode","single","dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","scrollDirection","both",3,"dataSource","elementAttr","onItemClick","onContentReady"],["treeview",""],[1,"receiver-groups-data-grid"],[1,"grid-toolbar"],[3,"grid"],[1,"grid-after-tool-bar"],[3,"grid","click"],["appGridFeature","","appGridFeatureNotification","",3,"dataFieldTranslationKeysMapping","datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","gridProperties","isEditingDataAsync","onInitNewRow","onEditorPreparing","onRowClick","onRowInserted","onRowRemoved"],["grid",""],[4,"ngFor","ngForOf"],[4,"dxTemplate","dxTemplateOf"],[3,"dataSource","rowData","label","isRequired","value","valueChange",4,"dxTemplate","dxTemplateOf"],[1,"notification-pager",3,"grid"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"dataSource","rowData","label","isRequired","value","valueChange"]],template:function(o,n){if(1&o){const s=e.EpF();e.TgZ(0,"div",0),e._UZ(1,"app-tenant-chooser"),e.TgZ(2,"div",1)(3,"div",2,3),e._UZ(5,"dx-load-panel",4),e.TgZ(6,"dx-button",5),e.NdJ("onClick",function(){e.CHM(s);const d=e.MAs(18);return e.KtG(d.instance.addRow())}),e.qZA(),e.TgZ(7,"dx-tree-view",6,7),e.NdJ("onItemClick",function(d){return n.onTreeViewItemClick(d)})("onContentReady",function(){return n.onContentReady()}),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div"),e._UZ(12,"app-grid-filter-items",10),e.qZA(),e.TgZ(13,"div",11)(14,"app-grid-reload-button",12),e.NdJ("click",function(){return n.reloadTreeView()}),e.qZA(),e._UZ(15,"app-grid-column-chooser",10)(16,"app-grid-general-filter",10),e.qZA()(),e.TgZ(17,"dx-data-grid",13,14),e.NdJ("onInitNewRow",function(d){return n.onInitNewRow(d)})("onEditorPreparing",function(d){return n.onEditorPreparing(d)})("onRowClick",function(d){return n.onRowClick(d)})("onRowInserted",function(d){return n.onRowInserted(d)})("onRowRemoved",function(d){return n.onRowRemoved(d)}),e.YNc(19,H,2,1,"ng-container",15),e.ALo(20,"keyvalue"),e.YNc(21,X,2,1,"div",16)(22,q,1,5,"app-notification-tag-box",17),e.qZA(),e._UZ(23,"app-notification-pager",18),e.qZA()()()}if(2&o){const s=e.MAs(4),r=e.MAs(18);e.xp6(5),e.Q6J("container",s)("position",e.VKq(28,ee,s))("visible",n.treeViewLoading)("showIndicator",!0)("showPane",!0)("shading",!1)("hideOnOutsideClick",!1),e.xp6(2),e.Q6J("dataSource",n.treeViewDataSource)("elementAttr",e.DdM(30,te)),e.xp6(5),e.Q6J("grid",r),e.xp6(2),e.Q6J("grid",r),e.xp6(),e.Q6J("grid",r),e.xp6(),e.Q6J("grid",r),e.xp6(),e.Q6J("dataFieldTranslationKeysMapping",n.dataFieldTranslationKeysMapping)("datafieldValueQueryStringKeyMapping",n.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",n.dataFieldLookupSourceMapping)("editingPropertiesForCreating",n.editingPropertiesForCreating)("editingPropertiesForUpdating",n.editingPropertiesForUpdating)("columns",n.columns)("dataSource",n.gridDataSource)("gridProperties",n.gridProperties)("isEditingDataAsync",!0),e.xp6(2),e.Q6J("ngForOf",e.lcZ(20,26,n.templateStore.gridTemplates)),e.xp6(2),e.Q6J("dxTemplateOf","bottom-toolbar"),e.xp6(),e.Q6J("dxTemplateOf","receiverIds"),e.xp6(),e.Q6J("grid",r)}},dependencies:[P.D,l.sg,l.tP,O.S,V._,A.f,J.m,E.R,Z.w,Q.K,K.p6,T.u,B.e,U.Z,C.D,S.h,L.u,$.q,x.W,l.Nd],styles:[".receiver-groups[_ngcontent-%COMP%]{display:flex}.receiver-groups-tree-view[_ngcontent-%COMP%]{width:25%;border-right:1px solid var(--gray-3);height:90%;overflow:hidden}.receiver-groups-tree-view[_ngcontent-%COMP%]   dx-tree-view[_ngcontent-%COMP%]{height:calc(100% - 40px)}.receiver-groups-data-grid[_ngcontent-%COMP%]{width:75%;padding:0 8px;display:flex;flex-direction:column}.receiver-groups-data-grid[_ngcontent-%COMP%]     .dx-datagrid-header-panel{display:none}.receiver-groups-data-grid[_ngcontent-%COMP%]     dx-data-grid{flex:1}.receiver-groups[_ngcontent-%COMP%]     .dx-row.dx-data-row.dx-row-lines:hover{cursor:pointer}.receiver-groups-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.receiver-groups-container[_ngcontent-%COMP%]   .receiver-groups[_ngcontent-%COMP%]{flex:1;overflow:hidden}.grid-toolbar[_ngcontent-%COMP%]{padding:0 8px}.grid-toolbar[_ngcontent-%COMP%]   .grid-after-tool-bar[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.notification-pager[_ngcontent-%COMP%]{margin-top:8px}"]})}return i})(),canActivate:[c.a1M,c.nG9]}];let ne=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[m.Bz.forChild(ie),m.Bz]})}return i})();var ae=a(5533),re=a(41992);let oe=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[re.e,l.ez,ne,I.m,ae.P,T.V,C.D,S.h,x.W]})}return i})()}}]);