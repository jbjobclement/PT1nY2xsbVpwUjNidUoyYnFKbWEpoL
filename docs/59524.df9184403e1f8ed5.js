"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[59524],{59524:(Jt,b,a)=>{a.r(b),a.d(b,{NotificationGroupingRecordsModule:()=>Nt});var d=a(26575),_=a(23420),O=a(17135),p=a(35461),c=a(93116);const u=[{id:0,name:"\u5373\u6642"},{id:1,name:"\u9810\u7d04"},{id:2,name:"\u91cd\u8907"}],G=[{type:"buttons",fixed:!0,alignment:"left",buttons:[{name:"detail",template:"grid-table-list-button"},{name:"repush",template:"repush"}]},{name:"id",visible:!1},{name:"concurrencyStamp",visible:!1},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string",filterOperations:p.I$.text},{name:"type",caption:"\u578b\u614b",dataType:"string",lookup:{valueExpr:"id",displayExpr:"name",allowClearing:!0,dataSource:{store:new O.Z({key:"id",load:i=>i.searchValue?u.filter(e=>e.name.includes(i.searchValue)):u,byKey(i,r){const e=u.find(n=>n.id===i);return new Promise(n=>{n(e)})}})}},calculateDisplayValue:i=>i.typeShow},{name:"notificationInfoName",caption:"\u540d\u7a31",dataType:"string",filterOperations:p.I$.text},{name:"notificationProviders",caption:"\u63d0\u4f9b\u8005",dataType:"object",calculateDisplayValue:i=>i.notificationProviders.map(r=>r.displayName).join("\u3001"),allowFiltering:!1,allowSorting:!1},{name:"notificationSchedulePlans",caption:"\u6642\u9593\u8a08\u756b",dataType:"object",calculateDisplayValue:i=>0===i.type?(0,c.m)(i.notificationSchedulePlans[0].pushTime):1===i.type?i.notificationSchedulePlans.map(r=>(0,c.m)(r.pushTime)+` (${r.name})`).join("\u3001"):2===i.type?i.notificationSchedulePlans.map(r=>r.name?r.cronDescription+` (${r.name})`:r.cronDescription).join("\u3001"):void 0,allowFiltering:!1,allowSorting:!1},{name:"receiverDescription",caption:"\u63a5\u6536\u8005\u63cf\u8ff0",dataType:"string",filterOperations:p.I$.text,allowFiltering:!1,allowSorting:!1},{dataField:"title",caption:"\u6a19\u984c",dataType:"string",visible:!1},{dataField:"subtitle",caption:"\u5b50\u6a19\u984c",dataType:"string",visible:!1},{dataField:"notificationDataFetchEndpoint",caption:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint",dataType:"string",visible:!1},{dataField:"hookEndpoint",caption:"Hook",dataType:"string",visible:!1},{dataField:"textContent",caption:"\u6587\u5b57\u5167\u5bb9",dataType:"string",visible:!1},{dataField:"htmlContent",caption:"HTML \u5167\u5bb9",dataType:"string",visible:!1},{type:"detailExpand",fixed:!0,fixedPosition:"right"}],v={index:"/api/app/jbnotifier-admin/notification-grouping-records"},Q=[{dataField:"notificationCategoryId",path:"/api/app/notification-infos/assignable-notification-categories",pathForSelectedDisplay:"/api/app/notification-categories"}],y=[{name:"id",mapping:["notificationInfo","id"]},{name:"concurrencyStamp",mapping:["notificationInfo","concurrencyStamp"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenant","name"]},{name:"type",queryStringKey:"Type",mapping:["notificationInfo","type"]},{name:"typeShow",queryStringKey:"Type",mapping:["notificationInfo","typeShow"]},{name:"notificationInfoName",queryStringKey:"Name",mapping:["notificationInfo","name"]},{name:"notificationProviders",mapping:["notificationProviders"]},{name:"notificationSchedulePlans",mapping:["notificationSchedulePlans"]},{name:"receiverDescription",mapping:["receiverDescription"]},{dataField:"title",mapping:["notificationInfo","title"]},{dataField:"subtitle",mapping:["notificationInfo","subtitle"]},{dataField:"notificationDataFetchEndpoint",mapping:["notificationInfo","notificationDataFetchEndpoint"]},{dataField:"hookEndpoint",mapping:["notificationInfo","hookEndpoint"]},{dataField:"textContent",mapping:["notificationInfo","textContent"]},{dataField:"htmlContent",mapping:["notificationInfo","htmlContent"]},{name:"parseSuccessfulCount",mapping:["notificationInfo","parseSuccessfulCount"]},{name:"parseFailedCount",mapping:["notificationInfo","parseFailedCount"]},{name:"parseCount",mapping:["notificationInfo","parseCount"]},{name:"pushSuccessfulCount",mapping:["notificationInfo","pushSuccessfulCount"]},{name:"pushFailedCount",mapping:["notificationInfo","pushFailedCount"]},{name:"pushCount",mapping:["notificationInfo","pushCount"]},{name:"isFullyFinished",mapping:["notificationInfo","isFullyFinished"]},{name:"isCompletelySuccessful",mapping:["notificationInfo","isCompletelySuccessful"]},{name:"isRepushable",mapping:["isRepushable"]}],E={popup:{title:"::",showCloseButton:!0,wrapperAttr:{class:"basic-popup"},toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:"85vw",height:"90vh"},form:{colCount:2,items:[{dataField:"title",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"subtitle",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"hookEndpoint",editorType:"dxTextBox",editorOptions:{disabled:!0}},{itemType:"group",name:"CustomContentGroup",cssClass:"CustomContentGroup",colSpan:2,colCount:8,items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"240px",disabled:!0},colSpan:3},{dataField:"htmlContent",editorType:"dxHtmlEditor",editorOptions:{...a(35130).W,height:"240px",disabled:!0},colSpan:5}]}],elementAttr:{class:"basic-form basic-form--readonly"}}};var t=a(29039),T=a(33854),g=a(53009),U=a(72783),w=a(59444),S=a(13443),K=a(65343),I=a(27310),$=a(64133),L=a(25659),F=a(64766),D=a(65787),A=a(90070),f=a(12305),j=a(21194),q=a(66403),Y=a(72713);const M=()=>({id:!0,name:"\u662f"}),Z=()=>({id:!1,name:"\u5426"}),H=(i,r)=>[i,r],z=()=>({id:null,name:"\u672a\u5b8c\u6210"}),X=(i,r,e)=>[i,r,e];let W=(()=>{class i{constructor(e){this.appRestService=e,this.notificationInfo={parseSuccessfulCount:null,parseFailedCount:null,parseCount:null,pushSuccessfulCount:null,pushFailedCount:null,pushCount:null,isFullyFinished:null,isCompletelySuccessful:null}}ngOnChanges(){this.getData()}getData(){this.notificationInfoId&&this.appRestService.request({method:"GET",url:`/api/app/jbnotifier-admin/notification-grouping-records/${this.notificationInfoId}`}).subscribe(e=>{this.notificationInfo.parseSuccessfulCount=e.notificationInfo.parseSuccessfulCount,this.notificationInfo.parseFailedCount=e.notificationInfo.parseFailedCount,this.notificationInfo.parseCount=e.notificationInfo.parseCount,this.notificationInfo.pushSuccessfulCount=e.notificationInfo.pushSuccessfulCount,this.notificationInfo.pushFailedCount=e.notificationInfo.pushFailedCount,this.notificationInfo.pushCount=e.notificationInfo.pushCount,this.notificationInfo.isFullyFinished=e.notificationInfo.isFullyFinished,this.notificationInfo.isCompletelySuccessful=e.notificationInfo.isCompletelySuccessful})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(g.$))};static#i=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-notifications-grouping-records-master-detail"]],inputs:{notificationInfoId:"notificationInfoId"},features:[t.TTD],decls:46,vars:24,consts:[[1,"master-detail"],[1,"master-detail-container"],[1,"master-detail-title"],[1,"master-detail-group"],[1,"master-detail-content"],[1,"master-detail-label"],[1,"master-detail-text"],[1,"master-detail-label","master-detail-label--horizontal"],["appRadioGroup","","layout","horizontal",3,"dataSource","value","disabled"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),t._uU(4,"\u63a8\u9001\u8a18\u9304"),t.qZA()(),t.TgZ(5,"div",3)(6,"div",4)(7,"label",5),t._uU(8,"\u89e3\u6790\u6210\u529f\u6b21\u6578"),t.qZA(),t.TgZ(9,"span",6),t._uU(10),t.qZA()(),t.TgZ(11,"div",4)(12,"label",5),t._uU(13,"\u89e3\u6790\u5931\u6557\u6b21\u6578"),t.qZA(),t.TgZ(14,"span",6),t._uU(15),t.qZA()(),t.TgZ(16,"div",4)(17,"label",5),t._uU(18,"\u89e3\u6790\u7e3d\u6b21\u6578"),t.qZA(),t.TgZ(19,"span",6),t._uU(20),t.qZA()()(),t.TgZ(21,"div",3)(22,"div",4)(23,"label",5),t._uU(24,"\u63a8\u9001\u6210\u529f\u6b21\u6578"),t.qZA(),t.TgZ(25,"span",6),t._uU(26),t.qZA()(),t.TgZ(27,"div",4)(28,"label",5),t._uU(29,"\u63a8\u9001\u5931\u6557\u6b21\u6578"),t.qZA(),t.TgZ(30,"span",6),t._uU(31),t.qZA()(),t.TgZ(32,"div",4)(33,"label",5),t._uU(34,"\u63a8\u9001\u7e3d\u6b21\u6578"),t.qZA(),t.TgZ(35,"span",6),t._uU(36),t.qZA()()(),t.TgZ(37,"div",3)(38,"div",4)(39,"label",7),t._uU(40,"\u5168\u90e8\u7d50\u675f"),t.qZA(),t._UZ(41,"dx-radio-group",8),t.qZA(),t.TgZ(42,"div",4)(43,"label",7),t._uU(44,"\u5b8c\u5168\u6210\u529f"),t.qZA(),t._UZ(45,"dx-radio-group",8),t.qZA()()()()),2&n){let s,l,m,h,x,C;t.xp6(10),t.Oqu(null!==(s=o.notificationInfo.parseSuccessfulCount)&&void 0!==s?s:"null"),t.xp6(5),t.Oqu(null!==(l=o.notificationInfo.parseFailedCount)&&void 0!==l?l:"null"),t.xp6(5),t.Oqu(null!==(m=o.notificationInfo.parseCount)&&void 0!==m?m:"null"),t.xp6(6),t.Oqu(null!==(h=o.notificationInfo.pushSuccessfulCount)&&void 0!==h?h:"null"),t.xp6(5),t.Oqu(null!==(x=o.notificationInfo.pushFailedCount)&&void 0!==x?x:"null"),t.xp6(5),t.Oqu(null!==(C=o.notificationInfo.pushCount)&&void 0!==C?C:"null"),t.xp6(5),t.Q6J("dataSource",t.WLB(14,H,t.DdM(12,M),t.DdM(13,Z)))("value",o.notificationInfo.isFullyFinished)("disabled",!0),t.xp6(4),t.Q6J("dataSource",t.kEZ(20,X,t.DdM(17,M),t.DdM(18,Z),t.DdM(19,z)))("value",o.notificationInfo.isCompletelySuccessful)("disabled",!0)}},dependencies:[q.w,Y.I],styles:[".master-detail[_ngcontent-%COMP%]{background-color:var(--dx-master-detail-row-background);padding:3px 20px 16px}.master-detail-container[_ngcontent-%COMP%]{padding:0 24px;background-color:var(--white-1);border:1px solid var(--gray-2);border-radius:5px}.master-detail-title[_ngcontent-%COMP%]{padding:8px 0;border-bottom:1px solid var(--gray-3)}.master-detail-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;font-size:20px;font-weight:600;letter-spacing:var(--letter-2);color:var(--blue-1);margin-bottom:0}.master-detail-content[_ngcontent-%COMP%]{padding:16px 0;flex:1}.master-detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.master-detail-label[_ngcontent-%COMP%]{color:var(--gray-2);margin-bottom:8px}.master-detail-label--horizontal[_ngcontent-%COMP%]{color:var(--black-1);margin-bottom:0;margin-right:8px}.master-detail-text[_ngcontent-%COMP%]{display:block;color:var(--black-1);white-space:normal;word-wrap:break-word}.master-detail-group[_ngcontent-%COMP%]{display:flex;gap:16px}.master-detail[_ngcontent-%COMP%]     dx-radio-group{opacity:1}.master-detail[_ngcontent-%COMP%]     dx-radio-group .dx-radiobutton-icon{border:1px solid var(--gray-3)}.master-detail[_ngcontent-%COMP%]     dx-radio-group .dx-radiobutton-icon.dx-radiobutton-icon-checked .dx-radiobutton-icon-dot{background-color:var(--gray-3)}.master-detail[_ngcontent-%COMP%]     dx-radio-group .dx-item-content{color:var(--black-1)}"]})}return i})();const tt=[{name:"notificationSchedulePlan",caption:"\u6642\u9593\u8a08\u756b",dataType:"object",calculateDisplayValue:i=>i.notificationSchedulePlan?i.notificationSchedulePlan.cronDescription?i.notificationSchedulePlan.name?i.notificationSchedulePlan.cronDescription+` (${i.notificationSchedulePlan.name})`:i.notificationSchedulePlan.cronDescription:(i.notificationBackgroundJob.pushTime?(0,c.m)(i.notificationBackgroundJob.pushTime):"")+(i.notificationSchedulePlan.name?i.notificationBackgroundJob.pushTime?` (${i.notificationSchedulePlan.name})`:i.notificationSchedulePlan.name:""):(0,c.m)(i.notificationBackgroundJob.pushTime)+" (\u91cd\u65b0\u767c\u9001)"},{dataField:"isManual",caption:"\u624b\u52d5",dataType:"boolean",calculateCellValue:i=>i.notificationBackgroundJob.isManual},{name:"expectedParseTime",caption:"\u9810\u8a08\u89e3\u6790\u6642\u9593",dataType:"datetime",calculateDisplayValue:i=>(0,c.m)(i.notificationBackgroundJob.expectedParseTime)},{dataField:"isParseFinished",caption:"\u89e3\u6790\u7d50\u675f",dataType:"boolean",calculateCellValue:i=>i.notificationBackgroundJob.isParseFinished},{dataField:"isParseSuccessful",caption:"\u89e3\u6790\u6210\u529f",dataType:"boolean",calculateCellValue:i=>i.notificationBackgroundJob.isParseSuccessful},{name:"pushTime",caption:"\u63a8\u9001\u6642\u9593",dataType:"datetime",calculateDisplayValue:i=>(0,c.m)(i.notificationBackgroundJob.pushTime)},{dataField:"isFullyFinished",caption:"\u5168\u90e8\u7d50\u675f",dataType:"boolean",calculateCellValue:i=>i.notificationBackgroundJob.isFullyFinished},{dataField:"isCompoletelySuccessful",caption:"\u5b8c\u5168\u6210\u529f",dataType:"boolean",calculateCellValue:i=>i.notificationBackgroundJob.isCompletelySuccessful},{name:"logMessages",caption:"Log \u8a0a\u606f",dataType:"string",cellTemplate:"logMessages",fixed:!0,fixedPosition:"right",alignment:"center",width:80}],it=[],P=[{name:"notificationSchedulePlan",mapping:["notificationSchedulePlan"]},{name:"notificationBackgroundJob",mapping:["notificationBackgroundJob"]}],R={index:"/api/app/jbnotifier-admin/notification-grouping-records"};var et=a(51236),nt=a(79736),N=a(51273),ot=a(58861),J=a(71723),V=a(89267);const at=["grid"],rt=()=>({class:"custom-button-icon"});function st(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",8)(1,"dx-button",9),t.NdJ("onClick",function(){const s=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.showTextContent(s.data.notificationBackgroundJob.logMessages))}),t.qZA()()}2&i&&(t.xp6(),t.Q6J("elementAttr",t.DdM(1,rt)))}function lt(i,r){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.xp6(),t.hij(" ",e.column.caption," ")}}function ct(i,r){if(1&i&&(t.TgZ(0,"div")(1,"dx-data-grid",3,4)(3,"dxo-toolbar"),t._UZ(4,"dxi-item",5),t.qZA(),t.YNc(5,st,2,2,"div",6)(6,lt,2,1,"div",1),t.qZA(),t._UZ(7,"app-notification-pager",7),t.qZA()),2&i){const e=t.MAs(2),n=t.oxw();t.xp6(),t.Q6J("datafieldValueQueryStringKeyMapping",n.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",n.dataFieldLookupSourceMapping)("columns",n.columns)("dataSource",n.gridDataSource)("gridProperties",n.gridProperties),t.xp6(4),t.Q6J("dxTemplateOf","logMessages"),t.xp6(),t.Q6J("dxTemplateOf","JBHeaderCellTemplate"),t.xp6(),t.Q6J("grid",e)}}const dt=()=>({class:"custom-button"});function pt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"dx-button",10),t.NdJ("onClick",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.closePopup())}),t.qZA()()}2&i&&(t.xp6(),t.Q6J("elementAttr",t.DdM(1,dt)))}const ut=()=>({toolbar:"bottom",template:"bottom-toolbar"}),gt=i=>[i],ft=()=>({class:"basic-popup"});let mt=(()=>{class i{constructor(e,n,o){this.gridDataSourceService=e,this.appRestService=n,this.configStateService=o,this.isDetailsVisibleChange=new t.vpe,this.columns=tt,this.dataFieldLookupSourceMapping=it,this.relatedDataValueAndQueryStringKeyMapping=P,this.cRUDEndpoints=R,this.isTextContentVisible=!1,this.gridProperties={editing:{allowDeleting:!1,allowUpdating:!1},filterRow:{visible:!1},toolbar:{visible:!1},pager:{visible:!1},height:"85%",elementAttr:{class:"schedule-plan-data-grid schedule-plan-data-grid--grouping-record w-auto"},sorting:{mode:"none"}},this.configStateService.getOne$("currentTenant").subscribe(s=>{this.tenantId=s.id})}ngOnChanges(){this.getDataSource()}getDataSource(){!this.isDetailsVisible||!this.notificationInfoId||(this.gridDataSource=this.gridDataSourceService.getDataSource(R,P,{override:{load:e=>{e.filter=this.gridDataSourceService.getFlattenedFilter(e.filter);const n=this.gridDataSourceService.getSortingString(e);return(0,et.n)(this.appRestService.request({url:`/api/app/jbnotifier-admin/notification-grouping-records/${this.notificationInfoId}/details`,method:"GET",params:{Sorting:n,SpecifiedTenantId:this.tenantId,MaxResultCount:e.take,SkipCount:e.skip}}).pipe((0,nt.U)(o=>({data:o.items,totalCount:o.totalCount}))))}}}))}closePopup(){this.isDetailsVisibleChange.emit(!1),this.grid.instance.pageIndex(0)}showTextContent(e){this.isTextContentVisible=!0,this.logMessages=e}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(T.I),t.Y36(g.$),t.Y36(N.XJE))};static#i=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-notifications-grouping-record-details"]],viewQuery:function(n,o){if(1&n&&t.Gf(at,5),2&n){let s;t.iGM(s=t.CRH())&&(o.grid=s.first)}},inputs:{notificationInfoId:"notificationInfoId",isDetailsVisible:"isDetailsVisible"},outputs:{isDetailsVisibleChange:"isDetailsVisibleChange"},features:[t.TTD],decls:5,vars:14,consts:[["width","85vw","height","90vh",3,"visible","toolbarItems","wrapperAttr","title","visibleChange"],[4,"dxTemplate","dxTemplateOf"],["textTitle","Log \u8a0a\u606f",3,"isTextContentVisible","textContent","isTextContentVisibleChange"],["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","columns","dataSource","gridProperties"],["grid",""],["name","applyFilterButton","cssClass","d-none"],["class","d-flex justify-content-center",4,"dxTemplate","dxTemplateOf"],[3,"grid"],[1,"d-flex","justify-content-center"],["appCustomButton","","icon","assets/icons/buttons/eye.svg",3,"elementAttr","onClick"],["appCustomButton","","text","\u95dc\u9589",3,"elementAttr","onClick"]],template:function(n,o){1&n&&(t.TgZ(0,"dx-popup",0),t.NdJ("visibleChange",function(l){return o.isDetailsVisible=l}),t.ALo(1,"abpLocalization"),t.YNc(2,ct,8,8,"div",1)(3,pt,2,2,"div",1),t.qZA(),t.TgZ(4,"app-text-content-viewer",2),t.NdJ("isTextContentVisibleChange",function(l){return o.isTextContentVisible=l}),t.qZA()),2&n&&(t.Q6J("visible",o.isDetailsVisible)("toolbarItems",t.VKq(11,gt,t.DdM(10,ut)))("wrapperAttr",t.DdM(13,ft))("title",t.lcZ(1,8,"JbNotifier::NotificationRecordDetail")),t.xp6(2),t.Q6J("dxTemplateOf","content"),t.xp6(),t.Q6J("dxTemplateOf","bottom-toolbar"),t.xp6(),t.Q6J("isTextContentVisible",o.isTextContentVisible)("textContent",o.logMessages))},dependencies:[S._,I.A,F.K,D.p6,J.ZT3,ot.x,A.e,J.y1f,f.D,V.Q,N.fuE],styles:[".schedule-plan-data-grid--grouping-record{padding-bottom:0!important}  .schedule-plan-data-grid--grouping-record .dx-datagrid-headers .dx-datagrid-content-fixed .dx-datagrid-table-fixed .dx-header-row td{border-right:0}  .schedule-plan-data-grid--grouping-record .dx-datagrid-rowsview .dx-datagrid-content .dx-datagrid-table.dx-pointer-events-none td.dx-first-cell{border-right:1px solid var(--gray-3)}  .schedule-plan-data-grid--grouping-record .dx-datagrid-rowsview .dx-datagrid-content .dx-datagrid-table.dx-pointer-events-none td:nth-child(2){border-bottom:1px solid var(--gray-4)}  .schedule-plan-data-grid--grouping-record .dx-datagrid-rowsview .dx-datagrid-content .dx-datagrid-table:not(.dx-pointer-events-none) td{border-bottom:1px solid var(--gray-4)}"]})}return i})();const ht=["grid"],xt=()=>({class:"custom-button custom-button--blue"});function Ct(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"dx-button",10),t.NdJ("onClick",function(){t.CHM(e),t.oxw();const o=t.MAs(4);return t.KtG(o.instance.cancelEditData())}),t.qZA()()}2&i&&(t.xp6(),t.Q6J("elementAttr",t.DdM(1,xt)))}function bt(i,r){1&i&&t.GkF(0)}const _t=i=>({$implicit:i});function vt(i,r){if(1&i&&(t.ynx(0),t.YNc(1,bt,1,0,"ng-container",11),t.BQk()),2&i){const e=r.$implicit,n=t.oxw().$implicit,o=t.oxw();t.xp6(),t.Q6J("ngTemplateOutlet",o.templateStore.getGridTemplates(n.key))("ngTemplateOutletContext",t.VKq(2,_t,e))}}function yt(i,r){if(1&i&&(t.ynx(0),t.YNc(1,vt,2,4,"ng-container",4),t.BQk()),2&i){const e=r.$implicit;t.xp6(),t.Q6J("dxTemplateOf",e.key)}}function Tt(i,r){if(1&i&&t._UZ(0,"app-notifications-grouping-records-master-detail",12),2&i){const e=t.oxw();t.Q6J("notificationInfoId",null==e.masterDetailRowCollapseKey?null:e.masterDetailRowCollapseKey.id)}}const St=()=>({class:"custom-button-icon"});function It(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"dx-button",13),t.NdJ("click",function(){const s=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.openDetailsTable(s.data.id))}),t.qZA()}2&i&&t.Q6J("elementAttr",t.DdM(1,St))}function Ft(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"app-repush-button",15),t.NdJ("buttonClick",function(){t.CHM(e);const o=t.oxw().$implicit,s=t.oxw();return t.KtG(s.repush(o.data.id))}),t.qZA()}}function Dt(i,r){if(1&i&&(t.ynx(0),t.YNc(1,Ft,1,0,"app-repush-button",14),t.BQk()),2&i){const e=r.$implicit;t.xp6(),t.Q6J("ngIf",e.data.isRepushable)}}const At=[{path:"",component:(()=>{class i{constructor(e,n,o,s){this.gridDataSourceService=e,this.appRestService=n,this.templateStore=o,this.tenantChooser=s,this.columns=G,this.cRUDEndpoints=v,this.dataFieldLookupSourceMapping=Q,this.relatedDataValueAndQueryStringKeyMapping=y,this.editingPropertiesForUpdating=E,this.gridProperties={editing:{allowAdding:!1},masterDetail:{enabled:!0,template:"notifications-grouping-records-master-detail"}},this.isDetailsVisible=!1,this.rowExpanded=l=>{this.applyyNotificationMasterDetailRowCollapse(l)},this.tenantChooser.tenantId$.subscribe(l=>{this.grid?.instance?.refresh()})}ngOnInit(){this.gridDataSource=this.gridDataSourceService.getDataSource(v,y)}ngAfterViewInit(){this.grid.instance.on("rowExpanded",this.rowExpanded)}applyyNotificationMasterDetailRowCollapse(e){setTimeout(()=>{const o=e.element.querySelector('[aria-label="Collapse"]').parentElement.ariaRowIndex;e.element.querySelector(`tr.dx-row.dx-data-row.dx-row-lines[aria-rowindex="${o}"]`).classList.add("master-detail-row-collapse")}),e.key!==this.masterDetailRowCollapseKey&&(e.component.collapseRow(this.masterDetailRowCollapseKey),this.masterDetailRowCollapseKey=e.key)}openDetailsTable(e){this.isDetailsVisible=!0,this.notificationInfoId=e}repush(e){this.appRestService.request({method:"POST",url:`/api/app/jbnotifier-admin/notification-grouping-records/${e}/repush`}).subscribe(()=>{this.grid.instance.refresh()})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(T.I),t.Y36(g.$),t.Y36(U.z),t.Y36(w.L))};static#i=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-notification-grouping-records"]],viewQuery:function(n,o){if(1&n&&t.Gf(ht,5),2&n){let s;t.iGM(s=t.CRH())&&(o.grid=s.first)}},decls:13,vars:18,consts:[[1,"custom-grid-container"],[3,"grid","hideCreateBtn"],["appGridFeature","","appGridFeatureNotification","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForUpdating","columns","dataSource","gridProperties"],["grid",""],[4,"dxTemplate","dxTemplateOf"],[4,"ngFor","ngForOf"],[3,"notificationInfoId",4,"dxTemplate","dxTemplateOf"],["appCustomButton","","icon","assets/icons/buttons/table-list.svg",3,"elementAttr","click",4,"dxTemplate","dxTemplateOf"],[3,"grid"],[3,"isDetailsVisible","notificationInfoId","isDetailsVisibleChange"],["appCustomButton","","text","\u78ba\u8a8d",3,"elementAttr","onClick"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"notificationInfoId"],["appCustomButton","","icon","assets/icons/buttons/table-list.svg",3,"elementAttr","click"],[3,"buttonClick",4,"ngIf"],[3,"buttonClick"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"app-tenant-chooser")(2,"app-grid-tool-bar",1),t.TgZ(3,"dx-data-grid",2,3),t.YNc(5,Ct,2,2,"div",4)(6,yt,2,1,"ng-container",5),t.ALo(7,"keyvalue"),t.YNc(8,Tt,1,1,"app-notifications-grouping-records-master-detail",6)(9,It,1,2,"dx-button",7)(10,Dt,2,1,"ng-container",4),t.qZA(),t._UZ(11,"app-notification-pager",8),t.qZA(),t.TgZ(12,"app-notifications-grouping-record-details",9),t.NdJ("isDetailsVisibleChange",function(l){return o.isDetailsVisible=l}),t.qZA()),2&n){const s=t.MAs(4);t.xp6(2),t.Q6J("grid",s)("hideCreateBtn",!0),t.xp6(),t.Q6J("datafieldValueQueryStringKeyMapping",o.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",o.dataFieldLookupSourceMapping)("editingPropertiesForUpdating",o.editingPropertiesForUpdating)("columns",o.columns)("dataSource",o.gridDataSource)("gridProperties",o.gridProperties),t.xp6(2),t.Q6J("dxTemplateOf","bottom-toolbar"),t.xp6(),t.Q6J("ngForOf",t.lcZ(7,16,o.templateStore.gridTemplates)),t.xp6(2),t.Q6J("dxTemplateOf","notifications-grouping-records-master-detail"),t.xp6(),t.Q6J("dxTemplateOf","grid-table-list-button"),t.xp6(),t.Q6J("dxTemplateOf","repush"),t.xp6(),t.Q6J("grid",s),t.xp6(),t.Q6J("isDetailsVisible",o.isDetailsVisible)("notificationInfoId",o.notificationInfoId)}},dependencies:[d.sg,d.O5,d.tP,S._,K.f,I.A,$.f,L.l,F.K,D.p6,A.e,f.D,j.D,W,mt,d.Nd]})}return i})()}];let Mt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#i=this.\u0275mod=t.oAB({type:i});static#e=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(At),_.Bz]})}return i})();var Zt=a(5533),Pt=a(31610),Rt=a(41992);let Nt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#i=this.\u0275mod=t.oAB({type:i});static#e=this.\u0275inj=t.cJS({imports:[d.ez,Pt.m,Zt.P,Mt,f.D,V.Q,Rt.e]})}return i})()}}]);
//# sourceMappingURL=59524.df9184403e1f8ed5.js.map