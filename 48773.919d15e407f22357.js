"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[48773],{48773:(Z,m,n)=>{n.r(m),n.d(m,{CreateNotificationInfoModule:()=>H});var g=n(96814),v=n(31610),l=n(88762),p=n(23758);const x=[],h=[{dataField:"notificationProviderDefinitionIds",path:"/api/app/recurring-notifications/notification-provider-lookup"},{dataField:"receiverIds",path:"/api/app/recurring-notifications/receiver-lookup",pathForSelectedDisplay:"/api/app/jbnotifier-admin/receivers"},{dataField:"topicIds",path:"/api/app/recurring-notifications/topic-lookup",pathForSelectedDisplay:"/api/app/jbnotifier-admin/topics"},{dataField:"notificationTemplateId",path:"/api/app/recurring-notifications/notification-template-lookup",pathForSelectedDisplay:"/api/app/jbnotifier-admin/notification-templates"},{dataField:"receiverGroupIds",path:"/api/app/recurring-notifications/receiver-group-lookup",pathForSelectedDisplay:"/api/app//receiver-groups"},{dataField:"notificationCategoryId",path:"/api/app/recurring-notifications/notification-category-lookup",pathForSelectedDisplay:"/api/app/notification-categories"}];var c=n(85054),d=n(35130);const T={colCount:1,items:[{itemType:"group",name:"BasicGroup",cssClass:"BasicGroup",caption:"\u57fa\u672c",items:[{dataField:"notificationProviderDefinitionIds",template:"notificationProviderDefinitionIds",label:{visible:!1,text:"\u901a\u77e5\u63d0\u4f9b\u8005 id (\u53ef\u8907\u9078)"},validationRules:[c.L]},{dataField:"isForAllReceivers",template:"isForAllReceivers",label:{text:"\u63a5\u6536\u8005"}},{itemType:"group",name:"ReceiversGroup",cssClass:"ReceiversGroup",colCount:3,items:[{dataField:"receiverIds",template:"receiverIds",label:{visible:!1,text:"\u63a5\u6536\u8005 (\u53ef\u8907\u9078)"}},{dataField:"receiverGroupIds",template:"receiverGroupIds",label:{visible:!1,text:"\u63a5\u6536\u7fa4\u7d44 (\u53ef\u8907\u9078)"}},{dataField:"topicIds",template:"topicIds",label:{visible:!1,text:"\u4e3b\u984c (\u53ef\u8907\u9078)"}}]}]},{itemType:"group",name:"SettingGroup",cssClass:"SettingGroup",caption:"\u8a2d\u5b9a",items:[{dataField:"isUsingSpecificNotificationSettings",template:"isUsingSpecificNotificationSettings",label:{text:"\u901a\u77e5\u8a2d\u5b9a"}},{dataField:"notificationSettingItems",template:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"NotificationContentGroup",cssClass:"NotificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",items:[{dataField:"isUsingTemplate",template:"isUsingTemplate",label:{visible:!1}},{dataField:"notificationCategoryId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u5206\u985e id"}},{dataField:"title",editorType:"dxTextBox",label:{text:"\u6a19\u984c"}},{dataField:"subtitle",editorType:"dxTextBox",label:{text:"\u5b50\u6a19\u984c"}},{itemType:"group",name:"CustomContentGroup",colCount:8,items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"240px"},label:{text:"\u6587\u5b57\u5167\u5bb9"},colSpan:3},{dataField:"htmlContent",editorType:"dxHtmlEditor",editorOptions:{...d.W,height:"240px"},label:{text:"HTML \u5167\u5bb9"},colSpan:5}]},{itemType:"group",name:"NotificationTemplateGroup",cssClass:"remove-group",colCount:2,items:[{dataField:"notificationTemplateId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u6a21\u677f"}},{itemType:"empty"},{dataField:"notificationTemplateArgs",template:"notificationTemplateArgs",label:{visible:!1},colSpan:2}]},{itemType:"group",name:"EndpointGroup",cssClass:"EndpointGroup",colCount:3,items:[{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox",label:{text:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint"}},{dataField:"hookEndpoint",editorType:"dxTextBox",label:{text:"Hook"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox",cssClass:"basic-form-checkbox",label:{text:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599"}}]}]},{itemType:"group",name:"FormButtonsGroup",items:[{template:"formButtons",cssClass:"form-buttons"}]}],formData:{notificationProviderDefinitionIds:[],isForAllReceivers:!0,isUsingSpecificNotificationSettings:!1,isUsingTemplate:!1,isFetchNotificationDataByEachReceiver:!1,receiverIds:[],receiverGroupIds:[],notificationSettingItems:[],notificationCategoryId:"",title:"",subTitle:"",textContent:"",htmlContent:"",notificationTemplateId:"",notificationTemplateArgs:"",notificationDataFetchEndpoint:"",hookEndpoint:""},elementAttr:{class:"basic-form create-form"}},C={colCount:1,items:[{itemType:"group",name:"BasicGroup",cssClass:"BasicGroup",caption:"\u57fa\u672c",items:[{dataField:"notificationProviderDefinitionIds",template:"notificationProviderDefinitionIds",label:{visible:!1,text:"\u901a\u77e5\u63d0\u4f9b\u8005 id (\u53ef\u8907\u9078)"},validationRules:[c.L]},{dataField:"isForAllReceivers",template:"isForAllReceivers",label:{text:"\u63a5\u6536\u8005"}},{itemType:"group",name:"ReceiversGroup",cssClass:"ReceiversGroup",colCount:3,items:[{dataField:"receiverIds",template:"receiverIds",label:{visible:!1,text:"\u63a5\u6536\u8005 (\u53ef\u8907\u9078)"}},{dataField:"receiverGroupIds",template:"receiverGroupIds",label:{visible:!1,text:"\u63a5\u6536\u7fa4\u7d44 (\u53ef\u8907\u9078)"}},{dataField:"topicIds",template:"topicIds",label:{visible:!1,text:"\u4e3b\u984c (\u53ef\u8907\u9078)"}}]}]},{itemType:"group",name:"SettingGroup",cssClass:"SettingGroup",caption:"\u8a2d\u5b9a",items:[{dataField:"isUsingSpecificNotificationSettings",template:"isUsingSpecificNotificationSettings",label:{text:"\u901a\u77e5\u8a2d\u5b9a"}},{dataField:"notificationSettingItems",template:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"SchedulePlanGroup",cssClass:"SchedulePlanGroup",caption:"\u9810\u7d04\u6642\u9593\u8a08\u5283",items:[{dataField:"notificationSchedulePlans",template:"reserveNotificationSchedulePlans",label:{visible:!1}}]},{itemType:"group",name:"NotificationContentGroup",cssClass:"NotificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",items:[{dataField:"isUsingTemplate",template:"isUsingTemplate",label:{visible:!1}},{dataField:"notificationCategoryId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u5206\u985e id"}},{dataField:"title",editorType:"dxTextBox",label:{text:"\u6a19\u984c"}},{dataField:"subtitle",editorType:"dxTextBox",label:{text:"\u5b50\u6a19\u984c"}},{itemType:"group",name:"CustomContentGroup",colCount:8,items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"240px"},label:{text:"\u6587\u5b57\u5167\u5bb9"},colSpan:3},{dataField:"htmlContent",editorType:"dxHtmlEditor",editorOptions:{...d.W,height:"240px"},label:{text:"HTML \u5167\u5bb9"},colSpan:5}]},{itemType:"group",name:"NotificationTemplateGroup",cssClass:"remove-group",colCount:2,items:[{dataField:"notificationTemplateId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u6a21\u677f"}},{itemType:"empty"},{dataField:"notificationTemplateArgs",template:"notificationTemplateArgs",label:{visible:!1},colSpan:2}]},{itemType:"group",name:"EndpointGroup",cssClass:"EndpointGroup",colCount:3,items:[{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox",label:{text:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint"}},{dataField:"hookEndpoint",editorType:"dxTextBox",label:{text:"Hook"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox",cssClass:"basic-form-checkbox",label:{text:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599"}}]}]},{itemType:"group",name:"FormButtonsGroup",items:[{template:"formButtons",cssClass:"form-buttons"}]}],formData:{notificationProviderDefinitionIds:[],isForAllReceivers:!0,isUsingSpecificNotificationSettings:!1,isUsingTemplate:!1,isFetchNotificationDataByEachReceiver:!1,receiverIds:[],receiverGroupIds:[],notificationSettingItems:[],notificationCategoryId:"",title:"",subTitle:"",textContent:"",htmlContent:"",notificationTemplateId:"",notificationTemplateArgs:"",notificationDataFetchEndpoint:"",hookEndpoint:"",notificationSchedulePlans:[]},elementAttr:{class:"basic-form create-form"}},b={colCount:1,items:[{itemType:"group",name:"BasicGroup",cssClass:"BasicGroup",caption:"\u57fa\u672c",items:[{dataField:"notificationProviderDefinitionIds",template:"notificationProviderDefinitionIds",label:{visible:!1,text:"\u901a\u77e5\u63d0\u4f9b\u8005 id (\u53ef\u8907\u9078)"},validationRules:[c.L]},{dataField:"isForAllReceivers",template:"isForAllReceivers",label:{text:"\u63a5\u6536\u8005"}},{itemType:"group",name:"ReceiversGroup",cssClass:"ReceiversGroup",colCount:3,items:[{dataField:"receiverIds",template:"receiverIds",label:{visible:!1,text:"\u63a5\u6536\u8005 (\u53ef\u8907\u9078)"}},{dataField:"receiverGroupIds",template:"receiverGroupIds",label:{visible:!1,text:"\u63a5\u6536\u7fa4\u7d44 (\u53ef\u8907\u9078)"}},{dataField:"topicIds",template:"topicIds",label:{visible:!1,text:"\u4e3b\u984c (\u53ef\u8907\u9078)"}}]}]},{itemType:"group",name:"SettingGroup",cssClass:"SettingGroup",caption:"\u8a2d\u5b9a",items:[{dataField:"isUsingSpecificNotificationSettings",template:"isUsingSpecificNotificationSettings",label:{text:"\u901a\u77e5\u8a2d\u5b9a"}},{dataField:"notificationSettingItems",template:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"SchedulePlanGroup",cssClass:"SchedulePlanGroup",caption:"\u91cd\u8907\u6642\u9593\u8a08\u5283",items:[{dataField:"notificationSchedulePlans",template:"recurringNotificationSchedulePlans",label:{visible:!1}}]},{itemType:"group",name:"NotificationContentGroup",cssClass:"NotificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",items:[{dataField:"isUsingTemplate",template:"isUsingTemplate",label:{visible:!1}},{dataField:"notificationCategoryId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u5206\u985e id"}},{dataField:"title",editorType:"dxTextBox",label:{text:"\u6a19\u984c"}},{dataField:"subtitle",editorType:"dxTextBox",label:{text:"\u5b50\u6a19\u984c"}},{itemType:"group",name:"CustomContentGroup",colCount:8,items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"240px"},label:{text:"\u6587\u5b57\u5167\u5bb9"},colSpan:3},{dataField:"htmlContent",editorType:"dxHtmlEditor",editorOptions:{...d.W,height:"240px"},label:{text:"HTML \u5167\u5bb9"},colSpan:5}]},{itemType:"group",name:"NotificationTemplateGroup",cssClass:"remove-group",colCount:2,items:[{dataField:"notificationTemplateId",editorType:"dxSelectBox",label:{text:"\u901a\u77e5\u6a21\u677f"}},{itemType:"empty"},{dataField:"notificationTemplateArgs",template:"notificationTemplateArgs",label:{visible:!1},colSpan:2}]},{itemType:"group",name:"EndpointGroup",cssClass:"EndpointGroup",colCount:3,items:[{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox",label:{text:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint"}},{dataField:"hookEndpoint",editorType:"dxTextBox",label:{text:"Hook"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox",cssClass:"basic-form-checkbox",label:{text:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599"}}]}]},{itemType:"group",name:"FormButtonsGroup",items:[{template:"formButtons",cssClass:"form-buttons"}]}],formData:{notificationProviderDefinitionIds:[],isForAllReceivers:!0,isUsingSpecificNotificationSettings:!1,isUsingTemplate:!1,isFetchNotificationDataByEachReceiver:!1,receiverIds:[],receiverGroupIds:[],notificationSettingItems:[],notificationCategoryId:"",title:"",subTitle:"",textContent:"",htmlContent:"",notificationTemplateId:"",notificationTemplateArgs:"",notificationDataFetchEndpoint:"",hookEndpoint:"",notificationSchedulePlans:[]},elementAttr:{class:"basic-form create-form"}};var t=n(19212),F=n(71036),I=n(20843),_=n(609),f=n(44932),u=n(68833);const y=["form"];function S(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"app-notification-tag-box",7),t.NdJ("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.formProperties.formData.notificationProviderDefinitionIds=a)}),t.qZA()}if(2&o){const e=r.$implicit,i=t.oxw();t.Q6J("dataSource",e.editorOptions.dataSource)("label",i.formProperties.items[0].items[0].label.text)("isRequired",i.formProperties.items[0].items[0].validationRules&&"required"===(null==i.formProperties.items[0].items[0].validationRules[0]?null:i.formProperties.items[0].items[0].validationRules[0].type))("value",i.formProperties.formData.notificationProviderDefinitionIds)}}const G=()=>({name:"\u6240\u6709\u4eba",value:!0}),D=()=>({name:"\u6307\u5b9a\u63a5\u6536\u8005",value:!1}),N=(o,r)=>[o,r];function P(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"app-notification-radio-button",8),t.NdJ("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.formProperties.formData.isForAllReceivers=a)})("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleNotificationRadioButton(a,"isForAllReceivers"))}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("dataSource",t.WLB(4,N,t.DdM(2,G),t.DdM(3,D)))("value",e.formProperties.formData.isForAllReceivers)}}function B(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"app-notification-tag-box",9),t.NdJ("valueChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.formProperties.formData.receiverIds=a)}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("fetchURL",e.lookupFetchURL.receivers)("label",e.formProperties.items[0].items[2].items[0].label.text)("isRequired",e.formProperties.items[0].items[2].items[0].validationRules&&"required"===(null==e.formProperties.items[0].items[2].items[0].validationRules[0]?null:e.formProperties.items[0].items[2].items[0].validationRules[0].type))("value",e.formProperties.formData.receiverIds)("hidden",e.formProperties.formData.isForAllReceivers)}}function R(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",10)(1,"app-save-button",11),t.NdJ("saveButtonEvent",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.handleSubmit())}),t.qZA(),t.TgZ(2,"app-cancel-button",12),t.NdJ("cancelButtonEvent",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.handleCancel())}),t.qZA()()}}const A=[{path:"",component:(()=>{class o{constructor(e,i){this.configStateService=e,this.route=i,this.dataFieldLookupSourceMapping=h,this.dataFieldTranslationKeysMapping=x,this.lookupFetchURL={notificationProviderDefinitions:"/api/app/notification-infos/assignable-notification-provider-definitions",receivers:"/api/app/notification-infos/assignable-receivers",receiverGroups:"/api/app/notification-infos/assignable-receiver-groups"},this.createPageTitle="\u65b0\u589e",this.receiverIdsTemp=[],this.receiverGroupIdsTemp=[],this.notificationSettingItemsTemp=[],this.notificationTemplateIdTemp="",this.notificationTemplateArgsTemp="",this.textContentTemp="",this.htmlContentTemp=""}ngOnInit(){this.route.parent.parent.url.subscribe(e=>{switch(e[0].path){case"instant-notification-infos":this.formProperties=T,this.createPageTitle="\u65b0\u589e\u5373\u6642\u901a\u77e5";break;case"reserve-notification-infos":this.formProperties=C,this.createPageTitle="\u65b0\u589e\u9810\u7d04\u901a\u77e5";break;case"recurring-notification-infos":this.formProperties=b,this.createPageTitle="\u65b0\u589e\u91cd\u8907\u901a\u77e5"}}),this.configStateService.getOne$("currentUser").subscribe(e=>this.lookupFetchURL.receiverGroups+="/"+e.tenantId)}toggleNotificationRadioButton(e,i){const a=this.form.instance.option("formData");switch(i){case"isForAllReceivers":e?(this.receiverIdsTemp=a.receiverIds,this.receiverGroupIdsTemp=a.receiverGroupIds,this.form.instance.updateData("receiverIds",[]),this.form.instance.updateData("receiverGroupIds",[])):(this.form.instance.updateData("receiverIds",this.receiverIdsTemp),this.form.instance.updateData("receiverGroupIds",this.receiverGroupIdsTemp));break;case"isUsingSpecificNotificationSettings":this.form.instance.updateData("notificationSettingItems",e?this.notificationSettingItemsTemp:[]);break;case"isUsingTemplate":this.form.instance.itemOption("NotificationContentGroup.NotificationTemplateGroup","cssClass",e?"":"remove-group"),this.form.instance.itemOption("NotificationContentGroup.CustomContentGroup","cssClass",e?"remove-group":""),e?(this.textContentTemp=a.textContent,this.htmlContentTemp=a.htmlContent,this.form.instance.updateData("textContent",""),this.form.instance.updateData("htmlContent",""),this.form.instance.updateData("notificationTemplateId",this.notificationTemplateIdTemp),this.form.instance.updateData("notificationTemplateArgs",this.notificationTemplateArgsTemp)):(this.notificationTemplateIdTemp=a.notificationTemplateId,this.notificationTemplateArgsTemp=a.notificationTemplateArgs,this.form.instance.updateData("notificationTemplateId",""),this.form.instance.updateData("notificationTemplateArgs",""),this.form.instance.updateData("textContent",this.textContentTemp),this.form.instance.updateData("htmlContent",this.htmlContentTemp))}}setNotificationSettingItems(e,i){this.notificationSettingItemsTemp=e,this.form.instance.updateData("notificationSettingItems",i?e:[])}handleSubmit(){console.log("submit"),console.log(this.form.instance.option("formData"))}handleCancel(){}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(l.XJE),t.Y36(p.gz))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-notification-info"]],viewQuery:function(i,a){if(1&i&&t.Gf(y,5),2&i){let s;t.iGM(s=t.CRH())&&(a.form=s.first)}},decls:8,vars:8,consts:[[1,"create-page-title"],["appFormFeature","",3,"formProperties","dataFieldLookUpSourceMapping","dataFieldTranslationKeysMapping"],["form",""],[3,"dataSource","label","isRequired","value","valueChange",4,"dxTemplate","dxTemplateOf"],[3,"dataSource","value","valueChange",4,"dxTemplate","dxTemplateOf"],[3,"fetchURL","label","isRequired","value","hidden","valueChange",4,"dxTemplate","dxTemplateOf"],["class","form-buttons",4,"dxTemplate","dxTemplateOf"],[3,"dataSource","label","isRequired","value","valueChange"],[3,"dataSource","value","valueChange"],[3,"fetchURL","label","isRequired","value","hidden","valueChange"],[1,"form-buttons"],[3,"saveButtonEvent"],[3,"cancelButtonEvent"]],template:function(i,a){1&i&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"dx-form",1,2),t.YNc(4,S,1,4,"app-notification-tag-box",3)(5,P,1,7,"app-notification-radio-button",4)(6,B,1,5,"app-notification-tag-box",5)(7,R,3,0,"div",6),t.qZA()),2&i&&(t.xp6(),t.Oqu(a.createPageTitle),t.xp6(),t.Q6J("formProperties",a.formProperties)("dataFieldLookUpSourceMapping",a.dataFieldLookupSourceMapping)("dataFieldTranslationKeysMapping",a.dataFieldTranslationKeysMapping),t.xp6(2),t.Q6J("dxTemplateOf","notificationProviderDefinitionIds"),t.xp6(),t.Q6J("dxTemplateOf","isForAllReceivers"),t.xp6(),t.Q6J("dxTemplateOf","receiverIds"),t.xp6(),t.Q6J("dxTemplateOf","formButtons"))},dependencies:[F._,I.p6,_.Y,f.h,u.d],styles:[".create-page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:600;line-height:28px;color:var(--blue-1);letter-spacing:var(--letter-1);padding:16px 0 32px;margin-bottom:0}.form-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:24px}"]})}return o})(),canActivate:[l.a1M,l.nG9]}];let E=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(A),p.Bz]})}return o})();var U=n(5533),M=n(10932),O=n(90962),k=n(68545),J=n(14963),L=n(41661);let H=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#i=this.\u0275inj=t.cJS({imports:[g.ez,E,v.m,U.P,f.h,u.d,M.m,O.b,k.E,J.t,L.v]})}return o})()}}]);