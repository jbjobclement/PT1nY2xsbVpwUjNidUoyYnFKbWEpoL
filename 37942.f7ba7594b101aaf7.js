"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[37942],{37942:(q,f,a)=>{a.r(f),a.d(f,{NotificationSettingsModule:()=>Q});var p=a(96814),S=a(9452),c=a(88762),g=a(23758);const v={index:"",get:"",create:"",update:"",delete:""},y=[{dataField:"creatorId",path:"",pathForSelectedDisplay:""},{dataField:"lastModifierId",path:"",pathForSelectedDisplay:""},{dataField:"notificationSettingDefinitionId",path:"",pathForSelectedDisplay:""}],C=[{dataField:"id",translateKeys:["Id"]},{dataField:"creationTime",translateKeys:["CreationTime"]},{dataField:"creatorId",translateKeys:["CreatorId"]},{name:"creatorCode",translateKeys:["CreatorId"]},{name:"creatorName",translateKeys:["CreatorId"]},{dataField:"lastModificationTime",translateKeys:["LastModificationTime"]},{dataField:"lastModifierId",translateKeys:["LastModifierId"]},{name:"lastModifierCode",translateKeys:["LastModifierId"]},{name:"lastModifierName",translateKeys:["LastModifierId"]},{dataField:"value",translateKeys:["Value"]},{dataField:"isInherited",translateKeys:["IsInherited"]},{dataField:"notificationSettingDefinitionId",translateKeys:["NotificationSettingDefinitionId"]},{name:"notificationSettingDefinitionCode",translateKeys:["NotificationSettingDefinitionId"]},{name:"notificationSettingDefinitionName",translateKeys:["NotificationSettingDefinitionId"]},{dataField:"concurrencyStamp",translateKeys:["ConcurrencyStamp"]}],x=[{dataField:"id",mapping:["id"]},{dataField:"concurrencyStamp",mapping:["concurrencyStamp"]},{dataField:"id",queryStringKey:"Id",mapping:["id"]},{dataField:"creationTime",queryStringKey:"CreationTime",mapping:["creationTime"]},{dataField:"creatorId",queryStringKey:"CreatorId",mapping:["creatorId"]},{name:"creatorCode",queryStringKey:"CreatorId",mapping:["creator"]},{name:"creatorName",queryStringKey:"CreatorId",mapping:["creator"]},{dataField:"lastModificationTime",queryStringKey:"LastModificationTime",mapping:["lastModificationTime"]},{dataField:"lastModifierId",queryStringKey:"LastModifierId",mapping:["lastModifierId"]},{name:"lastModifierCode",queryStringKey:"LastModifierId",mapping:["lastModifier"]},{name:"lastModifierName",queryStringKey:"LastModifierId",mapping:["lastModifier"]},{dataField:"value",queryStringKey:"Value",mapping:["value"]},{dataField:"isInherited",queryStringKey:"IsInherited",mapping:["isInherited"]},{dataField:"notificationSettingDefinitionId",queryStringKey:"NotificationSettingDefinitionId",mapping:["notificationSettingDefinitionId"]},{name:"notificationSettingDefinitionCode",queryStringKey:"NotificationSettingDefinitionId",mapping:["notificationSettingDefinition"]},{name:"notificationSettingDefinitionName",queryStringKey:"NotificationSettingDefinitionId",mapping:["notificationSettingDefinition"]},{dataField:"concurrencyStamp",queryStringKey:"ConcurrencyStamp",mapping:["concurrencyStamp"]}],I=[{dataField:"items",template:"notification-setting-definition",label:{visible:!1}}];var D=a(37398),u=a(99397),m=a(94664),h=a(6990),t=a(19212),F=a(53009),T=a(24270),K=a(69784),M=a(71036),N=a(16358),_=a(10518),b=a(74291),A=a(609);const Z=["grid"];function J(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"dx-select-box",9),t.NdJ("valueChange",function(r){t.CHM(i);const o=t.oxw();return t.KtG(o.formData.tenantId=r)})("onValueChanged",function(r){t.CHM(i);const o=t.oxw();return t.KtG(o.onTenantChanged(r))}),t.qZA()()}if(2&e){const i=t.oxw();t.xp6(),t.Q6J("dataSource",i.tenantsDataSource)("value",i.formData.tenantId)}}const L=(e,d)=>d.id;function V(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div",10)(1,"div",11),t._uU(2),t.ALo(3,"abpLocalization"),t.qZA(),t.TgZ(4,"div",12)(5,"dx-text-box",13),t.NdJ("valueChange",function(r){const s=t.CHM(i).$implicit;return t.KtG(s.value=r)})("onValueChanged",function(r){t.CHM(i);const o=t.oxw(2);return t.KtG(o.onSettingValueChanged(r))}),t.qZA()(),t.TgZ(6,"div")(7,"dx-button",14),t.NdJ("onClick",function(){const o=t.CHM(i).$implicit;return t.KtG(o.value=o.defaultValue)}),t.ALo(8,"abpLocalization"),t.qZA()()()}if(2&e){const i=d.$implicit,n=d.$index;t.xp6(2),t.AsE(" ",t.lcZ(3,4,"::\u8a2d\u5b9a")," ",n+1," "),t.xp6(3),t.Q6J("value",i.value),t.xp6(2),t.Q6J("text",t.lcZ(8,6,"::\u9084\u539f\u9810\u8a2d\u503c"))}}function E(e,d){if(1&e&&(t.TgZ(0,"div"),t.SjG(1,V,9,8,"div",15,L),t.qZA()),2&e){const i=t.oxw();t.xp6(),t.wJu(i.formData.items)}}const U=[{path:"",component:(()=>{class e{constructor(i,n,r){this.appRestService=i,this.configStateService=n,this.toastService=r,this.cRUDEndpoints=v,this.dataFieldLookupSourceMapping=y,this.dataFieldTranslationKeysMapping=C,this.relatedDataValueAndQueryStringKeyMapping=x,this.formItems=I,this.formData={tenantId:"",items:[]},this.isDirty=!1,this.getSettings=()=>this.appRestService.request({method:"GET",url:this.settingUrl}).pipe((0,D.U)(o=>{const s=o.map(l=>({notificationSettingDefinitionId:l.notificationSettingDefinition.id,value:l.notificationSetting.value,isInherited:l.notificationSetting.isInherited,defaultValue:l.notificationSettingDefinition.defaultValue}));return this.originSettings=(0,h.cloneDeep)(s),{tenantId:this.formData.tenantId,items:s}})).pipe((0,u.b)(o=>{this.formData=o})),this.saveSettings=()=>{const o={...this.formData,items:this.formData.items.map(s=>({notificationSettingDefinitionId:s.notificationSettingDefinitionId,value:s.value,isInherited:s.isInherited}))};this.appRestService.request({method:"PUT",url:"/api/app/notification-settings",body:o}).pipe((0,m.w)(()=>this.initConfig())).subscribe(()=>{this.toastService.success("\u5132\u5b58\u6210\u529f!")})}}ngOnInit(){this.initConfig().subscribe()}initConfig(){const n=this.configStateService.getOne("currentUser").tenantId;return n?this.initTenantConfig(n):this.initHostConfig()}initTenantConfig(i){return this.settingUrl="/api/app/notification-settings/current-tenant",this.formData.tenantId=i,this.currentTenantId=i,this.getSettings()}initHostConfig(){return this.appRestService.request({method:"GET",url:"/api/app/notification-settings/assignable-tenants"}).pipe((0,u.b)(i=>{this.formData.tenantId||(this.tenantsDataSource=i.items,this.formData.tenantId=i.items[0]?.id),this.settingUrl=`/api/app/notification-settings/by-tenant-id/${this.formData.tenantId}`})).pipe((0,m.w)(()=>this.getSettings()))}onTenantChanged(i){this.initHostConfig().subscribe()}onSettingValueChanged(){const i=!(0,h.isEqual)(this.originSettings,this.formData.items);this.isDirty=i}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(F.$),t.Y36(c.XJE),t.Y36(T.P))};static#i=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-notification-settings"]],viewQuery:function(n,r){if(1&n&&t.Gf(Z,5),2&n){let o;t.iGM(o=t.CRH())&&(r.grid=o.first)}},decls:12,vars:11,consts:[[1,"paper-1","d-flex","flex-column","align-items-center","h-100"],[1,"flex-grow-1","d-flex","flex-column","justify-content-center"],[1,"mb-3"],[1,"dx-form-group-caption","text-center","mb-2"],[4,"ngIf"],["appFormFeature","",3,"items","formData"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","justify-content-center"],["type","default",3,"text","disabled","onClick"],["displayExpr","name","valueExpr","id",3,"dataSource","value","valueChange","onValueChanged"],[1,"d-flex","align-items-center","mb-3"],[1,"dx-field-item-label-text"],[1,"ps-3","pe-3"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["icon","refresh",3,"text","onClick"],["class","d-flex align-items-center mb-3"]],template:function(n,r){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4),t.ALo(5,"abpLocalization"),t.qZA(),t.YNc(6,J,2,2,"div",4),t.qZA(),t.TgZ(7,"dx-form",5),t.YNc(8,E,3,0,"div",6),t.qZA()(),t.TgZ(9,"div",7)(10,"dx-button",8),t.NdJ("onClick",function(){return r.saveSettings()}),t.ALo(11,"abpLocalization"),t.qZA()()()),2&n&&(t.xp6(4),t.hij(" ",t.lcZ(5,7,"JBNotifier::Permission:NotificationSettings")," "),t.xp6(2),t.Q6J("ngIf",!r.currentTenantId),t.xp6(),t.Q6J("items",r.formItems)("formData",r.formData),t.xp6(),t.Q6J("dxTemplateOf","notification-setting-definition"),t.xp6(2),t.Q6J("text",t.lcZ(11,9,"AbpUi::Save"))("disabled",!r.isDirty))},dependencies:[p.O5,K.p6,M._,N.K,_._,b.I,A.Y,c.fuE],encapsulation:2})}return e})(),canActivate:[c.a1M,c.nG9]}];let G=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#i=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(U),g.Bz]})}return e})(),Q=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#i=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[p.ez,G,S.m]})}return e})()}}]);