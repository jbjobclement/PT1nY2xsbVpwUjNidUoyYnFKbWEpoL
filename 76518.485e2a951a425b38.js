"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[76518],{26600:(R,S,r)=>{r.d(S,{c:()=>V});var e=r(19212),I=r(5533),o=r(96814);const t=(u,f)=>{if(void 0===f)return[];const i=[];return function n(s){u.filter(g=>g.parentId===s).forEach(g=>{i.push(g.id),n(g.id)})}(f),i};var h=r(16358),w=r(20843),p=r(95051),_=r(98179),l=r(61157),v=r(37072),c=r(21137);const d=["tree"];function m(u,f){if(1&u){const i=e.EpF();e.TgZ(0,"dx-tree-view",8,9),e.NdJ("onItemSelectionChanged",function(s){e.CHM(i);const a=e.oxw(2);return e.KtG(a.onItemSelectionChanged(s))}),e.qZA()}if(2&u){const i=e.oxw(2);e.Q6J("dataSource",i._dataSource)("selectNodesRecursive",!1)}}function x(u,f){if(1&u){const i=e.EpF();e.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),e.NdJ("onClick",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.restore())}),e.qZA()(),e.TgZ(4,"dx-check-box",6),e.NdJ("onValueChanged",function(s){e.CHM(i);const a=e.oxw();return e.KtG(a.onCustomSelectNodesRecursiveChanged(s))}),e.qZA(),e.TgZ(5,"span"),e._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),e.qZA()(),e.YNc(7,m,2,2,"dx-tree-view",7),e.qZA()}if(2&u){const i=e.oxw();e.xp6(4),e.Q6J("value",i.customSelectNodesRecursive),e.xp6(3),e.Q6J("ngIf",i.popupVisible)}}function E(u,f){if(1&u){const i=e.EpF();e.TgZ(0,"div")(1,"dx-button",10),e.NdJ("onClick",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onConfirm())}),e.qZA()()}}let V=(()=>{class u{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.isViewMode=!1,this.selectedChange=new e.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=i=>{this.customSelectNodesRecursive=i.value},this.restore=()=>{const i=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(n=>{this.tree.instance.selectItem(n)}),this.customSelectNodesRecursive=i},this.onTagBoxFocusIn=()=>{const i=function C(u){const f=new Set;return u.filter(n=>!n.parentId).forEach(function i(n){if(n.selected){let a=n.parentId;for(;a;)f.add(a),a=u.find(g=>g.id===a)?.parentId}u.filter(a=>a.parentId===n.id).forEach(i)}),Array.from(f)}(this._dataSource);((u,f)=>{this._dataSource.forEach(i=>{const n=void 0!==f.find(s=>s===i.id);i.expanded=n})})(0,i),this.popupVisible=!0}}ngOnChanges(i){i.selected&&(this.treeViewselected=this.selected.map(n=>n),this.tagBoxSelected=this.selected.map(n=>n),this._originSelected=[...this.selected]),i.selected&&i.dataSource&&(this._dataSource=((u,f)=>this.dataSource.map(n=>{const s=void 0!==f.find(a=>a===n.id);return f.find(a=>a===n.id)?{...n,selected:s}:n}))(0,this.selected),this._originSelected=[...this.selected])}onItemSelectionChanged(i){if(this.customSelectNodesRecursive&&!0===i.itemData?.selected){const n=i.itemData?.id;t(this.dataSource,n).forEach(a=>{this.tree.instance.selectItem(a)})}if(this.customSelectNodesRecursive&&!1===i.itemData?.selected){const n=i.itemData?.id;t(this.dataSource,n).forEach(a=>{this.tree.instance.unselectItem(a)})}this.treeViewselected=this._dataSource.filter(n=>n.selected).map(n=>n.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(i=>i),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(i){if(i.removedItems.length){const n=i.removedItems.map(s=>s.id);this.treeViewselected=this.treeViewselected.filter(s=>void 0===n.find(a=>s===a)),this._dataSource.forEach(s=>{n.find(g=>s.id===g)&&(s.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}}static#e=this.\u0275fac=function(n){return new(n||u)};static#t=this.\u0275cmp=e.Xpm({type:u,selectors:[["app-jb-tree-view"]],viewQuery:function(n,s){if(1&n&&e.Gf(d,5),2&n){let a;e.iGM(a=e.CRH())&&(s.tree=a.first)}},inputs:{selected:"selected",dataSource:"dataSource",isViewMode:"isViewMode"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[e.TTD,e.jDz],decls:4,vars:10,consts:[["valueExpr","id","displayExpr","name","placeholder","\u9078\u64c7...",3,"value","dataSource","openOnFieldClick","multiline","disabled","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(n,s){1&n&&(e.TgZ(0,"dx-tag-box",0),e.NdJ("valueChange",function(g){return s.tagBoxSelected=g})("onSelectionChanged",function(g){return s.onTagBoxSelectionChanged(g)})("onFocusIn",function(){return s.onTagBoxFocusIn()}),e.qZA(),e.TgZ(1,"dx-popup",1),e.YNc(2,x,8,2,"dx-scroll-view",2)(3,E,2,0,"div",2),e.qZA()),2&n&&(e.Q6J("value",s.tagBoxSelected)("dataSource",s._dataSource)("openOnFieldClick",!1)("multiline",!0)("disabled",s.isViewMode),e.xp6(),e.Q6J("toolbarItems",s.popupButtonToolBars)("visible",s.popupVisible)("showTitle",!1),e.xp6(),e.Q6J("dxTemplateOf","contentTemplate"),e.xp6(),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[I.P,h.K,w.p6,p.u,_.x,l.U,v.N,c.v,o.ez,o.O5]})}return u})()},90962:(R,S,r)=>{r.d(S,{b:()=>_});var e=r(6990),o=r(74291),C=r(10518),t=r(19212),T=r(53009);const b=(l,v)=>v.notificationSettingDefinitionId;function h(l,v){if(1&l){const c=t.EpF();t.TgZ(0,"dx-select-box",4),t.NdJ("valueChange",function(m){t.CHM(c);const x=t.oxw().$implicit;return t.KtG(x.value=m)})("onValueChanged",function(m){t.CHM(c);const x=t.oxw().$index,E=t.oxw();return t.KtG(E.onSettingValueChanged(m,x))}),t.qZA()}if(2&l){const c=t.oxw().$implicit,d=t.oxw();t.Q6J("dataSource",d.selectBoxDataSource)("value",c.value)}}function w(l,v){if(1&l){const c=t.EpF();t.TgZ(0,"dx-text-box",5),t.NdJ("valueChange",function(m){t.CHM(c);const x=t.oxw().$implicit;return t.KtG(x.value=m)})("onValueChanged",function(m){t.CHM(c);const x=t.oxw().$index,E=t.oxw();return t.KtG(E.onSettingValueChanged(m,x))}),t.qZA()}if(2&l){const c=t.oxw().$implicit;t.Q6J("value",c.value)}}function p(l,v){if(1&l&&(t.TgZ(0,"div",1)(1,"div",2),t._uU(2),t.qZA(),t.TgZ(3,"div"),t.YNc(4,h,1,2,"dx-select-box",3)(5,w,1,1),t.qZA()()),2&l){const c=v.$implicit,d=v.$index,m=t.oxw();t.xp6(2),t.hij(" ",m.displayNames[d]," "),t.xp6(2),t.um2(4,"b6b5fb16-6f45-f7ad-85e3-3a1229a3ead0"===c.notificationSettingDefinitionId?4:5)}}let _=(()=>{class l{constructor(c){this.appRestService=c,this.notificationSetting=[],this.displayNames=[],this.selectBoxDataSource=["A","M"]}ngOnChanges(){this.applyNotificationSettingItems(),this.fetchCustomNotificationSettingItems(),this.clearCustomNotificationSettingItems()}applyNotificationSettingItems(){if(0===this.notificationSetting.length)return;const c=(0,e.cloneDeep)(this.notificationSetting);this.cellInfo.setValue(c)}fetchCustomNotificationSettingItems(){this.notificationSetting.length>0||this.appRestService.request({method:"GET",url:"/api/app/notification-settings/current-tenant"}).subscribe(c=>{c.forEach(d=>{this.notificationSetting.push((0,e.cloneDeep)({notificationSettingDefinitionId:d.notificationSettingDefinition.id,value:d.notificationSetting.value||d.notificationSettingDefinition.defaultValue,isInherited:d.notificationSetting.isInherited})),this.displayNames.push(d.notificationSettingDefinition.displayName)}),this.applyNotificationSettingItems()})}clearCustomNotificationSettingItems(){0!==this.notificationSetting.length&&this.cellInfo.setValue(null)}onSettingValueChanged(c,d){this.notificationSetting[d].value=c.value,this.applyNotificationSettingItems()}static#e=this.\u0275fac=function(d){return new(d||l)(t.Y36(T.$))};static#t=this.\u0275cmp=t.Xpm({type:l,selectors:[["app-notification-setting-items"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[t.TTD,t.jDz],decls:3,vars:0,consts:[[1,"notification-setting-list"],[1,"notification-setting-item"],[1,"notification-setting-item-label"],["valueChangeEvent","keyup",3,"dataSource","value"],["valueChangeEvent","keyup",3,"dataSource","value","valueChange","onValueChanged"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","notification-setting-item"]],template:function(d,m){1&d&&(t.TgZ(0,"div",0),t.SjG(1,p,6,2,"div",6,b),t.qZA()),2&d&&(t.xp6(),t.wJu(m.notificationSetting))},dependencies:[o.a,o.I,C.D,C._],styles:[".notification-setting-list[_ngcontent-%COMP%]{margin-top:-8px;display:flex;flex-direction:column;gap:16px}.notification-setting-item-label[_ngcontent-%COMP%]{margin-bottom:8px}"]})}return l})()},98991:(R,S,r)=>{r.d(S,{D:()=>b});var e=r(26600),I=r(96814),o=r(19212),C=r(53009);function t(h,w){if(1&h){const p=o.EpF();o.TgZ(0,"div",6)(1,"div",7),o._uU(2),o.qZA(),o.TgZ(3,"div",8),o.NdJ("click",function(){const v=o.CHM(p).$implicit,c=o.oxw();return o.KtG(c.removeProvider(v.id))}),o.qZA()()}if(2&h){const p=w.$implicit;o.xp6(2),o.hij(" ",p.name," ")}}const T=h=>({"notification-tag-box-list--show":h});let b=(()=>{class h{constructor(p){this.appRestService=p,this.tenantId="",this.label="",this.selectedReceiverGroups=[],this.renderReceiverGroups=[],this.receiverGroups=[]}ngOnInit(){this.label=this.cellInfo.item.label.text,this.appRestService.request({method:"GET",url:`/api/app/notification-infos/assignable-receiver-groups/${this.tenantId}`}).subscribe(p=>{this.receiverGroups=p.items,this.selectedReceiverGroups=this.cellInfo.data.receiverGroupIds,this.selectedReceiverGroups.length&&(this.renderReceiverGroups=this.receiverGroups.filter(_=>this.selectedReceiverGroups.includes(_.id)))})}selectedChange(p){this.selectedReceiverGroups=p,this.renderReceiverGroups=this.receiverGroups.filter(_=>this.selectedReceiverGroups.includes(_.id)),this.cellInfo.setValue(this.selectedReceiverGroups)}removeProvider(p){this.selectedReceiverGroups=this.selectedReceiverGroups.filter(_=>p!==_)}static#e=this.\u0275fac=function(_){return new(_||h)(o.Y36(C.$))};static#t=this.\u0275cmp=o.Xpm({type:h,selectors:[["app-receiver-group-tree-view"]],inputs:{cellInfo:"cellInfo",tenantId:"tenantId"},standalone:!0,features:[o.jDz],decls:9,vars:6,consts:[[1,"notification-tag-box"],[1,"notification-tag-box-label","dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[3,"selected","dataSource","selectedChange"],[1,"notification-tag-box-list",3,"ngClass"],[1,"notification-tag-box-item"],[1,"notification-tag-box-item-name"],[1,"notification-tag-box-item-close",3,"click"],["class","notification-tag-box-item"]],template:function(_,l){1&_&&(o.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),o._uU(4),o.qZA()()(),o.TgZ(5,"app-jb-tree-view",4),o.NdJ("selectedChange",function(c){return l.selectedChange(c)}),o.qZA(),o.TgZ(6,"div",5),o.SjG(7,t,4,1,"div",9,o.ikw),o.qZA()()),2&_&&(o.xp6(4),o.hij(" ",l.label," "),o.xp6(),o.Q6J("selected",l.selectedReceiverGroups)("dataSource",l.receiverGroups),o.xp6(),o.Q6J("ngClass",o.VKq(4,T,l.selectedReceiverGroups.length)),o.xp6(),o.wJu(l.renderReceiverGroups))},dependencies:[e.c,I.ez,I.mk]})}return h})()}}]);