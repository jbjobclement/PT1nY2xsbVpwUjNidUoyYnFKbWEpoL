"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[64539],{85545:(G,C,r)=>{r.r(C),r.d(C,{ReserveNotificationInfosModule:()=>Pe});var n=r(96814),I=r(66648),v=r(88762),b=r(23758),_=r(35461),T=r(85054);const F=[{type:"buttons",fixed:!0,buttons:[{name:"details",template:"grid-details-button"},{name:"edit",template:"grid-edit-button"},{name:"delete",template:"grid-delete-button"}]},{dataField:"id",visible:!1},{dataField:"concurrencyStamp",visible:!1},{dataField:"title",caption:"\u6a19\u984c",dataType:"string",filterOperations:_.I.text,validationRules:[T.L]},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string",filterOperations:_.I.text},{name:"notificationCategoryName",caption:"\u5206\u985e\u540d\u7a31",dataType:"string",filterOperations:_.I.text},{name:"notificationProviderNames",caption:"\u901a\u77e5\u63d0\u4f9b\u8005\u540d\u7a31 (\u591a\u7b46)",dataType:"string",filterOperations:_.I.text},{name:"receiverDescription",caption:"\u63a5\u6536\u8005\u63cf\u8ff0",dataType:"string",filterOperations:_.I.text},{name:"pushTimes",caption:"\u63a8\u9001\u6642\u9593 (\u591a\u7b46)",dataType:"string",filterOperations:_.I.text},{dataField:"notificationDataFetchEndpoint",caption:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint",dataType:"string",filterOperations:_.I.text},{dataField:"hookEndpoint",caption:"Hook",dataType:"string",filterOperations:_.I.text},{dataField:"isFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean"},{dataField:"isDeletable",caption:"\u662f\u5426\u53ef\u522a\u9664",dataType:"boolean"},{dataField:"isEditable",caption:"\u662f\u5426\u53ef\u7de8\u8f2f",dataType:"boolean"},{dataField:"notificationProviderDefinitionIds",caption:"\u901a\u77e5\u63d0\u4f9b\u8005id (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"notification-provider-definition"},{dataField:"isForAllReceivers",caption:"\u662f\u5426\u50b3\u9001\u7d66\u6240\u6709\u63a5\u6536\u8005",dataType:"boolean",visible:!1},{dataField:"receiverIds",caption:"\u63a5\u6536\u8005 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receivers-tag-box"},{dataField:"receiverGroupIds",caption:"\u63a5\u6536\u7fa4\u7d44 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receiver-groups-tag-box"},{dataField:"notificationSettingRadioGroup",caption:"\u901a\u77e5\u8a2d\u5b9a",dataType:"object",visible:!1,editCellTemplate:"notification-setting-radio-group"},{dataField:"notificationSettingItems",caption:"\u901a\u77e5\u8a2d\u5b9a\u9805\u76ee",dataType:"object",visible:!1,editCellTemplate:"notification-setting-items"},{dataField:"notificationCategoryId",caption:"\u901a\u77e5\u5206\u985e Id",dataType:"string",visible:!1,validationRules:[T.L]},{dataField:"subtitle",caption:"\u5b50\u6a19\u984c",dataType:"string",visible:!1},{dataField:"textContent",caption:"\u6587\u5b57\u5167\u5bb9",dataType:"string",visible:!1},{dataField:"isFetchNotificationDataByEachReceiver",caption:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599",dataType:"string",visible:!1},{dataField:"htmlContent",caption:"Html \u5167\u5bb9",dataType:"string",visible:!1},{dataField:"notificationSchedulePlans",caption:"\u9810\u7d04\u6642\u9593\u8a08\u756b",dataType:"object",visible:!1,editCellTemplate:"notification-schedule-plans"}],S={index:"/api/app/reserve-notification-infos",get:"/api/app/reserve-notification-infos",create:"/api/app/reserve-notification-infos",update:"/api/app/reserve-notification-infos",delete:"/api/app/reserve-notification-infos"},N=[{dataField:"notificationCategoryId",path:"/api/app/notification-infos/assignable-notification-categories",pathForSelectedDisplay:"/api/app/notification-categories"}],y=[{dataField:"id",mapping:["id"]},{dataField:"concurrencyStamp",mapping:["concurrencyStamp"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenantName"]},{name:"notificationCategoryName",queryStringKey:"NotificationCategoryName",mapping:["notificationCategoryName"]},{name:"notificationProviderNames",queryStringKey:"NotificationProviderNames",mapping:["notificationProviderNames"]},{name:"receiverDescription",queryStringKey:"ReceiverDescription",mapping:["receiverDescription"]},{name:"pushTimes",queryStringKey:"PushTimes",mapping:["pushTimes"]},{name:"isFinished",queryStringKey:"IsFinished",mapping:["isFinished"]},{name:"isDeletable",queryStringKey:"IsDeletable",mapping:["isDeletable"]},{name:"isEditable",queryStringKey:"IsEditable",mapping:["isEditable"]},{dataField:"tenantId",mapping:["tenantId"]},{dataField:"notificationProviderDefinitionIds",mapping:["notificationProviderDefinitionIds"]},{dataField:"isForAllReceivers",mapping:["isForAllReceivers"]},{dataField:"receiverIds",mapping:["receiverIds"]},{dataField:"receiverGroupIds",mapping:["receiverGroupIds"]},{dataField:"notificationSettingItems",mapping:["notificationSettingItems"]},{dataField:"notificationCategoryId",mapping:["notificationCategoryId"]},{dataField:"title",queryStringKey:"Title",mapping:["title"]},{dataField:"subtitle",mapping:["subtitle"]},{dataField:"textContent",mapping:["textContent"]},{dataField:"notificationDataFetchEndpoint",queryStringKey:"NotificationDataFetchEndpoint",mapping:["notificationDataFetchEndpoint"]},{dataField:"isFetchNotificationDataByEachReceiver",mapping:["isFetchNotificationDataByEachReceiver"]},{dataField:"hookEndpoint",queryStringKey:"HookEndpoint",mapping:["hookEndpoint"]},{dataField:"htmlContent",mapping:["htmlContent"]},{dataField:"notificationSchedulePlans",mapping:["notificationSchedulePlans"]}],x=[{itemType:"group",name:"basicGroup",caption:"\u57fa\u672c",colCount:2,items:[{dataField:"notificationProviderDefinitionIds"},{itemType:"group",name:"receiverGroup",colCount:2,items:[{dataField:"isForAllReceivers",editorType:"dxCheckBox"},{itemType:"empty"},{dataField:"receiverIds",label:{visible:!1}},{dataField:"receiverGroupIds",label:{visible:!1}}]}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u8a2d\u5b9a",colCount:2,items:[{dataField:"notificationSettingRadioGroup",label:{visible:!1}},{dataField:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u9810\u7d04\u6642\u9593\u8a08\u756b",items:[{dataField:"notificationSchedulePlans",label:{visible:!1}}]},{itemType:"group",name:"notificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",colCount:2,items:[{dataField:"notificationCategoryId",editorType:"dxSelectBox"},{dataField:"title",editorType:"dxTextBox"},{itemType:"group",name:"textboxGroup",items:[{dataField:"subtitle",editorType:"dxTextBox"},{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox"},{dataField:"hookEndpoint",editorType:"dxTextBox"}]},{itemType:"group",name:"textareaGroup",items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"100px"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox"}]},{dataField:"htmlContent",colSpan:2,editorType:"dxHtmlEditor",editorOptions:{imageUpload:{fileUploadMode:"both",tabs:["url","file"]},toolbar:{items:[{name:"undo"},{name:"redo"},{name:"separator"},{name:"size",acceptedValues:["8pt","10pt","12pt","14pt","18pt","24pt","36pt"]},{name:"font",acceptedValues:["Arial","Georgia","Tahoma","Times New Roman","Verdana"]},{name:"separator"},{name:"bold"},{name:"italic"},{name:"strike"},{name:"underline"},{name:"separator"},{name:"alignLeft"},{name:"alignCenter"},{name:"alignRight"},{name:"alignJustify"},{name:"separator"},{name:"orderedList"},{name:"bulletList"},{name:"separator"},{name:"header",acceptedValues:[!1,1,2,3,4,5]},{name:"separator"},{name:"color"},{name:"background"},{name:"separator"},{name:"link"},{name:"image"},{name:"separator"},{name:"clear"},{name:"codeBlock"},{name:"blockquote"},{name:"separator"},{name:"insertTable"},{name:"deleteTable"},{name:"insertRowAbove"},{name:"insertRowBelow"},{name:"deleteRow"},{name:"insertColumnLeft"},{name:"insertColumnRight"},{name:"deleteColumn"},{name:"cellProperties"},{name:"tableProperties"}]},height:"250px"}}]}],R={form:{colCount:1,items:x}},P={form:{colCount:1,items:x}};var e=r(19212),D=r(67),m=r(72783),h=r(16358),l=r(20843),s=r(2173),d=r(25012),c=r(69420),g=r(43821),k=r(10313),J=r(46203),Z=r(38653),B=r(36744),O=r(90962),E=r(98991),w=r(6990);const Q=i=>new Date(i).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});var K=r(11430),U=r(87899),M=r(98179),H=r(66782);const L=["popup"];function j(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div")(2,"label",5)(3,"span",6)(4,"span",7),e._uU(5," \u9810\u7d04\u6642\u9593 "),e.qZA()()(),e.TgZ(6,"dx-date-box",8,9),e.NdJ("valueChange",function(o){e.CHM(t);const p=e.oxw();return e.KtG(p.pushTime=o)}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(6),e.Q6J("value",t.pushTime)}}function Y(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"dx-button",12),e.NdJ("onClick",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.confirm())}),e.qZA()(),e.TgZ(3,"dx-button",13),e.NdJ("onClick",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.cancel())}),e.qZA()()}}const $=()=>({toolbar:"bottom",template:"bottom-toolbar",location:"after"}),z=i=>[i];let q=(()=>{class i{constructor(){this.isCreatePushTimeVisible=!1,this.isCreatePushTimeVisibleChange=new e.vpe,this.selectPushTime=new e.vpe}onHidden(){this.isCreatePushTimeVisibleChange.emit(!1)}confirm(){this.selectPushTime.emit(this.pushTime),this.popup.instance.toggle(!1)}cancel(){this.popup.instance.toggle(!1)}static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plan-create-push-time"]],viewQuery:function(a,o){if(1&a&&e.Gf(L,5),2&a){let p;e.iGM(p=e.CRH())&&(o.popup=p.first)}},inputs:{pushTime:"pushTime",isCreatePushTimeVisible:"isCreatePushTimeVisible"},outputs:{isCreatePushTimeVisibleChange:"isCreatePushTimeVisibleChange",selectPushTime:"selectPushTime"},decls:4,vars:7,consts:[["title","\u9810\u7d04\u6642\u9593\u8a08\u756b","width","450","height","300","contentTemplate","content",3,"visible","toolbarItems","visibleChange","onHidden"],["popup",""],["class","d-flex",4,"dxTemplate","dxTemplateOf"],["class","d-flex align-items-center",4,"dxTemplate","dxTemplateOf"],[1,"d-flex"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["type","datetime","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange"],["dateBox",""],[1,"d-flex","align-items-center"],[1,"me-2"],["type","primary","text","\u78ba\u5b9a",3,"onClick"],["type","primary","text","\u53d6\u6d88",3,"onClick"]],template:function(a,o){1&a&&(e.TgZ(0,"dx-popup",0,1),e.NdJ("visibleChange",function(f){return o.isCreatePushTimeVisible=f})("onHidden",function(){return o.onHidden()}),e.YNc(2,j,8,1,"div",2)(3,Y,4,0,"div",3),e.qZA()),2&a&&(e.Q6J("visible",o.isCreatePushTimeVisible)("toolbarItems",e.VKq(5,z,e.DdM(4,$))),e.xp6(2),e.Q6J("dxTemplateOf","content"),e.xp6(),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[h.K,l.p6,M.x,H.M],encapsulation:2})}return i})();function X(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",11),e.NdJ("onClick",function(){e.CHM(t);const o=e.oxw(),p=o.index,f=o.$implicit,De=e.oxw();return e.KtG(De.edit(p,f))}),e.qZA()}}function W(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",12),e.NdJ("onClick",function(){e.CHM(t);const o=e.oxw().index,p=e.oxw();return e.KtG(p.remove(o))}),e.qZA()}}function ee(i,u){if(1&i&&(e.TgZ(0,"div",7)(1,"div"),e._uU(2),e.qZA(),e.TgZ(3,"div",8),e.YNc(4,X,1,0,"dx-button",9)(5,W,1,0,"dx-button",10),e.qZA()()),2&i){const t=u.$implicit,a=e.oxw();e.xp6(2),e.hij(" ",a.renderFormatPushTime(t.pushTime)," "),e.xp6(2),e.Q6J("ngIf",!t.id),e.xp6(),e.Q6J("ngIf",!1!==t.isDeletable)}}let te=(()=>{class i{constructor(){this.isCreatePushTimeVisible=!1,this.notificationSchedulePlans=[],this.currentSelectedPlanIndex=null,this.pushTime=this.formatDate(new Date),this.renderFormatPushTime=Q}ngOnInit(){this.notificationSchedulePlans=(0,w.cloneDeep)(this.cellInfo.value)}selectPushTime(t){null!==this.currentSelectedPlanIndex?this.notificationSchedulePlans[this.currentSelectedPlanIndex].pushTime=t:this.notificationSchedulePlans.push({pushTime:t}),this.cellInfo.setValue((0,w.cloneDeep)(this.notificationSchedulePlans)),this.pushTime=this.formatDate(new Date),this.currentSelectedPlanIndex=null}edit(t,a){this.isCreatePushTimeVisible=!0,this.currentSelectedPlanIndex=t,this.pushTime=a.pushTime}remove(t){this.notificationSchedulePlans.splice(t,1),this.cellInfo.setValue((0,w.cloneDeep)(this.notificationSchedulePlans))}formatDate(t){return t.toLocalISOString().replace("Z","+08:00")}formatPushTime(t){return new Date(t).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}trackBy(t){return t}static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plans"]],inputs:{cellInfo:"cellInfo"},decls:13,vars:4,consts:[[1,"paper-1","d-flex","flex-column"],[1,"d-flex","justify-content-between"],[1,"mb-1"],["icon","add","type","default","stylingMode","contained",3,"onClick"],[1,"d-flex","justify-content-between","align-plans-center","mb-1","pb-1","border-bottom"],["class","d-flex justify-content-between align-items-center pb-1 pt-1 border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[3,"isCreatePushTimeVisible","pushTime","isCreatePushTimeVisibleChange","selectPushTime"],[1,"d-flex","justify-content-between","align-items-center","pb-1","pt-1","border-bottom"],[1,"d-flex","justify-content-end"],["appGridEditButton","",3,"onClick",4,"ngIf"],["appGridDeleteButton","",3,"onClick",4,"ngIf"],["appGridEditButton","",3,"onClick"],["appGridDeleteButton","",3,"onClick"]],template:function(a,o){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),e._uU(4,"\u9810\u8a08\u63a8\u9001\u9078\u64c7"),e.qZA()(),e.TgZ(5,"dx-button",3),e.NdJ("onClick",function(){return o.isCreatePushTimeVisible=!0}),e.qZA()(),e.TgZ(6,"div")(7,"div",4)(8,"div"),e._uU(9,"\u9810\u8a08\u63a8\u9001\u6642\u9593"),e.qZA(),e._UZ(10,"div"),e.qZA(),e.YNc(11,ee,6,3,"div",5),e.qZA()(),e.TgZ(12,"app-notification-schedule-plan-create-push-time",6),e.NdJ("isCreatePushTimeVisibleChange",function(f){return o.isCreatePushTimeVisible=f})("selectPushTime",function(f){return o.selectPushTime(f)}),e.qZA()),2&a&&(e.xp6(11),e.Q6J("ngForOf",o.notificationSchedulePlans)("ngForTrackBy",o.trackBy),e.xp6(),e.Q6J("isCreatePushTimeVisible",o.isCreatePushTimeVisible)("pushTime",o.pushTime))},dependencies:[n.sg,n.O5,h.K,K.R,U.o,q],encapsulation:2})}return i})();const ie=[{type:"buttons",fixed:!0},{name:"pushTime",caption:"\u9810\u8a08\u63a8\u9001\u6642\u9593",dataType:"string",filterOperations:_.I.text,validationRules:[T.L]},{dataField:"isParsed",caption:"\u662f\u5426\u5df2\u89e3\u6790",dataType:"boolean"},{dataField:"isFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean"}],ne=[],oe=[{name:"pushTime",mapping:["pushTime"]},{dataField:"isParsed",mapping:["isParsed"]},{dataField:"isFinished",mapping:["isFinished"]}];var ae=r(53009);const se=["grid"];function le(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"dx-button",5),e.NdJ("onClick",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.closePopup())}),e.qZA()()}}const re=()=>({toolbar:"bottom",template:"bottom-toolbar",location:"after"}),de=i=>[i];let ce=(()=>{class i{constructor(t,a){this.templateStore=t,this.appRestService=a,this.notificationId="",this.isDetailsTableVisible=!1,this.isDetailsTableVisibleChange=new e.vpe,this.columns=ie,this.dataFieldLookupSourceMapping=ne,this.relatedDataValueAndQueryStringKeyMapping=oe,this.gridProperties={editing:{allowDeleting:!1,allowUpdating:!1},pager:{visible:!1},filterRow:{visible:!1}},this.gridDataSource=[]}ngOnChanges(){this.notificationId&&this.appRestService.request({method:"GET",url:`/api/app/reserve-notification-infos/notification-schedule-plans/${this.notificationId}`}).subscribe(t=>{this.gridDataSource=[...t],this.gridDataSource.forEach(a=>a.pushTime=Q(a.pushTime))})}closePopup(){this.isDetailsTableVisibleChange.emit(!1)}static#e=this.\u0275fac=function(a){return new(a||i)(e.Y36(m.z),e.Y36(ae.$))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plan-details"]],viewQuery:function(a,o){if(1&a&&e.Gf(se,5),2&a){let p;e.iGM(p=e.CRH())&&(o.grid=p.first)}},inputs:{notificationId:"notificationId",isDetailsTableVisible:"isDetailsTableVisible"},outputs:{isDetailsTableVisibleChange:"isDetailsTableVisibleChange"},features:[e.TTD],decls:6,vars:11,consts:[["title","\u6642\u9593\u8a08\u756b\u7d30\u7bc0",3,"visible","toolbarItems","visibleChange"],["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","columns","dataSource","gridProperties"],["grid",""],["name","applyFilterButton","cssClass","d-none"],[4,"dxTemplate","dxTemplateOf"],["type","primary","text","\u95dc\u9589",3,"onClick"]],template:function(a,o){1&a&&(e.TgZ(0,"dx-popup",0),e.NdJ("visibleChange",function(f){return o.isDetailsTableVisible=f}),e.TgZ(1,"dx-data-grid",1,2)(3,"dxo-toolbar"),e._UZ(4,"dxi-item",3),e.qZA()(),e.YNc(5,le,2,0,"div",4),e.qZA()),2&a&&(e.Q6J("visible",o.isDetailsTableVisible)("toolbarItems",e.VKq(9,de,e.DdM(8,re))),e.xp6(),e.Q6J("datafieldValueQueryStringKeyMapping",o.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",o.dataFieldLookupSourceMapping)("columns",o.columns)("dataSource",o.gridDataSource)("gridProperties",o.gridProperties),e.xp6(4),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[h.K,l.p6,s.ZT3,M.x,d.e,s.y1f,g._],encapsulation:2})}return i})();const pe=["grid"];function ue(i,u){if(1&i&&e._UZ(0,"app-grid-general-filter",13),2&i){e.oxw();const t=e.MAs(1);e.Q6J("grid",t)}}function me(i,u){1&i&&e.GkF(0)}const fe=i=>({$implicit:i});function ge(i,u){if(1&i&&(e.ynx(0),e.YNc(1,me,1,0,"ng-container",15),e.BQk()),2&i){const t=u.$implicit,a=e.oxw().$implicit,o=e.oxw();e.xp6(),e.Q6J("ngTemplateOutlet",o.templateStore.getGridTemplates(a.key))("ngTemplateOutletContext",e.VKq(2,fe,t))}}function he(i,u){if(1&i&&(e.ynx(0),e.YNc(1,ge,2,4,"ng-container",14),e.BQk()),2&i){const t=u.$implicit;e.xp6(),e.Q6J("dxTemplateOf",t.key)}}function _e(i,u){1&i&&e._UZ(0,"app-notification-provider-definitions",16),2&i&&e.Q6J("cellInfo",u.$implicit)}function ve(i,u){if(1&i&&e._UZ(0,"app-receiver-tag-box",17),2&i){const t=u.$implicit,a=e.oxw();e.Q6J("cellInfo",t)("hideReceiverTagBox",a.isForAllReceivers)}}function Te(i,u){if(1&i&&e._UZ(0,"app-receiver-group-tree-view",18),2&i){const t=u.$implicit,a=e.oxw();e.Q6J("cellInfo",t)("hideReceiverTreeView",a.isForAllReceivers)}}function xe(i,u){1&i&&e._UZ(0,"app-notification-setting-items-radio-group",16),2&i&&e.Q6J("cellInfo",u.$implicit)}function Ce(i,u){if(1&i&&e._UZ(0,"app-notification-setting-items",19),2&i){const t=u.$implicit,a=e.oxw();e.Q6J("isUseCustomSetting",a.isUseCustomSetting)("cellInfo",t)}}function be(i,u){1&i&&e._UZ(0,"app-notification-schedule-plans",16),2&i&&e.Q6J("cellInfo",u.$implicit)}function Se(i,u){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",20),e.NdJ("click",function(){const p=e.CHM(t).$implicit,f=e.oxw();return e.KtG(f.openDetailsTable(p.data.id))}),e.qZA()}}const ye=()=>({type:"default",stylingMode:"contained"}),Ie=[{path:"",component:(()=>{class i{constructor(t,a,o){this.gridDataSourceService=t,this.templateStore=a,this.configStateService=o,this.columns=F,this.cRUDEndpoints=S,this.dataFieldLookupSourceMapping=N,this.relatedDataValueAndQueryStringKeyMapping=y,this.editingPropertiesForCreating=R,this.editingPropertiesForUpdating=P,this.isForAllReceivers=!1,this.isUseCustomSetting=!1,this.tenantId="",this.isDetailsTableVisible=!1,this.notificationId=""}ngOnInit(){this.gridDataSource=this.gridDataSourceService.getDataSource(S,y),this.configStateService.getOne$("currentUser").subscribe(t=>{this.tenantId=t.tenantId})}onInitNewRow(t){t.data.tenantId=this.tenantId,t.data.isForAllReceivers=!1,t.data.isFetchNotificationDataByEachReceiver=!1}onRowValidating(t){this.validateIsForAllReceivers(t)}onOptionChanged(t){"editing.changes"!==t.fullName&&"editing.editRowKey"!==t.fullName||"object"!=typeof t.value||!t.value||Array.isArray(t.value)&&0===t.value.length||(this.checkIsForAllReceivers(t),this.checkIsUseCustomSetting(t))}checkIsForAllReceivers(t){"editing.changes"===t.fullName&&!("isForAllReceivers"in t.value[0].data)||"editing.editRowKey"===t.fullName&&!("isForAllReceivers"in t.value)||"editing.changes"===t.fullName&&this.isForAllReceivers===t.value[0].data.isForAllReceivers||"editing.editRowKey"===t.fullName&&this.isForAllReceivers===t.value.isForAllReceivers||(this.isForAllReceivers="editing.changes"===t.fullName?t.value[0].data.isForAllReceivers:t.value.isForAllReceivers)}checkIsUseCustomSetting(t){"editing.editRowKey"!==t.fullName&&t.value[0].data.notificationSettingRadioGroup&&(this.isUseCustomSetting&&"custom"===t.value[0].data.notificationSettingRadioGroup||(this.isUseCustomSetting="custom"===t.value[0].data.notificationSettingRadioGroup))}validateIsForAllReceivers(t){!t.newData.isForAllReceivers||(t.newData.receiverIds=[],t.newData.receiverGroupIds=[],!t.brokenRules.find(o=>"custom"===o.type&&"receiverTagBoxValidationCallback"===o.validationCallback.name)||1!==t.brokenRules.length)||(t.isValid=!0)}resetOption(){this.isForAllReceivers=!1,this.isUseCustomSetting=!1}openDetailsTable(t){this.isDetailsTableVisible=!0,this.notificationId=t}static#e=this.\u0275fac=function(a){return new(a||i)(e.Y36(D.I),e.Y36(m.z),e.Y36(v.XJE))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-instant-notification"]],viewQuery:function(a,o){if(1&a&&e.Gf(pe,5),2&a){let p;e.iGM(p=e.CRH())&&(o.grid=p.first)}},decls:17,vars:21,consts:[["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","isEditingDataAsync","onEditCanceled","onRowInserted","onInitNewRow","onOptionChanged","onRowValidating"],["grid",""],["name","addRowButton","location","before","widget","dxButton","cssClass","mb-1",3,"options"],["location","after"],[3,"grid",4,"dxTemplate"],["name","applyFilterButton","cssClass","d-none"],[4,"ngFor","ngForOf"],[3,"cellInfo",4,"dxTemplate","dxTemplateOf"],[3,"cellInfo","hideReceiverTagBox",4,"dxTemplate","dxTemplateOf"],[3,"cellInfo","hideReceiverTreeView",4,"dxTemplate","dxTemplateOf"],[3,"isUseCustomSetting","cellInfo",4,"dxTemplate","dxTemplateOf"],["appGridViewButton","",3,"click",4,"dxTemplate","dxTemplateOf"],[3,"isDetailsTableVisible","notificationId","isDetailsTableVisibleChange"],[3,"grid"],[4,"dxTemplate","dxTemplateOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"cellInfo"],[3,"cellInfo","hideReceiverTagBox"],[3,"cellInfo","hideReceiverTreeView"],[3,"isUseCustomSetting","cellInfo"],["appGridViewButton","",3,"click"]],template:function(a,o){1&a&&(e.TgZ(0,"dx-data-grid",0,1),e.NdJ("onEditCanceled",function(){return o.resetOption()})("onRowInserted",function(){return o.resetOption()})("onInitNewRow",function(f){return o.onInitNewRow(f)})("onOptionChanged",function(f){return o.onOptionChanged(f)})("onRowValidating",function(f){return o.onRowValidating(f)}),e.TgZ(2,"dxo-toolbar"),e._UZ(3,"dxi-item",2),e.TgZ(4,"dxi-item",3),e.YNc(5,ue,1,1,"app-grid-general-filter",4),e.qZA(),e._UZ(6,"dxi-item",5),e.qZA(),e.YNc(7,he,2,1,"ng-container",6),e.ALo(8,"keyvalue"),e.YNc(9,_e,1,1,"app-notification-provider-definitions",7)(10,ve,1,2,"app-receiver-tag-box",8)(11,Te,1,2,"app-receiver-group-tree-view",9)(12,xe,1,1,"app-notification-setting-items-radio-group",7)(13,Ce,1,2,"app-notification-setting-items",10)(14,be,1,1,"app-notification-schedule-plans",7)(15,Se,1,0,"dx-button",11),e.qZA(),e.TgZ(16,"app-notification-schedule-plan-details",12),e.NdJ("isDetailsTableVisibleChange",function(f){return o.isDetailsTableVisible=f}),e.qZA()),2&a&&(e.Q6J("datafieldValueQueryStringKeyMapping",o.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",o.dataFieldLookupSourceMapping)("editingPropertiesForCreating",o.editingPropertiesForCreating)("editingPropertiesForUpdating",o.editingPropertiesForUpdating)("columns",o.columns)("dataSource",o.gridDataSource)("isEditingDataAsync",!0),e.xp6(3),e.Q6J("options",e.DdM(20,ye)),e.xp6(4),e.Q6J("ngForOf",e.lcZ(8,18,o.templateStore.gridTemplates)),e.xp6(2),e.Q6J("dxTemplateOf","notification-provider-definition"),e.xp6(),e.Q6J("dxTemplateOf","receivers-tag-box"),e.xp6(),e.Q6J("dxTemplateOf","receiver-groups-tag-box"),e.xp6(),e.Q6J("dxTemplateOf","notification-setting-radio-group"),e.xp6(),e.Q6J("dxTemplateOf","notification-setting-items"),e.xp6(),e.Q6J("dxTemplateOf","notification-schedule-plans"),e.xp6(),e.Q6J("dxTemplateOf","grid-details-button"),e.xp6(),e.Q6J("isDetailsTableVisible",o.isDetailsTableVisible)("notificationId",o.notificationId))},dependencies:[n.sg,n.tP,h.K,l.p6,s.ZT3,d.e,s.y1f,c.p,g._,k.w,J.J,Z.k,B.b,O.b,E.D,te,ce,n.Nd],encapsulation:2})}return i})(),canActivate:[v.a1M,v.nG9]}];let Fe=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[b.Bz.forChild(Ie),b.Bz]})}return i})();var Ne=r(77490),Re=r(68862);let Pe=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[n.ez,Fe,Ne.P,Re.O,I.m,J.J,Z.k,B.b,O.b,E.D]})}return i})()},26600:(G,C,r)=>{r.d(C,{c:()=>D});var n=r(19212),I=r(77490),v=r(96814);const _=(m,h)=>{if(void 0===h)return[];const l=[];return function s(d){m.filter(g=>g.parentId===d).forEach(g=>{l.push(g.id),s(g.id)})}(h),l};var T=r(16358),F=r(20843),S=r(95051),N=r(98179),y=r(61157),V=r(37072),x=r(21137);const A=["tree"];function R(m,h){if(1&m){const l=n.EpF();n.TgZ(0,"dx-tree-view",8,9),n.NdJ("onItemSelectionChanged",function(d){n.CHM(l);const c=n.oxw(2);return n.KtG(c.onItemSelectionChanged(d))})("onContentReady",function(d){n.CHM(l);const c=n.oxw(2);return n.KtG(c.onContentReady(d))}),n.qZA()}if(2&m){const l=n.oxw(2);n.Q6J("dataSource",l._dataSource)("selectNodesRecursive",!1)}}function P(m,h){if(1&m){const l=n.EpF();n.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),n.NdJ("onClick",function(){n.CHM(l);const d=n.oxw();return n.KtG(d.restore())}),n.qZA()(),n.TgZ(4,"dx-check-box",6),n.NdJ("onValueChanged",function(d){n.CHM(l);const c=n.oxw();return n.KtG(c.onCustomSelectNodesRecursiveChanged(d))}),n.qZA(),n.TgZ(5,"span"),n._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),n.qZA()(),n.YNc(7,R,2,2,"dx-tree-view",7),n.qZA()}if(2&m){const l=n.oxw();n.xp6(4),n.Q6J("value",l.customSelectNodesRecursive),n.xp6(3),n.Q6J("ngIf",l.popupVisible)}}function e(m,h){if(1&m){const l=n.EpF();n.TgZ(0,"div")(1,"dx-button",10),n.NdJ("onClick",function(){n.CHM(l);const d=n.oxw();return n.KtG(d.onConfirm())}),n.qZA()()}}let D=(()=>{class m{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.selectedChange=new n.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=l=>{this.customSelectNodesRecursive=l.value},this.restore=()=>{const l=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(s=>{this.tree.instance.selectItem(s)}),this.customSelectNodesRecursive=l},this.onTagBoxFocusIn=()=>{const l=function b(m){const h=new Set;return m.filter(s=>!s.parentId).forEach(function l(s){if(s.selected){let c=s.parentId;for(;c;)h.add(c),c=m.find(g=>g.id===c)?.parentId}m.filter(c=>c.parentId===s.id).forEach(l)}),Array.from(h)}(this._dataSource);this._dataSource.forEach(s=>{const d=void 0!==l.find(c=>c===s.id);s.expanded=d}),this.popupVisible=!0}}ngOnChanges(l){!l.selected?.firstChange&&!l.dataSource?.firstChange||(l.selected&&(this.treeViewselected=this.selected.map(s=>s),this.tagBoxSelected=this.selected.map(s=>s)),l.selected&&l.dataSource&&(this._dataSource=this.dataSource.map(s=>{const d=void 0!==this.selected.find(c=>c===s.id);return this.selected.find(c=>c===s.id)?{...s,selected:d}:s}),this._originSelected=[...this.selected]))}onItemSelectionChanged(l){if(this.customSelectNodesRecursive&&!0===l.itemData?.selected){const s=l.itemData?.id;_(this.dataSource,s).forEach(c=>{this.tree.instance.selectItem(c)})}if(this.customSelectNodesRecursive&&!1===l.itemData?.selected){const s=l.itemData?.id;_(this.dataSource,s).forEach(c=>{this.tree.instance.unselectItem(c)})}this.treeViewselected=this._dataSource.filter(s=>s.selected).map(s=>s.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(l=>l),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(l){const s=l.removedItems.map(d=>d.id);this.treeViewselected=this.treeViewselected.filter(d=>void 0===s.find(c=>d===c)),this._dataSource.forEach(d=>{s.find(g=>d.id===g)&&(d.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}static#e=this.\u0275fac=function(s){return new(s||m)};static#t=this.\u0275cmp=n.Xpm({type:m,selectors:[["app-jb-tree-view"]],viewQuery:function(s,d){if(1&s&&n.Gf(A,5),2&s){let c;n.iGM(c=n.CRH())&&(d.tree=c.first)}},inputs:{selected:"selected",dataSource:"dataSource"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[n.TTD,n.jDz],decls:4,vars:9,consts:[["valueExpr","id","displayExpr","name",3,"value","dataSource","openOnFieldClick","multiline","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(s,d){1&s&&(n.TgZ(0,"dx-tag-box",0),n.NdJ("valueChange",function(g){return d.tagBoxSelected=g})("onSelectionChanged",function(g){return d.onTagBoxSelectionChanged(g)})("onFocusIn",function(){return d.onTagBoxFocusIn()}),n.qZA(),n.TgZ(1,"dx-popup",1),n.YNc(2,P,8,2,"dx-scroll-view",2)(3,e,2,0,"div",2),n.qZA()),2&s&&(n.Q6J("value",d.tagBoxSelected)("dataSource",d._dataSource)("openOnFieldClick",!1)("multiline",!0),n.xp6(),n.Q6J("toolbarItems",d.popupButtonToolBars)("visible",d.popupVisible)("showTitle",!1),n.xp6(),n.Q6J("dxTemplateOf","contentTemplate"),n.xp6(),n.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[I.P,T.K,F.p6,S.u,N.x,y.U,V.N,x.v,v.ez,v.O5]})}return m})()}}]);