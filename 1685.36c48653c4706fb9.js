"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[1685],{26600:(w,E,o)=>{o.d(E,{c:()=>M});var t=o(19212),l=o(77490),T=o(96814);const e=(f,S)=>{if(void 0===S)return[];const i=[];return function n(s){f.filter(D=>D.parentId===s).forEach(D=>{i.push(D.id),n(D.id)})}(S),i};var h=o(16358),I=o(20843),g=o(95051),_=o(98179),d=o(61157),a=o(37072),p=o(21137);const r=["tree"];function u(f,S){if(1&f){const i=t.EpF();t.TgZ(0,"dx-tree-view",8,9),t.NdJ("onItemSelectionChanged",function(s){t.CHM(i);const c=t.oxw(2);return t.KtG(c.onItemSelectionChanged(s))})("onContentReady",function(s){t.CHM(i);const c=t.oxw(2);return t.KtG(c.onContentReady(s))}),t.qZA()}if(2&f){const i=t.oxw(2);t.Q6J("dataSource",i._dataSource)("selectNodesRecursive",!1)}}function m(f,S){if(1&f){const i=t.EpF();t.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),t.NdJ("onClick",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.restore())}),t.qZA()(),t.TgZ(4,"dx-check-box",6),t.NdJ("onValueChanged",function(s){t.CHM(i);const c=t.oxw();return t.KtG(c.onCustomSelectNodesRecursiveChanged(s))}),t.qZA(),t.TgZ(5,"span"),t._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),t.qZA()(),t.YNc(7,u,2,2,"dx-tree-view",7),t.qZA()}if(2&f){const i=t.oxw();t.xp6(4),t.Q6J("value",i.customSelectNodesRecursive),t.xp6(3),t.Q6J("ngIf",i.popupVisible)}}function V(f,S){if(1&f){const i=t.EpF();t.TgZ(0,"div")(1,"dx-button",10),t.NdJ("onClick",function(){t.CHM(i);const s=t.oxw();return t.KtG(s.onConfirm())}),t.qZA()()}}let M=(()=>{class f{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.isViewMode=!1,this.selectedChange=new t.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=i=>{this.customSelectNodesRecursive=i.value},this.restore=()=>{const i=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(n=>{this.tree.instance.selectItem(n)}),this.customSelectNodesRecursive=i},this.onTagBoxFocusIn=()=>{const i=function v(f){const S=new Set;return f.filter(n=>!n.parentId).forEach(function i(n){if(n.selected){let c=n.parentId;for(;c;)S.add(c),c=f.find(D=>D.id===c)?.parentId}f.filter(c=>c.parentId===n.id).forEach(i)}),Array.from(S)}(this._dataSource);((f,S)=>{this._dataSource.forEach(i=>{const n=void 0!==S.find(s=>s===i.id);i.expanded=n})})(0,i),this.popupVisible=!0}}ngOnChanges(i){i.selected&&(this.treeViewselected=this.selected.map(n=>n),this.tagBoxSelected=this.selected.map(n=>n),this._originSelected=[...this.selected]),i.selected&&i.dataSource&&(this._dataSource=((f,S)=>this.dataSource.map(n=>{const s=void 0!==S.find(c=>c===n.id);return S.find(c=>c===n.id)?{...n,selected:s}:n}))(0,this.selected),this._originSelected=[...this.selected])}onItemSelectionChanged(i){if(this.customSelectNodesRecursive&&!0===i.itemData?.selected){const n=i.itemData?.id;e(this.dataSource,n).forEach(c=>{this.tree.instance.selectItem(c)})}if(this.customSelectNodesRecursive&&!1===i.itemData?.selected){const n=i.itemData?.id;e(this.dataSource,n).forEach(c=>{this.tree.instance.unselectItem(c)})}this.treeViewselected=this._dataSource.filter(n=>n.selected).map(n=>n.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(i=>i),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(i){if(i.removedItems.length){const n=i.removedItems.map(s=>s.id);this.treeViewselected=this.treeViewselected.filter(s=>void 0===n.find(c=>s===c)),this._dataSource.forEach(s=>{n.find(D=>s.id===D)&&(s.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}}static#e=this.\u0275fac=function(n){return new(n||f)};static#t=this.\u0275cmp=t.Xpm({type:f,selectors:[["app-jb-tree-view"]],viewQuery:function(n,s){if(1&n&&t.Gf(r,5),2&n){let c;t.iGM(c=t.CRH())&&(s.tree=c.first)}},inputs:{selected:"selected",dataSource:"dataSource",isViewMode:"isViewMode"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[t.TTD,t.jDz],decls:4,vars:10,consts:[["valueExpr","id","displayExpr","name",3,"value","dataSource","openOnFieldClick","multiline","disabled","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(n,s){1&n&&(t.TgZ(0,"dx-tag-box",0),t.NdJ("valueChange",function(D){return s.tagBoxSelected=D})("onSelectionChanged",function(D){return s.onTagBoxSelectionChanged(D)})("onFocusIn",function(){return s.onTagBoxFocusIn()}),t.qZA(),t.TgZ(1,"dx-popup",1),t.YNc(2,m,8,2,"dx-scroll-view",2)(3,V,2,0,"div",2),t.qZA()),2&n&&(t.Q6J("value",s.tagBoxSelected)("dataSource",s._dataSource)("openOnFieldClick",!1)("multiline",!0)("disabled",s.isViewMode),t.xp6(),t.Q6J("toolbarItems",s.popupButtonToolBars)("visible",s.popupVisible)("showTitle",!1),t.xp6(),t.Q6J("dxTemplateOf","contentTemplate"),t.xp6(),t.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[l.P,h.K,I.p6,g.u,_.x,d.U,a.N,p.v,T.ez,T.O5]})}return f})()},46203:(w,E,o)=>{o.d(E,{J:()=>I});var t=o(21137),l=o(6990),v=o(88762),e=o(19212),C=o(53009);const x=(g,_)=>_.id;function h(g,_){if(1&g){const d=e.EpF();e.TgZ(0,"div",1)(1,"dx-check-box",2),e.NdJ("click",function(p){const u=e.CHM(d).$implicit,m=e.oxw();return e.KtG(m.checkIsOnlyOneNotificationProviderDefinitionIdSelected(p,u.id))})("onValueChanged",function(p){const u=e.CHM(d).$implicit,m=e.oxw();return e.KtG(m.onValueChanged(p,u.id))}),e.qZA()()}if(2&g){const d=_.$implicit,a=e.oxw();e.xp6(),e.Q6J("text",d.name)("value",a.checkIsNotificationProviderDefinitionIdSelected(d.id))("disabled",a.isViewMode)}}let I=(()=>{class g{constructor(d){this.appRestService=d,this.isViewMode=!1,this.notificationProviderDefinitions=[],this.notificationProviderDefinitionIds=[]}ngOnInit(){this.fetchNotificationProviderDefinitions()}onValueChanged(d,a){this.updateNotificationProviderDefinitionIds(d.value,a)}fetchNotificationProviderDefinitions(){this.appRestService.request({method:"GET",url:"/api/app/notification-infos/assignable-notification-provider-definitions"}).subscribe(d=>{d.items.forEach(a=>{this.notificationProviderDefinitions.push((0,l.cloneDeep)(a))}),this.fillUpNotificationProviderDefinitionIds()})}fillUpNotificationProviderDefinitionIds(){this.cellInfo.value&&0!==this.cellInfo.value.length?this.notificationProviderDefinitionIds=[...this.cellInfo.value]:this.initNotificationProviderDefinitionIds(),this.cellInfo.setValue((0,l.cloneDeep)(this.notificationProviderDefinitionIds))}initNotificationProviderDefinitionIds(){this.notificationProviderDefinitionIds.push(this.notificationProviderDefinitions[0].id)}checkIsNotificationProviderDefinitionIdSelected(d){return this.notificationProviderDefinitionIds.includes(d)}checkIsOnlyOneNotificationProviderDefinitionIdSelected(d,a){1===this.notificationProviderDefinitionIds.length&&this.checkIsNotificationProviderDefinitionIdSelected(a)&&d.stopImmediatePropagation()}updateNotificationProviderDefinitionIds(d,a){const p=this.notificationProviderDefinitionIds.indexOf(a);d&&-1===p?this.notificationProviderDefinitionIds.push(a):!d&&-1!==p&&this.notificationProviderDefinitionIds.splice(p,1),this.cellInfo.setValue((0,l.cloneDeep)(this.notificationProviderDefinitionIds))}static#e=this.\u0275fac=function(a){return new(a||g)(e.Y36(C.$))};static#t=this.\u0275cmp=e.Xpm({type:g,selectors:[["app-notification-provider-definitions"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[e.jDz],decls:3,vars:0,consts:[[1,"row"],[1,"col-4"],[3,"text","value","disabled","click","onValueChanged"],["class","col-4"]],template:function(a,p){1&a&&(e.TgZ(0,"div",0),e.SjG(1,h,2,3,"div",3,x),e.qZA()),2&a&&(e.xp6(),e.wJu(p.notificationProviderDefinitions))},dependencies:[t.W,t.v,v.vaR]})}return g})()},36744:(w,E,o)=>{o.d(E,{b:()=>T});var t=o(86359),l=o(19212);let T=(()=>{class v{constructor(){this.isViewMode=!1,this.notificationSettingRadioGroupDataSource=[],this.notificationSettingRadioGroupValue=null}ngOnInit(){this.notificationSettingRadioGroupDataSource=[{type:"share",text:"\u5957\u7528\u5171\u7528\u8a2d\u5b9a"},{type:"custom",text:"\u53e6\u884c\u8a2d\u5b9a"}],this.notificationSettingRadioGroupValue=this.notificationSettingRadioGroupDataSource[0]}onNotificationSettingRadioGroupChanged(C){this.cellInfo.setValue("share"===C.value.type?"share":"custom")}static#e=this.\u0275fac=function(x){return new(x||v)};static#t=this.\u0275cmp=l.Xpm({type:v,selectors:[["app-notification-setting-items-radio-group"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[l.jDz],decls:2,vars:3,consts:[["displayExpr","text","layout","horizontal",3,"dataSource","value","readOnly","valueChange","onValueChanged"],["radioGroup",""]],template:function(x,h){1&x&&(l.TgZ(0,"dx-radio-group",0,1),l.NdJ("valueChange",function(g){return h.notificationSettingRadioGroupValue=g})("onValueChanged",function(g){return h.onNotificationSettingRadioGroupChanged(g)}),l.qZA()),2&x&&l.Q6J("dataSource",h.notificationSettingRadioGroupDataSource)("value",h.notificationSettingRadioGroupValue)("readOnly",h.isViewMode)},dependencies:[t._,t.I]})}return v})()},90962:(w,E,o)=>{o.d(E,{b:()=>d});var t=o(6990),T=o(74291),v=o(10518),e=o(19212),C=o(53009);const x=(a,p)=>p.notificationSettingDefinitionId;function h(a,p){if(1&a){const r=e.EpF();e.TgZ(0,"dx-select-box",6),e.NdJ("valueChange",function(m){e.CHM(r);const V=e.oxw().$implicit;return e.KtG(V.value=m)})("onValueChanged",function(m){e.CHM(r);const V=e.oxw().$index,M=e.oxw(2);return e.KtG(M.onSettingValueChanged(m,V))}),e.qZA()}if(2&a){const r=e.oxw().$implicit,u=e.oxw(2);e.Q6J("dataSource",u.selectBoxDataSource)("value",r.value)}}function I(a,p){if(1&a){const r=e.EpF();e.TgZ(0,"dx-text-box",7),e.NdJ("valueChange",function(m){e.CHM(r);const V=e.oxw().$implicit;return e.KtG(V.value=m)})("onValueChanged",function(m){e.CHM(r);const V=e.oxw().$index,M=e.oxw(2);return e.KtG(M.onSettingValueChanged(m,V))}),e.qZA()}if(2&a){const r=e.oxw().$implicit;e.Q6J("value",r.value)}}function g(a,p){if(1&a&&(e.TgZ(0,"div",3)(1,"div",2),e._uU(2),e.qZA(),e.TgZ(3,"div",4),e.YNc(4,h,1,2,"dx-select-box",5)(5,I,1,1),e.qZA()()),2&a){const r=p.$implicit,u=p.$index,m=e.oxw(2);e.xp6(2),e.hij(" ",m.displayNames[u]," "),e.xp6(2),e.um2(4,"b6b5fb16-6f45-f7ad-85e3-3a1229a3ead0"===r.notificationSettingDefinitionId?4:5)}}function _(a,p){if(1&a&&(e.TgZ(0,"label",0)(1,"span",1)(2,"span",2),e._uU(3,"\u901a\u77e5\u8a2d\u5b9a"),e.qZA()()(),e.SjG(4,g,6,2,"div",8,x)),2&a){const r=e.oxw();e.xp6(4),e.wJu(r.notificationSetting)}}let d=(()=>{class a{constructor(r){this.appRestService=r,this.isUseCustomSetting=!1,this.isViewMode=!1,this.notificationSetting=[],this.displayNames=[],this.selectBoxDataSource=["A","M"]}ngOnChanges(){this.applyNotificationSettingItems(),this.fetchCustomNotificationSettingItems(),this.clearCustomNotificationSettingItems()}applyNotificationSettingItems(){if(0===this.notificationSetting.length)return;const r=(0,t.cloneDeep)(this.notificationSetting);this.cellInfo.setValue(r)}fetchCustomNotificationSettingItems(){!this.isUseCustomSetting||this.notificationSetting.length>0||this.appRestService.request({method:"GET",url:"/api/app/notification-settings/current-tenant"}).subscribe(r=>{r.forEach(u=>{this.notificationSetting.push((0,t.cloneDeep)({notificationSettingDefinitionId:u.notificationSettingDefinition.id,value:u.notificationSetting.value||u.notificationSettingDefinition.defaultValue,isInherited:u.notificationSetting.isInherited})),this.displayNames.push(u.notificationSettingDefinition.displayName)}),this.applyNotificationSettingItems()})}clearCustomNotificationSettingItems(){this.isUseCustomSetting||0===this.notificationSetting.length||this.cellInfo.setValue(null)}onSettingValueChanged(r,u){this.notificationSetting[u].value=r.value,this.applyNotificationSettingItems()}static#e=this.\u0275fac=function(u){return new(u||a)(e.Y36(C.$))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-notification-setting-items"]],inputs:{isUseCustomSetting:"isUseCustomSetting",cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[e.TTD,e.jDz],decls:1,vars:1,consts:[[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[1,"d-flex","align-items-center","mb-3"],[1,"ps-3","pe-3"],["valueChangeEvent","keyup",3,"dataSource","value"],["valueChangeEvent","keyup",3,"dataSource","value","valueChange","onValueChanged"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","d-flex align-items-center mb-3"]],template:function(u,m){1&u&&e.YNc(0,_,6,0),2&u&&e.um2(0,m.isUseCustomSetting?0:-1)},dependencies:[T.a,T.I,v.D,v._]})}return a})()},98991:(w,E,o)=>{o.d(E,{D:()=>T});var t=o(26600),l=o(19212);let T=(()=>{class v{constructor(){this.isViewMode=!1,this.hideReceiverTreeView=!1,this.selected=["1","1-1-1","2-1"],this.dataSource=[{id:"1",name:"1"},{id:"1-1",name:"1-1",parentId:"1"},{id:"1-1-1",name:"1-1-1",parentId:"1-1"},{id:"1-1-2",name:"1-1-2",parentId:"1-1"},{id:"2",name:"2"},{id:"2-1",name:"2-1",parentId:"2"},{id:"2-1-1",name:"2-1-1",parentId:"2-1"},{id:"2-1-2",name:"2-1-2",parentId:"2-1"},{id:"2-1-3",name:"2-1-3",parentId:"2-1"}]}selectedChange(C){this.selected=C}static#e=this.\u0275fac=function(x){return new(x||v)};static#t=this.\u0275cmp=l.Xpm({type:v,selectors:[["app-receiver-group-tree-view"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTreeView:"hideReceiverTreeView"},standalone:!0,features:[l.jDz],decls:6,vars:4,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[3,"selected","dataSource","isViewMode","selectedChange"]],template:function(x,h){1&x&&(l.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),l._uU(4," \u63a5\u6536\u7fa4\u7d44 (\u591a\u7b46) "),l.qZA()()(),l.TgZ(5,"app-jb-tree-view",4),l.NdJ("selectedChange",function(g){return h.selectedChange(g)}),l.qZA()()),2&x&&(l.Q6J("hidden",h.hideReceiverTreeView),l.xp6(5),l.Q6J("selected",h.selected)("dataSource",h.dataSource)("isViewMode",h.isViewMode))},dependencies:[t.c]})}return v})()},38653:(w,E,o)=>{o.d(E,{k:()=>h});var t=o(96814),l=o(61157),T=o(37398),v=o(66648),e=o(19212),C=o(88762),x=o(24106);let h=(()=>{class I{constructor(_,d){this.restService=_,this.localizationService=d,this.isViewMode=!1,this.hideReceiverTagBox=!1,this.receiversDataSource$=null,this.currentDataField="",this.receivers=[]}ngOnChanges(_){window.component=this,!this.hideReceiverTagBox&&this.receivers.length>0&&this.cellInfo.setValue([...this.receivers])}ngOnInit(){this.currentDataField=this.cellInfo.column.dataField,this.cellInfo.column.validationRules=[{type:"custom",message:this.localizationService.instant("AbpValidation::ThisFieldIsRequired."),validationCallback:this.receiverTagBoxValidationCallback}],this.receiversDataSource$=this.restService.request({method:"GET",url:"/api/app/notification-infos/assignable-receivers"}).pipe((0,T.U)(_=>_.items))}onValueChanged(_){this.receivers=[..._.value],this.cellInfo.setValue(_.value)}receiverTagBoxValidationCallback(_){return!!(_.data.isForAllReceivers||_.data[_.column.dataField]&&0!==_.data[_.column.dataField].length)}static#e=this.\u0275fac=function(d){return new(d||I)(e.Y36(C.vgb),e.Y36(C.oQ8))};static#t=this.\u0275cmp=e.Xpm({type:I,selectors:[["app-receiver-tag-box"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTagBox:"hideReceiverTagBox"},standalone:!0,features:[e.TTD,e.jDz],decls:7,vars:6,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["appTagBox","","receiverTagBox","","displayExpr","name","valueExpr","id","validationMessageMode","always",3,"dataSource","value","disabled","onValueChanged"]],template:function(d,a){1&d&&(e.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),e._uU(4," \u63a5\u6536\u8005 (\u591a\u7b46) "),e.qZA()()(),e.TgZ(5,"dx-tag-box",4),e.NdJ("onValueChanged",function(r){return a.onValueChanged(r)}),e.ALo(6,"async"),e.qZA()()),2&d&&(e.Q6J("hidden",a.hideReceiverTagBox),e.xp6(5),e.Q6J("dataSource",e.lcZ(6,4,a.receiversDataSource$))("value",a.cellInfo.value)("disabled",a.isViewMode))},dependencies:[l._,l.U,t.ez,t.Ov,v.m,x.x],styles:["dx-tag-box[apptagbox][receiverTagBox] .dx-overlay-wrapper.dx-invalid-message.dx-invalid-message-always{width:100%!important}"]})}return I})()}}]);