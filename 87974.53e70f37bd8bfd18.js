"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[87974],{87974:(P,p,a)=>{a.r(p),a.d(p,{NotificationSettingsModule:()=>R});var x=a(96814),C=a(31610),u=a(88762),g=a(23758);const S=[{dataField:"items",template:"notification-setting-definition",label:{visible:!1}}];var T=a(37398),m=a(99397),f=a(94664),v=a(6990),t=a(19212),y=a(53009),N=a(24270),D=a(10829),I=a(71036),A=a(16358),F=a(20843),Z=a(61708),J=a(66782),V=a(609),M=a(10518),E=a(74291),G=a(21137);function H(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"dx-select-box",9),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.saveAndDisplayTenantId=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.onTenantChanged(n))}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(),t.Q6J("dataSource",e.tenantsLookupDataSource)("value",e.saveAndDisplayTenantId)}}function Q(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",10)(2,"div",11),t._uU(3),t.qZA(),t.TgZ(4,"div",12)(5,"dx-text-box",13),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.item.value=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw();return t.KtG(o.onSettingValueChanged(n))}),t.qZA()(),t.TgZ(6,"div")(7,"dx-button",14),t.NdJ("onClick",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.item.value=n.item.defaultValue)}),t.ALo(8,"abpLocalization"),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.item.displayName," "),t.xp6(2),t.Q6J("value",e.item.value),t.xp6(2),t.Q6J("text",t.lcZ(8,3,"::\u9084\u539f\u9810\u8a2d\u503c"))}}const K=(i,d)=>d.id;function $(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"dx-text-box",13),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(n))}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function j(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"dx-date-box",17),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(n))}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function L(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"dx-number-box",13),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(n))}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function k(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"dx-check-box",13),t.NdJ("valueChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=n)})("onValueChanged",function(n){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(n))}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function w(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"div",10)(1,"div",11),t._uU(2),t.qZA(),t.TgZ(3,"div",12),t.YNc(4,$,1,1,"dx-text-box",15)(5,j,1,1,"dx-date-box",16)(6,L,1,1,"dx-number-box",15)(7,k,1,1,"dx-check-box",15),t.qZA(),t.TgZ(8,"div")(9,"dx-button",14),t.NdJ("onClick",function(){const o=t.CHM(e).$implicit;return t.KtG(o.value=o.defaultValue)}),t.ALo(10,"abpLocalization"),t.qZA()()()}if(2&i){const e=d.$implicit;t.xp6(2),t.hij(" ",e.displayName," "),t.xp6(2),t.Q6J("ngIf","string"===e.dataType),t.xp6(),t.Q6J("ngIf","datetime"===e.dataType),t.xp6(),t.Q6J("ngIf","int"===e.dataType),t.xp6(),t.Q6J("ngIf","bool"===e.dataType),t.xp6(2),t.Q6J("text",t.lcZ(10,6,"::\u9084\u539f\u9810\u8a2d\u503c"))}}function U(i,d){if(1&i&&(t.TgZ(0,"div"),t.SjG(1,w,11,8,"div",18,K),t.qZA()),2&i){const e=t.oxw();t.xp6(),t.wJu(e.formData.items)}}const z=[{path:"",component:(()=>{class i{constructor(e,s,n,o){this.appRestService=e,this.configStateService=s,this.toastService=n,this.lookupDataSourceService=o,this.formItems=S,this.formData={items:[]},this.isDirty=!1,this.isSaveAndDisplayTenantIdFirstChanged=!0,this.getSettingUrl=c=>c?`/api/app/jbnotifier-admin/notification-settings?SpecifiedTenantId=${c}`:"/api/app/jbnotifier-admin/notification-settings",this.getSettings=c=>{const l=this.getSettingUrl(c);return this.appRestService.request({method:"GET",url:l}).pipe((0,T.U)(_=>{const h=_.map(r=>{const B=((i,d)=>{switch(d){case"int":return parseInt(i,10);case"string":return String(i);case"datetime":return new Date(i);case"bool":return"true"===i;default:throw new Error(`Unsupported data type: ${d}`)}})(r.notificationSetting.value,r.notificationSettingDefinition.dataType);return{notificationSettingDefinitionId:r.notificationSettingDefinition.id,value:B,isInherited:r.notificationSetting.isInherited,defaultValue:r.notificationSettingDefinition.defaultValue,displayName:r.notificationSettingDefinition.displayName,dataType:r.notificationSettingDefinition.dataType}});return this.originSettings=(0,v.cloneDeep)(h),{items:h}})).pipe((0,m.b)(_=>{this.formData=_}))},this.saveSettings=()=>{const c=this.formData.items.map(l=>({notificationSettingDefinitionId:l.notificationSettingDefinitionId,value:String(l.value),isInherited:l.isInherited}));this.appRestService.request({method:"PUT",url:`/api/app/jbnotifier-admin/notification-settings?SpecifiedTenantId=${this.saveAndDisplayTenantId}`,body:c}).pipe((0,f.w)(()=>this.getSettings(this.saveAndDisplayTenantId))).subscribe(()=>{this.toastService.success("\u5132\u5b58\u6210\u529f!")})}}ngOnInit(){this.currentTenantId=this.configStateService.getOne("currentUser").tenantId,this.currentTenantId&&(this.saveAndDisplayTenantId=this.currentTenantId),this.currentTenantId?this.getSettings(this.currentTenantId).subscribe():this.getTenantLookup().pipe((0,f.w)(e=>this.getSettings(this.saveAndDisplayTenantId))).subscribe()}getTenantLookup(){return this.tenantsLookupDataSource=this.lookupDataSourceService.getLookupDataSource({dataField:"tenant",path:"/api/app/jbnotifier-admin/notification-settings/tenant-lookup"}),this.appRestService.request({method:"GET",url:"/api/app/jbnotifier-admin/notification-settings/tenant-lookup?MaxResultCount=1"}).pipe((0,m.b)(e=>{this.saveAndDisplayTenantId=e.items[0]?.id}))}onTenantChanged(e){this.saveAndDisplayTenantId=e.value,this.isSaveAndDisplayTenantIdFirstChanged||this.getSettings(this.saveAndDisplayTenantId).subscribe(),this.isSaveAndDisplayTenantIdFirstChanged&&(this.isSaveAndDisplayTenantIdFirstChanged=!1)}onSettingValueChanged(){const e=!(0,v.isEqual)(this.originSettings,this.formData.items);this.isDirty=e}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(y.$),t.Y36(u.XJE),t.Y36(N.P),t.Y36(D.V))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-notification-settings"]],decls:13,vars:12,consts:[[1,"paper-1","d-flex","flex-column","align-items-center","h-100"],[1,"flex-grow-1","d-flex","flex-column","justify-content-center"],[1,"mb-3"],[1,"dx-form-group-caption","text-center","mb-2"],[4,"ngIf"],["appFormFeature","",3,"items","formData"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","justify-content-center"],["type","default",3,"text","disabled","onClick"],["displayExpr","displayName","valueExpr","id",3,"dataSource","value","valueChange","onValueChanged"],[1,"d-flex","align-items-center","mb-3"],[1,"dx-field-item-label-text"],[1,"ps-3","pe-3"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["icon","refresh",3,"text","onClick"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged",4,"ngIf"],["valueChangeEvent","keyup","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange","onValueChanged",4,"ngIf"],["valueChangeEvent","keyup","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange","onValueChanged"],["class","d-flex align-items-center mb-3"]],template:function(s,n){1&s&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4),t.ALo(5,"abpLocalization"),t.qZA(),t.YNc(6,H,2,2,"div",4),t.qZA(),t.TgZ(7,"dx-form",5),t.YNc(8,Q,9,5,"div",6)(9,U,3,0,"div",6),t.qZA()(),t.TgZ(10,"div",7)(11,"dx-button",8),t.NdJ("onClick",function(){return n.saveSettings()}),t.ALo(12,"abpLocalization"),t.qZA()()()),2&s&&(t.xp6(4),t.hij(" ",t.lcZ(5,8,"JbNotifier::Permission:NotificationSettings")," "),t.xp6(2),t.Q6J("ngIf",!n.currentTenantId),t.xp6(),t.Q6J("items",n.formItems)("formData",n.formData),t.xp6(),t.Q6J("dxTemplateOf","string"),t.xp6(),t.Q6J("dxTemplateOf","notification-setting-definition"),t.xp6(2),t.Q6J("text",t.lcZ(12,10,"AbpUi::Save"))("disabled",!n.isDirty))},dependencies:[x.O5,I._,A.K,F.p6,Z.G,J.M,V.Y,M._,E.I,G.v,u.fuE],encapsulation:2})}return i})(),canActivate:[u.a1M,u.nG9]}];let Y=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(z),g.Bz]})}return i})();var O=a(5533);let R=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[x.ez,Y,C.m,O.P]})}return i})()}}]);