"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[10486],{10486:(tt,m,a)=>{a.r(m),a.d(m,{InstantNotificationInfosModule:()=>q});var c=a(96814),C=a(66648),p=a(88762),f=a(23758),r=a(35461),g=a(85054);const S=[{type:"buttons",fixed:!0,buttons:[{name:"edit",template:"grid-view-button"},{name:"delete",template:"grid-delete-button"}]},{dataField:"id",visible:!1},{dataField:"concurrencyStamp",visible:!1},{dataField:"title",caption:"\u6a19\u984c",dataType:"string",filterOperations:r.I.text,validationRules:[g.L]},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string",filterOperations:r.I.text},{name:"notificationCategoryName",caption:"\u5206\u985e\u540d\u7a31",dataType:"string",filterOperations:r.I.text},{name:"notificationProviderNames",caption:"\u901a\u77e5\u63d0\u4f9b\u8005\u540d\u7a31 (\u591a\u7b46)",dataType:"string",filterOperations:r.I.text},{dataField:"pushTime",caption:"\u63a8\u9001\u6642\u9593",dataType:"datetime",filterOperations:r.I.date,format:"yyyy/MM/dd HH:mm:ss"},{name:"receiverDescription",caption:"\u63a5\u6536\u8005\u63cf\u8ff0",dataType:"string",filterOperations:r.I.text},{dataField:"notificationDataFetchEndpoint",caption:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint",dataType:"string",filterOperations:r.I.text},{dataField:"hookEndpoint",caption:"Hook",dataType:"string",filterOperations:r.I.text},{dataField:"isFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean"},{dataField:"isDeletable",caption:"\u662f\u5426\u53ef\u522a\u9664",dataType:"boolean"},{dataField:"isEditable",caption:"\u662f\u5426\u53ef\u7de8\u8f2f",dataType:"boolean"},{dataField:"notificationProviderDefinitionIds",caption:"\u901a\u77e5\u63d0\u4f9b\u8005id (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"notification-provider-definition"},{dataField:"isForAllReceivers",caption:"\u662f\u5426\u50b3\u9001\u7d66\u6240\u6709\u63a5\u6536\u8005",dataType:"boolean",visible:!1},{dataField:"receiverIds",caption:"\u63a5\u6536\u8005 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receivers-tag-box"},{dataField:"receiverGroupIds",caption:"\u63a5\u6536\u7fa4\u7d44 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receiver-groups-tag-box"},{dataField:"notificationSettingRadioGroup",caption:"\u901a\u77e5\u8a2d\u5b9a",dataType:"object",visible:!1,editCellTemplate:"notification-setting-radio-group"},{dataField:"notificationSettingItems",caption:"\u901a\u77e5\u8a2d\u5b9a\u9805\u76ee",dataType:"object",visible:!1,editCellTemplate:"notification-setting-items"},{dataField:"notificationCategoryId",caption:"\u901a\u77e5\u5206\u985e Id",dataType:"string",visible:!1,validationRules:[g.L]},{dataField:"subtitle",caption:"\u5b50\u6a19\u984c",dataType:"string",visible:!1},{dataField:"textContent",caption:"\u6587\u5b57\u5167\u5bb9",dataType:"string",visible:!1},{dataField:"isFetchNotificationDataByEachReceiver",caption:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599",dataType:"string",visible:!1},{dataField:"htmlContent",caption:"Html \u5167\u5bb9",dataType:"string",visible:!1}],u={index:"/api/app/instant-notification-infos",get:"/api/app/instant-notification-infos",create:"/api/app/instant-notification-infos",update:"/api/app/instant-notification-infos",delete:"/api/app/instant-notification-infos"},R=[{dataField:"notificationCategoryId",path:"/api/app/notification-infos/assignable-notification-categories",pathForSelectedDisplay:"/api/app/notification-categories"}],v=[{dataField:"id",mapping:["id"]},{dataField:"concurrencyStamp",mapping:["concurrencyStamp"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenantName"]},{name:"notificationCategoryName",queryStringKey:"NotificationCategoryName",mapping:["notificationCategoryName"]},{name:"notificationProviderNames",queryStringKey:"NotificationProviderNames",mapping:["notificationProviderNames"]},{name:"pushTime",queryStringKey:"PushTime",mapping:["pushTime"]},{name:"receiverDescription",queryStringKey:"ReceiverDescription",mapping:["receiverDescription"]},{name:"isFinished",queryStringKey:"IsFinished",mapping:["isFinished"]},{name:"isDeletable",queryStringKey:"IsDeletable",mapping:["isDeletable"]},{name:"isEditable",queryStringKey:"IsEditable",mapping:["isEditable"]},{dataField:"tenantId",mapping:["tenantId"]},{dataField:"notificationProviderDefinitionIds",mapping:["notificationProviderDefinitionIds"]},{dataField:"isForAllReceivers",mapping:["isForAllReceivers"]},{dataField:"receiverIds",mapping:["receiverIds"]},{dataField:"receiverGroupIds",mapping:["receiverGroupIds"]},{dataField:"notificationSettingItems",mapping:["notificationSettingItems"]},{dataField:"notificationCategoryId",mapping:["notificationCategoryId"]},{dataField:"title",queryStringKey:"Title",mapping:["title"]},{dataField:"subtitle",mapping:["subtitle"]},{dataField:"textContent",mapping:["textContent"]},{dataField:"notificationDataFetchEndpoint",queryStringKey:"NotificationDataFetchEndpoint",mapping:["notificationDataFetchEndpoint"]},{dataField:"isFetchNotificationDataByEachReceiver",mapping:["isFetchNotificationDataByEachReceiver"]},{dataField:"hookEndpoint",queryStringKey:"HookEndpoint",mapping:["hookEndpoint"]},{dataField:"htmlContent",mapping:["htmlContent"]},{dataField:"notificationSchedulePlans",mapping:["notificationSchedulePlans"]}],x={imageUpload:{fileUploadMode:"both",tabs:["url","file"]},toolbar:{items:[{name:"undo"},{name:"redo"},{name:"separator"},{name:"size",acceptedValues:["8pt","10pt","12pt","14pt","18pt","24pt","36pt"]},{name:"font",acceptedValues:["Arial","Georgia","Tahoma","Times New Roman","Verdana"]},{name:"separator"},{name:"bold"},{name:"italic"},{name:"strike"},{name:"underline"},{name:"separator"},{name:"alignLeft"},{name:"alignCenter"},{name:"alignRight"},{name:"alignJustify"},{name:"separator"},{name:"orderedList"},{name:"bulletList"},{name:"separator"},{name:"header",acceptedValues:[!1,1,2,3,4,5]},{name:"separator"},{name:"color"},{name:"background"},{name:"separator"},{name:"link"},{name:"image"},{name:"separator"},{name:"clear"},{name:"codeBlock"},{name:"blockquote"},{name:"separator"},{name:"insertTable"},{name:"deleteTable"},{name:"insertRowAbove"},{name:"insertRowBelow"},{name:"deleteRow"},{name:"insertColumnLeft"},{name:"insertColumnRight"},{name:"deleteColumn"},{name:"cellProperties"},{name:"tableProperties"}]}},y=[{itemType:"group",name:"basicGroup",caption:"\u57fa\u672c",colCount:2,items:[{dataField:"notificationProviderDefinitionIds"},{itemType:"group",name:"receiverGroup",colCount:2,items:[{dataField:"isForAllReceivers",editorType:"dxCheckBox"},{itemType:"empty"},{dataField:"receiverIds",label:{visible:!1}},{dataField:"receiverGroupIds",label:{visible:!1}}]}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u8a2d\u5b9a",colCount:2,items:[{dataField:"notificationSettingRadioGroup",label:{visible:!1}},{dataField:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"notificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",colCount:2,items:[{dataField:"notificationCategoryId",editorType:"dxSelectBox"},{dataField:"title",editorType:"dxTextBox"},{itemType:"group",name:"textboxGroup",items:[{dataField:"subtitle",editorType:"dxTextBox"},{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox"},{dataField:"hookEndpoint",editorType:"dxTextBox"}]},{itemType:"group",name:"textareaGroup",items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"100px"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox"}]},{dataField:"htmlContent",colSpan:2,editorType:"dxHtmlEditor",editorOptions:{...x,height:"250px"}}]}],_=[{itemType:"group",name:"basicGroup",caption:"\u57fa\u672c",colCount:2,items:[{dataField:"notificationProviderDefinitionIds"},{itemType:"group",name:"receiverGroup",colCount:2,items:[{dataField:"isForAllReceivers",editorType:"dxCheckBox",editorOptions:{disabled:!0}},{itemType:"empty"},{dataField:"receiverIds",label:{visible:!1}},{dataField:"receiverGroupIds",label:{visible:!1}}]}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u8a2d\u5b9a",colCount:2,items:[{dataField:"notificationSettingRadioGroup",label:{visible:!1}},{dataField:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"notificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",colCount:2,items:[{dataField:"notificationCategoryId",editorType:"dxSelectBox",editorOptions:{disabled:!0}},{dataField:"title",editorType:"dxTextBox",editorOptions:{disabled:!0}},{itemType:"group",name:"textboxGroup",items:[{dataField:"subtitle",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox",editorOptions:{disabled:!0}},{dataField:"hookEndpoint",editorType:"dxTextBox",editorOptions:{disabled:!0}}]},{itemType:"group",name:"textareaGroup",items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"100px",disabled:!0}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox",editorOptions:{disabled:!0}}]},{dataField:"htmlContent",colSpan:2,editorType:"dxHtmlEditor",editorOptions:{...x,height:"250px",disabled:!0}}]}],N={form:{colCount:1,items:y}},w={form:{colCount:1,items:_},popup:{wrapperAttr:{class:"instant-notification-infos-view"},toolbarItems:[]}};var t=a(19212),O=a(67),D=a(72783),V=a(53009),E=a(20843),F=a(2173),A=a(25012),M=a(43821),B=a(10313),I=a(46203),h=a(38653),T=a(36744),b=a(90962);const G=["grid"];function U(i,s){if(1&i&&t._UZ(0,"app-grid-general-filter",10),2&i){t.oxw();const e=t.MAs(1);t.Q6J("grid",e)}}function P(i,s){1&i&&t.GkF(0)}const k=i=>({$implicit:i});function J(i,s){if(1&i&&(t.ynx(0),t.YNc(1,P,1,0,"ng-container",12),t.BQk()),2&i){const e=s.$implicit,n=t.oxw().$implicit,o=t.oxw();t.xp6(),t.Q6J("ngTemplateOutlet",o.templateStore.getGridTemplates(n.key))("ngTemplateOutletContext",t.VKq(2,k,e))}}function Q(i,s){if(1&i&&(t.ynx(0),t.YNc(1,J,2,4,"ng-container",11),t.BQk()),2&i){const e=s.$implicit;t.xp6(),t.Q6J("dxTemplateOf",e.key)}}function K(i,s){if(1&i&&t._UZ(0,"app-notification-provider-definitions",13),2&i){const e=s.$implicit,n=t.oxw();t.Q6J("cellInfo",e)("isViewMode",n.isViewMode)}}function Z(i,s){if(1&i&&t._UZ(0,"app-receiver-tag-box",14),2&i){const e=s.$implicit,n=t.oxw();t.Q6J("isForAllReceivers",n.isForAllReceivers)("cellInfo",e)("isViewMode",n.isViewMode)}}function L(i,s){if(1&i&&t._UZ(0,"app-receiver-tag-box",14),2&i){const e=s.$implicit,n=t.oxw();t.Q6J("isForAllReceivers",n.isForAllReceivers)("cellInfo",e)("isViewMode",n.isViewMode)}}function $(i,s){if(1&i&&t._UZ(0,"app-notification-setting-items-radio-group",13),2&i){const e=s.$implicit,n=t.oxw();t.Q6J("cellInfo",e)("isViewMode",n.isViewMode)}}function Y(i,s){if(1&i&&t._UZ(0,"app-notification-setting-items",15),2&i){const e=s.$implicit,n=t.oxw();t.Q6J("isUseCustomSetting",n.isUseCustomSetting)("cellInfo",e)("isViewMode",n.isViewMode)}}const H=()=>({type:"default",stylingMode:"contained"}),j=[{path:"",component:(()=>{class i{constructor(e,n,o,d){this.gridDataSourceService=e,this.templateStore=n,this.configStateService=o,this.appRestService=d,this.columns=S,this.cRUDEndpoints=u,this.dataFieldLookupSourceMapping=R,this.relatedDataValueAndQueryStringKeyMapping=v,this.editingPropertiesForCreating=N,this.editingPropertiesForUpdating=w,this.isViewMode=!1,this.isForAllReceivers=!1,this.isUseCustomSetting=!1,this.tenantId="",this.editingPropertiesForUpdating.popup.toolbarItems=[{widget:"dxButton",location:"after",toolbar:"bottom",options:{text:"\u78ba\u8a8d",onClick:()=>{this.grid.instance.cancelEditData()}}}]}ngOnInit(){this.gridDataSource=this.gridDataSourceService.getDataSource(u,v),this.configStateService.getOne$("currentUser").subscribe(e=>{this.tenantId=e.tenantId})}onInitNewRow(e){e.component.instance().resetOption("editing.popup"),e.data.tenantId=this.tenantId,e.data.isFetchNotificationDataByEachReceiver=!1,e.data.isForAllReceivers=!1}onEditingStart(e){this.isViewMode=!0,this.appRestService.request({method:"GET",url:`/api/app/instant-notification-infos/${e.data.id}`}).subscribe(n=>{const o=e.component.instance().getRowIndexByKey(e.key);e.component.instance().cellValue(o,"notificationProviderDefinitionIds",n.notificationProviderDefinitionIds),e.component.instance().cellValue(o,"isForAllReceivers",n.isForAllReceivers),e.component.instance().cellValue(o,"receiverIds",n.receiverIds),e.component.instance().cellValue(o,"notificationCategoryId",n.notificationCategoryId),e.component.instance().cellValue(o,"subtitle",n.subtitle),e.component.instance().cellValue(o,"textContent",n.textContent),e.component.instance().cellValue(o,"isFetchNotificationDataByEachReceiver",n.isFetchNotificationDataByEachReceiver),e.component.instance().cellValue(o,"htmlContent",n.htmlContent),e.component.instance().cellValue(o,"hookEndpoint",n.hookEndpoint),e.component.instance().cellValue(o,"notificationDataFetchEndpoint",n.notificationDataFetchEndpoint),n.notificationSettingItems?.length>0&&(this.isUseCustomSetting=!0,e.component.instance().cellValue(o,"notificationSettingItems",n.notificationSettingItems))})}onOptionChanged(e){"editing.changes"!==e.fullName||!e.value[0]||!e.value[0].data||(this.checkIsForAllReceivers(e),this.checkIsUseCustomSetting(e))}onRowValidating(e){this.validateIsForAllReceivers(e)}checkIsForAllReceivers(e){"isForAllReceivers"in e.value[0].data&&this.isForAllReceivers!==e.value[0].data.isForAllReceivers&&(this.isForAllReceivers=e.value[0].data.isForAllReceivers)}checkIsUseCustomSetting(e){e.value[0].data.notificationSettingRadioGroup&&(this.isUseCustomSetting&&"custom"===e.value[0].data.notificationSettingRadioGroup||(this.isUseCustomSetting="custom"===e.value[0].data.notificationSettingRadioGroup))}validateIsForAllReceivers(e){e.newData.isForAllReceivers&&(e.isValid=!0,e.newData.receiverIds=[],e.newData.receiverGroupIds=[])}resetOption(){this.isForAllReceivers=!1,this.isUseCustomSetting=!1,this.isViewMode=!1}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(O.I),t.Y36(D.z),t.Y36(p.XJE),t.Y36(V.$))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-instant-notification"]],viewQuery:function(n,o){if(1&n&&t.Gf(G,5),2&n){let d;t.iGM(d=t.CRH())&&(o.grid=d.first)}},decls:14,vars:16,consts:[["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","onEditCanceled","onRowInserted","onInitNewRow","onEditingStart","onOptionChanged","onRowValidating"],["grid",""],["name","addRowButton","location","before","widget","dxButton","cssClass","mb-1",3,"options"],["location","after"],[3,"grid",4,"dxTemplate"],["name","applyFilterButton","cssClass","d-none"],[4,"ngFor","ngForOf"],[3,"cellInfo","isViewMode",4,"dxTemplate","dxTemplateOf"],[3,"isForAllReceivers","cellInfo","isViewMode",4,"dxTemplate","dxTemplateOf"],[3,"isUseCustomSetting","cellInfo","isViewMode",4,"dxTemplate","dxTemplateOf"],[3,"grid"],[4,"dxTemplate","dxTemplateOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"cellInfo","isViewMode"],[3,"isForAllReceivers","cellInfo","isViewMode"],[3,"isUseCustomSetting","cellInfo","isViewMode"]],template:function(n,o){1&n&&(t.TgZ(0,"dx-data-grid",0,1),t.NdJ("onEditCanceled",function(){return o.resetOption()})("onRowInserted",function(){return o.resetOption()})("onInitNewRow",function(l){return o.onInitNewRow(l)})("onEditingStart",function(l){return o.onEditingStart(l)})("onOptionChanged",function(l){return o.onOptionChanged(l)})("onRowValidating",function(l){return o.onRowValidating(l)}),t.TgZ(2,"dxo-toolbar"),t._UZ(3,"dxi-item",2),t.TgZ(4,"dxi-item",3),t.YNc(5,U,1,1,"app-grid-general-filter",4),t.qZA(),t._UZ(6,"dxi-item",5),t.qZA(),t.YNc(7,Q,2,1,"ng-container",6),t.ALo(8,"keyvalue"),t.YNc(9,K,1,2,"app-notification-provider-definitions",7)(10,Z,1,3,"app-receiver-tag-box",8)(11,L,1,3,"app-receiver-tag-box",8)(12,$,1,2,"app-notification-setting-items-radio-group",7)(13,Y,1,3,"app-notification-setting-items",9),t.qZA()),2&n&&(t.Q6J("datafieldValueQueryStringKeyMapping",o.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",o.dataFieldLookupSourceMapping)("editingPropertiesForCreating",o.editingPropertiesForCreating)("editingPropertiesForUpdating",o.editingPropertiesForUpdating)("columns",o.columns)("dataSource",o.gridDataSource),t.xp6(3),t.Q6J("options",t.DdM(15,H)),t.xp6(4),t.Q6J("ngForOf",t.lcZ(8,13,o.templateStore.gridTemplates)),t.xp6(2),t.Q6J("dxTemplateOf","notification-provider-definition"),t.xp6(),t.Q6J("dxTemplateOf","receivers-tag-box"),t.xp6(),t.Q6J("dxTemplateOf","receiver-groups-tag-box"),t.xp6(),t.Q6J("dxTemplateOf","notification-setting-radio-group"),t.xp6(),t.Q6J("dxTemplateOf","notification-setting-items"))},dependencies:[c.sg,c.tP,E.p6,F.ZT3,A.e,F.y1f,M._,B.w,I.J,h.k,T.b,b.b,c.Nd],styles:[".instant-notification-infos-view .dx-state-disabled.dx-widget{opacity:1}  .instant-notification-infos-view .dx-checkbox.dx-checkbox-checked.dx-state-disabled .dx-checkbox-icon{background-color:#03a9f4}  .instant-notification-infos-view .dx-state-readonly .dx-item-selected .dx-radiobutton-icon{border-color:#03a9f4}  .instant-notification-infos-view .dx-state-readonly .dx-item-selected .dx-radiobutton-icon-dot{background-color:#03a9f4}  .instant-notification-infos-view .dx-radiobutton.dx-state-active .dx-radiobutton-icon-checked:after,   .instant-notification-infos-view .dx-radiobutton.dx-state-focused .dx-radiobutton-icon-checked:after{background-color:initial;transform:scale(0)}  .instant-notification-infos-view .dx-radiobutton.dx-state-hover{cursor:default}  .instant-notification-infos-view .dx-texteditor.dx-editor-filled.dx-state-disabled .dx-texteditor-input{color:inherit}"]})}return i})(),canActivate:[p.a1M,p.nG9]}];let z=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[f.Bz.forChild(j),f.Bz]})}return i})();var X=a(77490),W=a(68862);let q=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[c.ez,z,X.P,W.O,C.m,I.J,h.k,T.b,b.b]})}return i})()}}]);