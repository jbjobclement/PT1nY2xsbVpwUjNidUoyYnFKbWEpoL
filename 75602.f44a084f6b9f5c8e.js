"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[75602],{75602:(q,g,n)=>{n.r(g),n.d(g,{ReceiverGroupsModule:()=>W});var c=n(96814),b=n(31610),l=n(88762),m=n(23758),v=n(35461),f=n(85054);const C=[{type:"buttons",fixed:!0,buttons:[{name:"save",template:"grid-save-button"},{name:"edit",template:"grid-edit-button"},{name:"delete",template:"grid-delete-button"},{name:"cancel",template:"grid-cancel-button"}]},{dataField:"id",dataType:"string",visible:!1},{dataField:"idCode",caption:"idCode",dataType:"string",validationRules:[f.L],filterOperations:v.I.text},{dataField:"name",caption:"\u63a5\u6536\u8005\u7fa4\u7d44\u540d\u7a31",dataType:"string",validationRules:[f.L],filterOperations:v.I.text},{dataField:"sortingNumber",caption:"\u9806\u5e8f",dataType:"number",visible:!1},{dataField:"tenantId",caption:"",dataType:"string",visible:!1},{dataField:"subTenantId",caption:"\u5b50\u79df\u6236",dataType:"string",visible:!1},{name:"subTenantName",caption:"",dataType:"string",visible:!1},{dataField:"receiverIds",dataType:"object",caption:"\u63a5\u6536\u8005",visible:!1,editCellTemplate:"receiverIds"},{dataField:"parentReceiverGroupId",caption:"",dataType:"string",visible:!1},{dataField:"concurrencyStamp",visible:!1}],h={index:"/api/app/receiver-groups",get:"/api/app/receiver-groups",create:"/api/app/receiver-groups",update:"/api/app/receiver-groups",delete:"/api/app/receiver-groups"},R=[{dataField:"subTenantId",path:"/api/app/receiver-groups/sub-tenant-lookup"},{dataField:"receiverIds",path:"/api/app/receiver-groups/receiver-lookup"}],I=[],T=[{dataField:"id",mapping:["receiverGroup","id"]},{dataField:"concurrencyStamp",mapping:["receiverGroup","concurrencyStamp"]},{dataField:"receiverIds",queryStringKey:"receivers",mapping:["receivers"]},{dataField:"name",queryStringKey:"Name",mapping:["receiverGroup","name"]},{dataField:"idCode",queryStringKey:"IdCode",mapping:["receiverGroup","idCode"]},{dataField:"sortingNumber",queryStringKey:"SortingNumber",mapping:["receiverGroup","sortingNumber"]},{dataField:"subTenantId",queryStringKey:"SubTenantId",mapping:["subTenant","id"]},{dataField:"subTenantName",queryStringKey:"SubTenantName",mapping:["subTenant","name"]}],G={popup:{title:"::\u65b0\u589e",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"idCode",editorType:"dxTextBox"},{dataField:"name",editorType:"dxTextBox"},{dataField:"subTenantId",editorType:"dxSelectBox",editorOptions:{displayExpr:"displayName"}},{dataField:"receiverIds",label:{visible:!1}},{dataField:"sortingNumber",editorType:"dxNumberBox"}],elementAttr:{class:"custom-form custom-form--edit"}}},_={popup:{title:"::\u7de8\u8f2f",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:500},form:{colCount:1,items:[{dataField:"name",editorType:"dxTextBox"},{dataField:"sortingNumber",editorType:"dxNumberBox"},{dataField:"receiverIds",label:{visible:!1}}],elementAttr:{class:"custom-form custom-form--edit"}}};var e=n(19212),D=n(67),M=n(72783),N=n(67846),O=n(39150),V=n(65343),u=n(95051);let A=(()=>{class i{constructor(t){this.treeView=t,this.treeView.hoverStateEnabled=!1,this.treeView.focusStateEnabled=!1,this.treeView.activeStateEnabled=!1}static#e=this.\u0275fac=function(r){return new(r||i)(e.Y36(u.u))};static#t=this.\u0275dir=e.lG2({type:i,selectors:[["","appTreeView",""]],standalone:!0})}return i})();var P=n(92931),K=n(16358),J=n(20843),y=n(2173),Q=n(25012),x=n(12305),S=n(44932);const Z=["grid"],B=["treeview"];function E(i,p){1&i&&e.GkF(0)}const U=i=>({$implicit:i});function k(i,p){if(1&i&&(e.ynx(0),e.YNc(1,E,1,0,"ng-container",13),e.BQk()),2&i){const t=p.$implicit,r=e.oxw().$implicit,a=e.oxw();e.xp6(),e.Q6J("ngTemplateOutlet",a.templateStore.getGridTemplates(r.key))("ngTemplateOutletContext",e.VKq(2,U,t))}}function L(i,p){if(1&i&&(e.ynx(0),e.YNc(1,k,2,4,"ng-container",10),e.BQk()),2&i){const t=p.$implicit;e.xp6(),e.Q6J("dxTemplateOf",t.key)}}function Y(i,p){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-bottom-toolbar-btns",12),e.qZA()),2&i){e.oxw();const t=e.MAs(7);e.xp6(),e.Q6J("grid",t)}}function $(i,p){if(1&i){const t=e.EpF();e.TgZ(0,"app-notification-tag-box",14),e.NdJ("valueChange",function(a){const d=e.CHM(t).$implicit;return e.KtG(d.setValue(a))}),e.qZA()}if(2&i){const t=p.$implicit;e.Q6J("dataSource",t.column.editorOptions.dataSource)("rowData",t.data)("label",t.column.caption)("isRequired",t.column.validationRules&&"required"===t.column.validationRules[0].type)("value",t.data.receiverIds)}}const j=()=>({class:"custom-tree-view"}),z=[{path:"",component:(()=>{class i{constructor(t,r,a,o){this.gridDataSourceService=t,this.templateStore=r,this.appRestService=a,this.configStateService=o,this.columns=C,this.cRUDEndpoints=h,this.dataFieldLookupSourceMapping=R,this.dataFieldTranslationKeysMapping=I,this.relatedDataValueAndQueryStringKeyMapping=T,this.editingPropertiesForCreating=G,this.editingPropertiesForUpdating=_,this.gridProperties={toolbar:{visible:!1}},this.breadCrumbData=[],this.treeViewDataSource=[],this.setGridDataSource=d=>{this.gridDataSource=this.gridDataSourceService.getDataSource(h,T),this.gridDataSource.filter([["SpecifiedTenantId","=",this.SpecifiedTenantId],["ParentReceiverGroupId","=",d]])},this.configStateService.getOne$("currentTenant").subscribe(d=>{this.SpecifiedTenantId=d.id})}ngOnInit(){this.setGridDataSource(),this.setTreeViewDataSource()}onInitNewRow(t){const r=this.configStateService.getOne("currentUser");t.data.parentReceiverGroupId=this.parentReceiverGroupId,t.data.tenantId=r.tenantId,t.data.receiverIds=[]}onRowClick(t){if(t.event.target.classList.contains("dx-button-content"))return;const r=this.treeViewDataSource.find(a=>a.id===t.data.id);this.setGridDataSource(t.data.id),this.treeview.instance.expandItem(r),this.treeview.instance.selectItem(r),this.parentReceiverGroupId=t.data.id}onRowInserted(t){this.treeViewDataSource.push({id:t.data.id,name:t.data.name,parentId:t.data.parentReceiverGroupId})}onRowRemoved(t){this.treeViewDataSource=this.treeViewDataSource.filter(r=>r.id!==t.data.id)}setTreeViewDataSource(){this.appRestService.request({method:"GET",url:"/api/app/receiver-groups/treeview"}).subscribe(t=>{const r=t.items.map(a=>({id:a.id,name:a.name,parentId:a.parentId||"receiverGroups"}));this.treeViewDataSource=r,this.treeViewDataSource.unshift({id:"receiverGroups",name:"\u63a5\u6536\u8005\u7fa4\u7d44",parentId:null,selected:!0,expanded:!0})})}onTreeViewItemClick(t){this.setGridDataSource("receiverGroups"===t.itemData.id?null:t.itemData.id),this.treeview.instance.expandItem(t.itemData),this.treeview.instance.selectItem(t.itemData),this.parentReceiverGroupId=t.itemData.id}static#e=this.\u0275fac=function(r){return new(r||i)(e.Y36(D.I),e.Y36(M.z),e.Y36(l.vgb),e.Y36(l.XJE))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-receiver-groups"]],viewQuery:function(r,a){if(1&r&&(e.Gf(Z,5),e.Gf(B,5)),2&r){let o;e.iGM(o=e.CRH())&&(a.grid=o.first),e.iGM(o=e.CRH())&&(a.treeview=o.first)}},decls:15,vars:18,consts:[[1,"receiver-groups"],[1,"receiver-groups-tree-view"],["appGridAddButton","",3,"onClick"],["appTreeView","","selectionMode","single","dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId",3,"dataSource","elementAttr","onItemClick"],["treeview",""],[1,"receiver-groups-data-grid"],["appGridFeature","","appGridFeatureNotification","",3,"dataFieldTranslationKeysMapping","datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","gridProperties","isEditingDataAsync","onInitNewRow","onRowClick","onRowInserted","onRowRemoved"],["grid",""],["name","applyFilterButton","cssClass","d-none"],[4,"ngFor","ngForOf"],[4,"dxTemplate","dxTemplateOf"],[3,"dataSource","rowData","label","isRequired","value","valueChange",4,"dxTemplate","dxTemplateOf"],[3,"grid"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"dataSource","rowData","label","isRequired","value","valueChange"]],template:function(r,a){if(1&r){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"dx-button",2),e.NdJ("onClick",function(){e.CHM(o);const s=e.MAs(7);return e.KtG(s.instance.addRow())}),e.qZA(),e.TgZ(3,"dx-tree-view",3,4),e.NdJ("onItemClick",function(s){return a.onTreeViewItemClick(s)}),e.qZA()(),e.TgZ(5,"div",5)(6,"dx-data-grid",6,7),e.NdJ("onInitNewRow",function(s){return a.onInitNewRow(s)})("onRowClick",function(s){return a.onRowClick(s)})("onRowInserted",function(s){return a.onRowInserted(s)})("onRowRemoved",function(s){return a.onRowRemoved(s)}),e.TgZ(8,"dxo-toolbar"),e._UZ(9,"dxi-item",8),e.qZA(),e.YNc(10,L,2,1,"ng-container",9),e.ALo(11,"keyvalue"),e.YNc(12,Y,2,1,"div",10)(13,$,1,5,"app-notification-tag-box",11),e.qZA(),e._UZ(14,"app-notification-pager",12),e.qZA()()}if(2&r){const o=e.MAs(7);e.xp6(3),e.Q6J("dataSource",a.treeViewDataSource)("elementAttr",e.DdM(17,j)),e.xp6(3),e.Q6J("dataFieldTranslationKeysMapping",a.dataFieldTranslationKeysMapping)("datafieldValueQueryStringKeyMapping",a.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",a.dataFieldLookupSourceMapping)("editingPropertiesForCreating",a.editingPropertiesForCreating)("editingPropertiesForUpdating",a.editingPropertiesForUpdating)("columns",a.columns)("dataSource",a.gridDataSource)("gridProperties",a.gridProperties)("isEditingDataAsync",!0),e.xp6(4),e.Q6J("ngForOf",e.lcZ(11,15,a.templateStore.gridTemplates)),e.xp6(2),e.Q6J("dxTemplateOf","bottom-toolbar"),e.xp6(),e.Q6J("dxTemplateOf","receiverIds"),e.xp6(),e.Q6J("grid",o)}},dependencies:[c.sg,c.tP,N.S,O._,V.f,A,P.R,K.K,J.p6,u.u,y.ZT3,Q.e,y.y1f,x.D,S.h,c.Nd],styles:[".receiver-groups[_ngcontent-%COMP%]{height:99%;margin-top:24px;padding-top:16px;display:flex}.receiver-groups-tree-view[_ngcontent-%COMP%]{flex:1;border-right:1px solid var(--gray-3)}.receiver-groups-tree-view[_ngcontent-%COMP%]   dx-tree-view[_ngcontent-%COMP%]{margin-top:4px}.receiver-groups-data-grid[_ngcontent-%COMP%]{height:100%;flex:2;padding:0 8px;display:flex;flex-direction:column;justify-content:space-between}.receiver-groups-data-grid[_ngcontent-%COMP%]     .dx-datagrid-header-panel{display:none}.receiver-groups-data-grid[_ngcontent-%COMP%]     dx-data-grid{padding-top:0;height:90%!important}.receiver-groups-data-grid[_ngcontent-%COMP%]     app-notification-pager .pager{margin-top:0}"]})}return i})(),canActivate:[l.a1M,l.nG9]}];let H=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[m.Bz.forChild(z),m.Bz]})}return i})();var X=n(5533);let W=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[c.ez,H,b.m,X.P,u.V,x.D,S.h]})}return i})()}}]);