"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[1685],{26600:(V,E,n)=>{n.d(E,{c:()=>m});var t=n(19212),c=n(77490),S=n(96814);const e=(_,T)=>{if(void 0===T)return[];const a=[];return function i(s){_.filter(D=>D.parentId===s).forEach(D=>{a.push(D.id),i(D.id)})}(T),a};var C=n(16358),x=n(20843),h=n(95051),I=n(98179),g=n(61157),f=n(37072),l=n(21137);const o=["tree"];function p(_,T){if(1&_){const a=t.EpF();t.TgZ(0,"dx-tree-view",8,9),t.NdJ("onItemSelectionChanged",function(s){t.CHM(a);const d=t.oxw(2);return t.KtG(d.onItemSelectionChanged(s))})("onContentReady",function(s){t.CHM(a);const d=t.oxw(2);return t.KtG(d.onContentReady(s))}),t.qZA()}if(2&_){const a=t.oxw(2);t.Q6J("dataSource",a._dataSource)("selectNodesRecursive",!1)}}function r(_,T){if(1&_){const a=t.EpF();t.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),t.NdJ("onClick",function(){t.CHM(a);const s=t.oxw();return t.KtG(s.restore())}),t.qZA()(),t.TgZ(4,"dx-check-box",6),t.NdJ("onValueChanged",function(s){t.CHM(a);const d=t.oxw();return t.KtG(d.onCustomSelectNodesRecursiveChanged(s))}),t.qZA(),t.TgZ(5,"span"),t._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),t.qZA()(),t.YNc(7,p,2,2,"dx-tree-view",7),t.qZA()}if(2&_){const a=t.oxw();t.xp6(4),t.Q6J("value",a.customSelectNodesRecursive),t.xp6(3),t.Q6J("ngIf",a.popupVisible)}}function u(_,T){if(1&_){const a=t.EpF();t.TgZ(0,"div")(1,"dx-button",10),t.NdJ("onClick",function(){t.CHM(a);const s=t.oxw();return t.KtG(s.onConfirm())}),t.qZA()()}}let m=(()=>{class _{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.isViewMode=!1,this.selectedChange=new t.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=a=>{this.customSelectNodesRecursive=a.value},this.restore=()=>{const a=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(i=>{this.tree.instance.selectItem(i)}),this.customSelectNodesRecursive=a},this.onTagBoxFocusIn=()=>{const a=function v(_){const T=new Set;return _.filter(i=>!i.parentId).forEach(function a(i){if(i.selected){let d=i.parentId;for(;d;)T.add(d),d=_.find(D=>D.id===d)?.parentId}_.filter(d=>d.parentId===i.id).forEach(a)}),Array.from(T)}(this._dataSource);this._dataSource.forEach(i=>{const s=void 0!==a.find(d=>d===i.id);i.expanded=s}),this.popupVisible=!0}}ngOnChanges(a){!a.selected?.firstChange&&!a.dataSource?.firstChange||(a.selected&&(this.treeViewselected=this.selected.map(i=>i),this.tagBoxSelected=this.selected.map(i=>i)),a.selected&&a.dataSource&&(this._dataSource=this.dataSource.map(i=>{const s=void 0!==this.selected.find(d=>d===i.id);return this.selected.find(d=>d===i.id)?{...i,selected:s}:i}),this._originSelected=[...this.selected]))}onItemSelectionChanged(a){if(this.customSelectNodesRecursive&&!0===a.itemData?.selected){const i=a.itemData?.id;e(this.dataSource,i).forEach(d=>{this.tree.instance.selectItem(d)})}if(this.customSelectNodesRecursive&&!1===a.itemData?.selected){const i=a.itemData?.id;e(this.dataSource,i).forEach(d=>{this.tree.instance.unselectItem(d)})}this.treeViewselected=this._dataSource.filter(i=>i.selected).map(i=>i.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(a=>a),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(a){const i=a.removedItems.map(s=>s.id);this.treeViewselected=this.treeViewselected.filter(s=>void 0===i.find(d=>s===d)),this._dataSource.forEach(s=>{i.find(D=>s.id===D)&&(s.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}static#e=this.\u0275fac=function(i){return new(i||_)};static#t=this.\u0275cmp=t.Xpm({type:_,selectors:[["app-jb-tree-view"]],viewQuery:function(i,s){if(1&i&&t.Gf(o,5),2&i){let d;t.iGM(d=t.CRH())&&(s.tree=d.first)}},inputs:{selected:"selected",dataSource:"dataSource",isViewMode:"isViewMode"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[t.TTD,t.jDz],decls:4,vars:10,consts:[["valueExpr","id","displayExpr","name",3,"value","dataSource","openOnFieldClick","multiline","disabled","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged","onContentReady"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(i,s){1&i&&(t.TgZ(0,"dx-tag-box",0),t.NdJ("valueChange",function(D){return s.tagBoxSelected=D})("onSelectionChanged",function(D){return s.onTagBoxSelectionChanged(D)})("onFocusIn",function(){return s.onTagBoxFocusIn()}),t.qZA(),t.TgZ(1,"dx-popup",1),t.YNc(2,r,8,2,"dx-scroll-view",2)(3,u,2,0,"div",2),t.qZA()),2&i&&(t.Q6J("value",s.tagBoxSelected)("dataSource",s._dataSource)("openOnFieldClick",!1)("multiline",!0)("disabled",s.isViewMode),t.xp6(),t.Q6J("toolbarItems",s.popupButtonToolBars)("visible",s.popupVisible)("showTitle",!1),t.xp6(),t.Q6J("dxTemplateOf","contentTemplate"),t.xp6(),t.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[c.P,C.K,x.p6,h.u,I.x,g.U,f.N,l.v,S.ez,S.O5]})}return _})()},46203:(V,E,n)=>{n.d(E,{J:()=>I});var t=n(21137),c=n(6990),v=n(88762),e=n(19212),C=n(53009);const x=(g,f)=>f.id;function h(g,f){if(1&g){const l=e.EpF();e.TgZ(0,"div",1)(1,"dx-check-box",2),e.NdJ("click",function(p){const u=e.CHM(l).$implicit,m=e.oxw();return e.KtG(m.checkIsOnlyOneNotificationProviderDefinitionIdSelected(p,u.id))})("onValueChanged",function(p){const u=e.CHM(l).$implicit,m=e.oxw();return e.KtG(m.onValueChanged(p,u.id))}),e.qZA()()}if(2&g){const l=f.$implicit,o=e.oxw();e.xp6(),e.Q6J("text",l.name)("value",o.checkIsNotificationProviderDefinitionIdSelected(l.id))("disabled",o.isViewMode)}}let I=(()=>{class g{constructor(l){this.appRestService=l,this.isViewMode=!1,this.notificationProviderDefinitions=[],this.notificationProviderDefinitionIds=[]}ngOnInit(){this.fetchNotificationProviderDefinitions()}onValueChanged(l,o){this.updateNotificationProviderDefinitionIds(l.value,o)}fetchNotificationProviderDefinitions(){this.appRestService.request({method:"GET",url:"/api/app/notification-infos/assignable-notification-provider-definitions"}).subscribe(l=>{l.items.forEach(o=>{this.notificationProviderDefinitions.push((0,c.cloneDeep)(o))}),this.fillUpNotificationProviderDefinitionIds()})}fillUpNotificationProviderDefinitionIds(){this.cellInfo.value&&0!==this.cellInfo.value.length?this.notificationProviderDefinitionIds=[...this.cellInfo.value]:this.initNotificationProviderDefinitionIds(),this.cellInfo.setValue((0,c.cloneDeep)(this.notificationProviderDefinitionIds))}initNotificationProviderDefinitionIds(){this.notificationProviderDefinitionIds.push(this.notificationProviderDefinitions[0].id)}checkIsNotificationProviderDefinitionIdSelected(l){return this.notificationProviderDefinitionIds.includes(l)}checkIsOnlyOneNotificationProviderDefinitionIdSelected(l,o){1===this.notificationProviderDefinitionIds.length&&this.checkIsNotificationProviderDefinitionIdSelected(o)&&l.stopImmediatePropagation()}updateNotificationProviderDefinitionIds(l,o){const p=this.notificationProviderDefinitionIds.indexOf(o);l&&-1===p?this.notificationProviderDefinitionIds.push(o):!l&&-1!==p&&this.notificationProviderDefinitionIds.splice(p,1),this.cellInfo.setValue((0,c.cloneDeep)(this.notificationProviderDefinitionIds))}static#e=this.\u0275fac=function(o){return new(o||g)(e.Y36(C.$))};static#t=this.\u0275cmp=e.Xpm({type:g,selectors:[["app-notification-provider-definitions"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[e.jDz],decls:3,vars:0,consts:[[1,"row"],[1,"col-4"],[3,"text","value","disabled","click","onValueChanged"],["class","col-4"]],template:function(o,p){1&o&&(e.TgZ(0,"div",0),e.SjG(1,h,2,3,"div",3,x),e.qZA()),2&o&&(e.xp6(),e.wJu(p.notificationProviderDefinitions))},dependencies:[t.W,t.v,v.vaR]})}return g})()},36744:(V,E,n)=>{n.d(E,{b:()=>S});var t=n(86359),c=n(19212);let S=(()=>{class v{constructor(){this.isViewMode=!1,this.notificationSettingRadioGroupDataSource=[],this.notificationSettingRadioGroupValue=null}ngOnInit(){this.notificationSettingRadioGroupDataSource=[{type:"share",text:"\u5957\u7528\u5171\u7528\u8a2d\u5b9a"},{type:"custom",text:"\u53e6\u884c\u8a2d\u5b9a"}],this.notificationSettingRadioGroupValue=this.notificationSettingRadioGroupDataSource[0]}onNotificationSettingRadioGroupChanged(C){this.cellInfo.setValue("share"===C.value.type?"share":"custom")}static#e=this.\u0275fac=function(x){return new(x||v)};static#t=this.\u0275cmp=c.Xpm({type:v,selectors:[["app-notification-setting-items-radio-group"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[c.jDz],decls:2,vars:3,consts:[["displayExpr","text","layout","horizontal",3,"dataSource","value","readOnly","valueChange","onValueChanged"],["radioGroup",""]],template:function(x,h){1&x&&(c.TgZ(0,"dx-radio-group",0,1),c.NdJ("valueChange",function(g){return h.notificationSettingRadioGroupValue=g})("onValueChanged",function(g){return h.onNotificationSettingRadioGroupChanged(g)}),c.qZA()),2&x&&c.Q6J("dataSource",h.notificationSettingRadioGroupDataSource)("value",h.notificationSettingRadioGroupValue)("readOnly",h.isViewMode)},dependencies:[t._,t.I]})}return v})()},90962:(V,E,n)=>{n.d(E,{b:()=>l});var t=n(6990),S=n(74291),v=n(10518),e=n(19212),C=n(53009);const x=(o,p)=>p.notificationSettingDefinitionId;function h(o,p){if(1&o){const r=e.EpF();e.TgZ(0,"dx-select-box",6),e.NdJ("valueChange",function(m){e.CHM(r);const _=e.oxw().$implicit;return e.KtG(_.value=m)})("onValueChanged",function(m){e.CHM(r);const _=e.oxw().$index,T=e.oxw(2);return e.KtG(T.onSettingValueChanged(m,_))}),e.qZA()}if(2&o){const r=e.oxw().$implicit,u=e.oxw(2);e.Q6J("dataSource",u.selectBoxDataSource)("value",r.value)}}function I(o,p){if(1&o){const r=e.EpF();e.TgZ(0,"dx-text-box",7),e.NdJ("valueChange",function(m){e.CHM(r);const _=e.oxw().$implicit;return e.KtG(_.value=m)})("onValueChanged",function(m){e.CHM(r);const _=e.oxw().$index,T=e.oxw(2);return e.KtG(T.onSettingValueChanged(m,_))}),e.qZA()}if(2&o){const r=e.oxw().$implicit;e.Q6J("value",r.value)}}function g(o,p){if(1&o&&(e.TgZ(0,"div",3)(1,"div",2),e._uU(2),e.qZA(),e.TgZ(3,"div",4),e.YNc(4,h,1,2,"dx-select-box",5)(5,I,1,1),e.qZA()()),2&o){const r=p.$implicit,u=p.$index,m=e.oxw(2);e.xp6(2),e.hij(" ",m.displayNames[u]," "),e.xp6(2),e.um2(4,"b6b5fb16-6f45-f7ad-85e3-3a1229a3ead0"===r.notificationSettingDefinitionId?4:5)}}function f(o,p){if(1&o&&(e.TgZ(0,"label",0)(1,"span",1)(2,"span",2),e._uU(3,"\u901a\u77e5\u8a2d\u5b9a"),e.qZA()()(),e.SjG(4,g,6,2,"div",8,x)),2&o){const r=e.oxw();e.xp6(4),e.wJu(r.notificationSetting)}}let l=(()=>{class o{constructor(r){this.appRestService=r,this.isUseCustomSetting=!1,this.isViewMode=!1,this.notificationSetting=[],this.displayNames=[],this.selectBoxDataSource=["A","M"]}ngOnChanges(){this.applyNotificationSettingItems(),this.fetchCustomNotificationSettingItems(),this.clearCustomNotificationSettingItems()}applyNotificationSettingItems(){if(0===this.notificationSetting.length)return;const r=(0,t.cloneDeep)(this.notificationSetting);this.cellInfo.setValue(r)}fetchCustomNotificationSettingItems(){!this.isUseCustomSetting||this.notificationSetting.length>0||this.appRestService.request({method:"GET",url:"/api/app/notification-settings/current-tenant"}).subscribe(r=>{r.forEach(u=>{this.notificationSetting.push((0,t.cloneDeep)({notificationSettingDefinitionId:u.notificationSettingDefinition.id,value:u.notificationSetting.value||u.notificationSettingDefinition.defaultValue,isInherited:u.notificationSetting.isInherited})),this.displayNames.push(u.notificationSettingDefinition.displayName)}),this.applyNotificationSettingItems()})}clearCustomNotificationSettingItems(){this.isUseCustomSetting||0===this.notificationSetting.length||this.cellInfo.setValue(null)}onSettingValueChanged(r,u){this.notificationSetting[u].value=r.value,this.applyNotificationSettingItems()}static#e=this.\u0275fac=function(u){return new(u||o)(e.Y36(C.$))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-notification-setting-items"]],inputs:{isUseCustomSetting:"isUseCustomSetting",cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[e.TTD,e.jDz],decls:1,vars:1,consts:[[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[1,"d-flex","align-items-center","mb-3"],[1,"ps-3","pe-3"],["valueChangeEvent","keyup",3,"dataSource","value"],["valueChangeEvent","keyup",3,"dataSource","value","valueChange","onValueChanged"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","d-flex align-items-center mb-3"]],template:function(u,m){1&u&&e.YNc(0,f,6,0),2&u&&e.um2(0,m.isUseCustomSetting?0:-1)},dependencies:[S.a,S.I,v.D,v._]})}return o})()},98991:(V,E,n)=>{n.d(E,{D:()=>S});var t=n(26600),c=n(19212);let S=(()=>{class v{constructor(){this.isViewMode=!1,this.hideReceiverTreeView=!1,this.selected=["1","1-1-1","2-1"],this.dataSource=[{id:"1",name:"1"},{id:"1-1",name:"1-1",parentId:"1"},{id:"1-1-1",name:"1-1-1",parentId:"1-1"},{id:"1-1-2",name:"1-1-2",parentId:"1-1"},{id:"2",name:"2"},{id:"2-1",name:"2-1",parentId:"2"},{id:"2-1-1",name:"2-1-1",parentId:"2-1"},{id:"2-1-2",name:"2-1-2",parentId:"2-1"},{id:"2-1-3",name:"2-1-3",parentId:"2-1"}]}selectedChange(C){this.selected=C}static#e=this.\u0275fac=function(x){return new(x||v)};static#t=this.\u0275cmp=c.Xpm({type:v,selectors:[["app-receiver-group-tree-view"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTreeView:"hideReceiverTreeView"},standalone:!0,features:[c.jDz],decls:6,vars:4,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[3,"selected","dataSource","isViewMode","selectedChange"]],template:function(x,h){1&x&&(c.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),c._uU(4," \u63a5\u6536\u7fa4\u7d44 (\u591a\u7b46) "),c.qZA()()(),c.TgZ(5,"app-jb-tree-view",4),c.NdJ("selectedChange",function(g){return h.selectedChange(g)}),c.qZA()()),2&x&&(c.Q6J("hidden",h.hideReceiverTreeView),c.xp6(5),c.Q6J("selected",h.selected)("dataSource",h.dataSource)("isViewMode",h.isViewMode))},dependencies:[t.c]})}return v})()},38653:(V,E,n)=>{n.d(E,{k:()=>h});var t=n(96814),c=n(61157),S=n(37398),v=n(66648),e=n(19212),C=n(88762),x=n(24106);let h=(()=>{class I{constructor(f,l){this.restService=f,this.localizationService=l,this.isViewMode=!1,this.hideReceiverTagBox=!1,this.receiversDataSource$=null,this.currentDataField="",this.receivers=[]}ngOnChanges(f){window.component=this,!this.hideReceiverTagBox&&this.receivers.length>0&&this.cellInfo.setValue([...this.receivers])}ngOnInit(){this.currentDataField=this.cellInfo.column.dataField,this.cellInfo.column.validationRules=[{type:"custom",message:this.localizationService.instant("AbpValidation::ThisFieldIsRequired."),validationCallback:this.receiverTagBoxValidationCallback}],this.receiversDataSource$=this.restService.request({method:"GET",url:"/api/app/notification-infos/assignable-receivers"}).pipe((0,S.U)(f=>f.items))}onValueChanged(f){this.receivers=[...f.value],this.cellInfo.setValue(f.value)}receiverTagBoxValidationCallback(f){return!!(f.data.isForAllReceivers||f.data[f.column.dataField]&&0!==f.data[f.column.dataField].length)}static#e=this.\u0275fac=function(l){return new(l||I)(e.Y36(C.vgb),e.Y36(C.oQ8))};static#t=this.\u0275cmp=e.Xpm({type:I,selectors:[["app-receiver-tag-box"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTagBox:"hideReceiverTagBox"},standalone:!0,features:[e.TTD,e.jDz],decls:7,vars:6,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["appTagBox","","receiverTagBox","","displayExpr","name","valueExpr","id","validationMessageMode","always",3,"dataSource","value","disabled","onValueChanged"]],template:function(l,o){1&l&&(e.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),e._uU(4," \u63a5\u6536\u8005 (\u591a\u7b46) "),e.qZA()()(),e.TgZ(5,"dx-tag-box",4),e.NdJ("onValueChanged",function(r){return o.onValueChanged(r)}),e.ALo(6,"async"),e.qZA()()),2&l&&(e.Q6J("hidden",o.hideReceiverTagBox),e.xp6(5),e.Q6J("dataSource",e.lcZ(6,4,o.receiversDataSource$))("value",o.cellInfo.value)("disabled",o.isViewMode))},dependencies:[c._,c.U,t.ez,t.Ov,v.m,x.x],styles:["dx-tag-box[apptagbox][receiverTagBox] .dx-overlay-wrapper.dx-invalid-message.dx-invalid-message-always{width:100%!important}"]})}return I})()}}]);