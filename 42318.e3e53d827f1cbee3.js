"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[42318],{26600:(V,I,a)=>{a.d(I,{c:()=>D});var e=a(19212),m=a(77490),i=a(96814);const t=(p,x)=>{if(void 0===x)return[];const n=[];return function o(l){p.filter(T=>T.parentId===l).forEach(T=>{n.push(T.id),o(T.id)})}(x),n};var v=a(16358),h=a(20843),E=a(95051),c=a(98179),s=a(61157),_=a(37072),u=a(21137);const r=["tree"];function f(p,x){if(1&p){const n=e.EpF();e.TgZ(0,"dx-tree-view",8,9),e.NdJ("onItemSelectionChanged",function(l){e.CHM(n);const d=e.oxw(2);return e.KtG(d.onItemSelectionChanged(l))}),e.qZA()}if(2&p){const n=e.oxw(2);e.Q6J("dataSource",n._dataSource)("selectNodesRecursive",!1)}}function b(p,x){if(1&p){const n=e.EpF();e.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),e.NdJ("onClick",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.restore())}),e.qZA()(),e.TgZ(4,"dx-check-box",6),e.NdJ("onValueChanged",function(l){e.CHM(n);const d=e.oxw();return e.KtG(d.onCustomSelectNodesRecursiveChanged(l))}),e.qZA(),e.TgZ(5,"span"),e._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),e.qZA()(),e.YNc(7,f,2,2,"dx-tree-view",7),e.qZA()}if(2&p){const n=e.oxw();e.xp6(4),e.Q6J("value",n.customSelectNodesRecursive),e.xp6(3),e.Q6J("ngIf",n.popupVisible)}}function R(p,x){if(1&p){const n=e.EpF();e.TgZ(0,"div")(1,"dx-button",10),e.NdJ("onClick",function(){e.CHM(n);const l=e.oxw();return e.KtG(l.onConfirm())}),e.qZA()()}}let D=(()=>{class p{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.isViewMode=!1,this.selectedChange=new e.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=n=>{this.customSelectNodesRecursive=n.value},this.restore=()=>{const n=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(o=>{this.tree.instance.selectItem(o)}),this.customSelectNodesRecursive=n},this.onTagBoxFocusIn=()=>{const n=function g(p){const x=new Set;return p.filter(o=>!o.parentId).forEach(function n(o){if(o.selected){let d=o.parentId;for(;d;)x.add(d),d=p.find(T=>T.id===d)?.parentId}p.filter(d=>d.parentId===o.id).forEach(n)}),Array.from(x)}(this._dataSource);((p,x)=>{this._dataSource.forEach(n=>{const o=void 0!==x.find(l=>l===n.id);n.expanded=o})})(0,n),this.popupVisible=!0}}ngOnChanges(n){n.selected&&(this.treeViewselected=this.selected.map(o=>o),this.tagBoxSelected=this.selected.map(o=>o),this._originSelected=[...this.selected]),n.selected&&n.dataSource&&(this._dataSource=((p,x)=>this.dataSource.map(o=>{const l=void 0!==x.find(d=>d===o.id);return x.find(d=>d===o.id)?{...o,selected:l}:o}))(0,this.selected),this._originSelected=[...this.selected])}onItemSelectionChanged(n){if(this.customSelectNodesRecursive&&!0===n.itemData?.selected){const o=n.itemData?.id;t(this.dataSource,o).forEach(d=>{this.tree.instance.selectItem(d)})}if(this.customSelectNodesRecursive&&!1===n.itemData?.selected){const o=n.itemData?.id;t(this.dataSource,o).forEach(d=>{this.tree.instance.unselectItem(d)})}this.treeViewselected=this._dataSource.filter(o=>o.selected).map(o=>o.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(n=>n),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(n){if(n.removedItems.length){const o=n.removedItems.map(l=>l.id);this.treeViewselected=this.treeViewselected.filter(l=>void 0===o.find(d=>l===d)),this._dataSource.forEach(l=>{o.find(T=>l.id===T)&&(l.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}}static#e=this.\u0275fac=function(o){return new(o||p)};static#t=this.\u0275cmp=e.Xpm({type:p,selectors:[["app-jb-tree-view"]],viewQuery:function(o,l){if(1&o&&e.Gf(r,5),2&o){let d;e.iGM(d=e.CRH())&&(l.tree=d.first)}},inputs:{selected:"selected",dataSource:"dataSource",isViewMode:"isViewMode"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[e.TTD,e.jDz],decls:4,vars:10,consts:[["valueExpr","id","displayExpr","name","placeholder","\u9078\u64c7...",3,"value","dataSource","openOnFieldClick","multiline","disabled","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(o,l){1&o&&(e.TgZ(0,"dx-tag-box",0),e.NdJ("valueChange",function(T){return l.tagBoxSelected=T})("onSelectionChanged",function(T){return l.onTagBoxSelectionChanged(T)})("onFocusIn",function(){return l.onTagBoxFocusIn()}),e.qZA(),e.TgZ(1,"dx-popup",1),e.YNc(2,b,8,2,"dx-scroll-view",2)(3,R,2,0,"div",2),e.qZA()),2&o&&(e.Q6J("value",l.tagBoxSelected)("dataSource",l._dataSource)("openOnFieldClick",!1)("multiline",!0)("disabled",l.isViewMode),e.xp6(),e.Q6J("toolbarItems",l.popupButtonToolBars)("visible",l.popupVisible)("showTitle",!1),e.xp6(),e.Q6J("dxTemplateOf","contentTemplate"),e.xp6(),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[m.P,v.K,h.p6,E.u,c.x,s.U,_.N,u.v,i.ez,i.O5]})}return p})()},36744:(V,I,a)=>{a.d(I,{b:()=>i});var e=a(86359),m=a(19212);let i=(()=>{class g{constructor(){this.isViewMode=!1,this.notificationSettingRadioGroupDataSource=[],this.notificationSettingRadioGroupValue=null}ngOnInit(){this.notificationSettingRadioGroupDataSource=[{type:"share",text:"\u5957\u7528\u5171\u7528\u8a2d\u5b9a"},{type:"custom",text:"\u53e6\u884c\u8a2d\u5b9a"}],this.notificationSettingRadioGroupValue=this.notificationSettingRadioGroupDataSource[0]}onNotificationSettingRadioGroupChanged(C){this.cellInfo.setValue("share"===C.value.type?"share":"custom")}static#e=this.\u0275fac=function(S){return new(S||g)};static#t=this.\u0275cmp=m.Xpm({type:g,selectors:[["app-notification-setting-items-radio-group"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[m.jDz],decls:2,vars:3,consts:[["displayExpr","text","layout","horizontal",3,"dataSource","value","readOnly","valueChange","onValueChanged"],["radioGroup",""]],template:function(S,v){1&S&&(m.TgZ(0,"dx-radio-group",0,1),m.NdJ("valueChange",function(E){return v.notificationSettingRadioGroupValue=E})("onValueChanged",function(E){return v.onNotificationSettingRadioGroupChanged(E)}),m.qZA()),2&S&&m.Q6J("dataSource",v.notificationSettingRadioGroupDataSource)("value",v.notificationSettingRadioGroupValue)("readOnly",v.isViewMode)},dependencies:[e._,e.I]})}return g})()},90962:(V,I,a)=>{a.d(I,{b:()=>c});var e=a(6990),i=a(74291),g=a(10518),t=a(19212),C=a(53009);const S=(s,_)=>_.notificationSettingDefinitionId;function v(s,_){if(1&s){const u=t.EpF();t.TgZ(0,"dx-select-box",4),t.NdJ("valueChange",function(f){t.CHM(u);const b=t.oxw().$implicit;return t.KtG(b.value=f)})("onValueChanged",function(f){t.CHM(u);const b=t.oxw().$index,R=t.oxw();return t.KtG(R.onSettingValueChanged(f,b))}),t.qZA()}if(2&s){const u=t.oxw().$implicit,r=t.oxw();t.Q6J("dataSource",r.selectBoxDataSource)("value",u.value)}}function h(s,_){if(1&s){const u=t.EpF();t.TgZ(0,"dx-text-box",5),t.NdJ("valueChange",function(f){t.CHM(u);const b=t.oxw().$implicit;return t.KtG(b.value=f)})("onValueChanged",function(f){t.CHM(u);const b=t.oxw().$index,R=t.oxw();return t.KtG(R.onSettingValueChanged(f,b))}),t.qZA()}if(2&s){const u=t.oxw().$implicit;t.Q6J("value",u.value)}}function E(s,_){if(1&s&&(t.TgZ(0,"div",1)(1,"div",2),t._uU(2),t.qZA(),t.TgZ(3,"div"),t.YNc(4,v,1,2,"dx-select-box",3)(5,h,1,1),t.qZA()()),2&s){const u=_.$implicit,r=_.$index,f=t.oxw();t.xp6(2),t.hij(" ",f.displayNames[r]," "),t.xp6(2),t.um2(4,"b6b5fb16-6f45-f7ad-85e3-3a1229a3ead0"===u.notificationSettingDefinitionId?4:5)}}let c=(()=>{class s{constructor(u){this.appRestService=u,this.notificationSetting=[],this.displayNames=[],this.selectBoxDataSource=["A","M"]}ngOnChanges(){this.applyNotificationSettingItems(),this.fetchCustomNotificationSettingItems(),this.clearCustomNotificationSettingItems()}applyNotificationSettingItems(){if(0===this.notificationSetting.length)return;const u=(0,e.cloneDeep)(this.notificationSetting);this.cellInfo.setValue(u)}fetchCustomNotificationSettingItems(){this.notificationSetting.length>0||this.appRestService.request({method:"GET",url:"/api/app/notification-settings/current-tenant"}).subscribe(u=>{u.forEach(r=>{this.notificationSetting.push((0,e.cloneDeep)({notificationSettingDefinitionId:r.notificationSettingDefinition.id,value:r.notificationSetting.value||r.notificationSettingDefinition.defaultValue,isInherited:r.notificationSetting.isInherited})),this.displayNames.push(r.notificationSettingDefinition.displayName)}),this.applyNotificationSettingItems()})}clearCustomNotificationSettingItems(){0!==this.notificationSetting.length&&this.cellInfo.setValue(null)}onSettingValueChanged(u,r){this.notificationSetting[r].value=u.value,this.applyNotificationSettingItems()}static#e=this.\u0275fac=function(r){return new(r||s)(t.Y36(C.$))};static#t=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-notification-setting-items"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[t.TTD,t.jDz],decls:3,vars:0,consts:[[1,"notification-setting-list"],[1,"notification-setting-item"],[1,"notification-setting-item-label"],["valueChangeEvent","keyup",3,"dataSource","value"],["valueChangeEvent","keyup",3,"dataSource","value","valueChange","onValueChanged"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","notification-setting-item"]],template:function(r,f){1&r&&(t.TgZ(0,"div",0),t.SjG(1,E,6,2,"div",6,S),t.qZA()),2&r&&(t.xp6(),t.wJu(f.notificationSetting))},dependencies:[i.a,i.I,g.D,g._],styles:[".notification-setting-list[_ngcontent-%COMP%]{margin-top:-8px;display:flex;flex-direction:column;gap:16px}.notification-setting-item-label[_ngcontent-%COMP%]{margin-bottom:8px}"]})}return s})()},98991:(V,I,a)=>{a.d(I,{D:()=>v});var e=a(26600),m=a(96814),i=a(19212),g=a(53009),t=a(88762);function C(h,E){if(1&h){const c=i.EpF();i.TgZ(0,"div",6)(1,"div",7),i._uU(2),i.qZA(),i.TgZ(3,"div",8),i.NdJ("click",function(){const u=i.CHM(c).$implicit,r=i.oxw();return i.KtG(r.removeProvider(u.id))}),i.qZA()()}if(2&h){const c=E.$implicit;i.xp6(2),i.hij(" ",c.name," ")}}const S=h=>({"notification-tag-box-list--show":h});let v=(()=>{class h{constructor(c,s){this.appRestService=c,this.configStateService=s,this.label="",this.selectedReceiverGroups=[],this.renderReceiverGroups=[],this.receiverGroups=[]}ngOnInit(){this.label=this.cellInfo.item.label.text;const c=this.configStateService.getOne("currentUser")?.id;this.appRestService.request({method:"GET",url:`/api/app/notification-infos/assignable-receiver-groups/${c}`}).subscribe(s=>{this.receiverGroups=s.items,this.selectedReceiverGroups=this.cellInfo.data.receiverGroupIds,this.selectedReceiverGroups.length&&(this.renderReceiverGroups=this.receiverGroups.filter(_=>this.selectedReceiverGroups.includes(_.id)))})}selectedChange(c){this.selectedReceiverGroups=c,this.renderReceiverGroups=this.receiverGroups.filter(s=>this.selectedReceiverGroups.includes(s.id)),this.cellInfo.setValue(this.selectedReceiverGroups)}removeProvider(c){this.selectedReceiverGroups=this.selectedReceiverGroups.filter(s=>c!==s)}static#e=this.\u0275fac=function(s){return new(s||h)(i.Y36(g.$),i.Y36(t.XJE))};static#t=this.\u0275cmp=i.Xpm({type:h,selectors:[["app-receiver-group-tree-view"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[i.jDz],decls:9,vars:6,consts:[[1,"notification-tag-box"],[1,"notification-tag-box-label","dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[3,"selected","dataSource","selectedChange"],[1,"notification-tag-box-list",3,"ngClass"],[1,"notification-tag-box-item"],[1,"notification-tag-box-item-name"],[1,"notification-tag-box-item-close",3,"click"],["class","notification-tag-box-item"]],template:function(s,_){1&s&&(i.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),i._uU(4),i.qZA()()(),i.TgZ(5,"app-jb-tree-view",4),i.NdJ("selectedChange",function(r){return _.selectedChange(r)}),i.qZA(),i.TgZ(6,"div",5),i.SjG(7,C,4,1,"div",9,i.ikw),i.qZA()()),2&s&&(i.xp6(4),i.hij(" ",_.label," "),i.xp6(),i.Q6J("selected",_.selectedReceiverGroups)("dataSource",_.receiverGroups),i.xp6(),i.Q6J("ngClass",i.VKq(4,S,_.selectedReceiverGroups.length)),i.xp6(),i.wJu(_.renderReceiverGroups))},dependencies:[e.c,m.ez,m.mk]})}return h})()},38653:(V,I,a)=>{a.d(I,{k:()=>v});var e=a(96814),m=a(61157),i=a(37398),g=a(66648),t=a(19212),C=a(88762),S=a(24106);let v=(()=>{class h{constructor(c,s){this.restService=c,this.localizationService=s,this.isViewMode=!1,this.hideReceiverTagBox=!1,this.receiversDataSource$=null,this.currentDataField="",this.receivers=[]}ngOnChanges(c){window.component=this,!this.hideReceiverTagBox&&this.receivers.length>0&&this.cellInfo.setValue([...this.receivers])}ngOnInit(){this.currentDataField=this.cellInfo.column.dataField,this.cellInfo.column.validationRules=[{type:"custom",message:this.localizationService.instant("AbpValidation::ThisFieldIsRequired."),validationCallback:this.receiverTagBoxValidationCallback}],this.receiversDataSource$=this.restService.request({method:"GET",url:"/api/app/notification-infos/assignable-receivers"}).pipe((0,i.U)(c=>c.items))}onValueChanged(c){this.receivers=[...c.value],this.cellInfo.setValue(c.value)}receiverTagBoxValidationCallback(c){return!!(c.data.isForAllReceivers||c.data[c.column.dataField]&&0!==c.data[c.column.dataField].length)}static#e=this.\u0275fac=function(s){return new(s||h)(t.Y36(C.vgb),t.Y36(C.oQ8))};static#t=this.\u0275cmp=t.Xpm({type:h,selectors:[["app-receiver-tag-box"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTagBox:"hideReceiverTagBox"},standalone:!0,features:[t.TTD,t.jDz],decls:7,vars:6,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["appTagBox","","receiverTagBox","","displayExpr","name","valueExpr","id","validationMessageMode","always",3,"dataSource","value","disabled","onValueChanged"]],template:function(s,_){1&s&&(t.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),t._uU(4," \u63a5\u6536\u8005 (\u591a\u7b46) "),t.qZA()()(),t.TgZ(5,"dx-tag-box",4),t.NdJ("onValueChanged",function(r){return _.onValueChanged(r)}),t.ALo(6,"async"),t.qZA()()),2&s&&(t.Q6J("hidden",_.hideReceiverTagBox),t.xp6(5),t.Q6J("dataSource",t.lcZ(6,4,_.receiversDataSource$))("value",_.cellInfo.value)("disabled",_.isViewMode))},dependencies:[m._,m.U,e.ez,e.Ov,g.m,S.x],styles:["dx-tag-box[apptagbox][receiverTagBox] .dx-overlay-wrapper.dx-invalid-message.dx-invalid-message-always{width:100%!important}"]})}return h})()}}]);