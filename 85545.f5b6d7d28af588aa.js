"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[85545],{85545:(Ne,T,o)=>{o.r(T),o.d(T,{ReserveNotificationInfosModule:()=>Se});var c=o(96814),V=o(66648),m=o(88762),b=o(23758),d=o(35461),f=o(85054);const g=i=>new Date(i).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),Z=[{type:"buttons",fixed:!0,buttons:[{name:"details",template:"grid-details-button"},{name:"edit",template:"grid-edit-button",visible:i=>i.row?.data?.isEditable},{name:"delete",template:"grid-delete-button",visible:i=>i.row?.data?.isDeletable}]},{dataField:"id",visible:!1},{dataField:"concurrencyStamp",visible:!1},{dataField:"title",caption:"\u6a19\u984c",dataType:"string",filterOperations:d.I.text,validationRules:[f.L]},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string",filterOperations:d.I.text},{name:"notificationCategoryName",caption:"\u5206\u985e\u540d\u7a31",dataType:"string",filterOperations:d.I.text},{name:"notificationProviderNames",caption:"\u901a\u77e5\u63d0\u4f9b\u8005\u540d\u7a31 (\u591a\u7b46)",dataType:"string",filterOperations:d.I.text},{name:"receiverDescription",caption:"\u63a5\u6536\u8005\u63cf\u8ff0",dataType:"string",filterOperations:d.I.text},{name:"pushTimes",caption:"\u63a8\u9001\u6642\u9593 (\u591a\u7b46)",dataType:"string",filterOperations:d.I.text,calculateDisplayValue:i=>i.pushTimes?i.pushTimes.split("\u3001").map(t=>g(new Date(t+" GMT+0000").toISOString())).join("\u3001"):""},{dataField:"notificationDataFetchEndpoint",caption:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint",dataType:"string",filterOperations:d.I.text},{dataField:"hookEndpoint",caption:"Hook",dataType:"string",filterOperations:d.I.text},{dataField:"isFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean"},{dataField:"isDeletable",caption:"\u662f\u5426\u53ef\u522a\u9664",dataType:"boolean"},{dataField:"isEditable",caption:"\u662f\u5426\u53ef\u7de8\u8f2f",dataType:"boolean"},{dataField:"notificationProviderDefinitionIds",caption:"\u901a\u77e5\u63d0\u4f9b\u8005id (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"notification-provider-definition"},{dataField:"isForAllReceivers",caption:"\u662f\u5426\u50b3\u9001\u7d66\u6240\u6709\u63a5\u6536\u8005",dataType:"boolean",visible:!1},{dataField:"receiverIds",caption:"\u63a5\u6536\u8005 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receivers-tag-box"},{dataField:"receiverGroupIds",caption:"\u63a5\u6536\u7fa4\u7d44 (\u591a\u7b46)",dataType:"object",visible:!1,editCellTemplate:"receiver-groups-tag-box"},{dataField:"notificationSettingRadioGroup",caption:"\u901a\u77e5\u8a2d\u5b9a",dataType:"object",visible:!1,editCellTemplate:"notification-setting-radio-group"},{dataField:"notificationSettingItems",caption:"\u901a\u77e5\u8a2d\u5b9a\u9805\u76ee",dataType:"object",visible:!1,editCellTemplate:"notification-setting-items"},{dataField:"notificationCategoryId",caption:"\u901a\u77e5\u5206\u985e Id",dataType:"string",visible:!1,validationRules:[f.L]},{dataField:"subtitle",caption:"\u5b50\u6a19\u984c",dataType:"string",visible:!1},{dataField:"textContent",caption:"\u6587\u5b57\u5167\u5bb9",dataType:"string",visible:!1},{dataField:"isFetchNotificationDataByEachReceiver",caption:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599",dataType:"string",visible:!1},{dataField:"htmlContent",caption:"Html \u5167\u5bb9",dataType:"string",visible:!1},{dataField:"notificationSchedulePlans",caption:"\u9810\u7d04\u6642\u9593\u8a08\u756b",dataType:"object",visible:!1,editCellTemplate:"notification-schedule-plans"}],x={index:"/api/app/reserve-notification-infos",get:"/api/app/reserve-notification-infos",create:"/api/app/reserve-notification-infos",update:"/api/app/reserve-notification-infos",delete:"/api/app/reserve-notification-infos"},w=[{dataField:"notificationCategoryId",path:"/api/app/notification-infos/assignable-notification-categories",pathForSelectedDisplay:"/api/app/notification-categories"}],C=[{dataField:"id",mapping:["id"]},{dataField:"concurrencyStamp",mapping:["concurrencyStamp"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenantName"]},{name:"notificationCategoryName",queryStringKey:"NotificationCategoryName",mapping:["notificationCategoryName"]},{name:"notificationProviderNames",queryStringKey:"NotificationProviderNames",mapping:["notificationProviderNames"]},{name:"receiverDescription",queryStringKey:"ReceiverDescription",mapping:["receiverDescription"]},{name:"pushTimes",queryStringKey:"PushTimes",mapping:["pushTimes"]},{name:"isFinished",queryStringKey:"IsFinished",mapping:["isFinished"]},{name:"isDeletable",queryStringKey:"IsDeletable",mapping:["isDeletable"]},{name:"isEditable",queryStringKey:"IsEditable",mapping:["isEditable"]},{dataField:"tenantId",mapping:["tenantId"]},{dataField:"notificationProviderDefinitionIds",mapping:["notificationProviderDefinitionIds"]},{dataField:"isForAllReceivers",mapping:["isForAllReceivers"]},{dataField:"receiverIds",mapping:["receiverIds"]},{dataField:"receiverGroupIds",mapping:["receiverGroupIds"]},{dataField:"notificationSettingItems",mapping:["notificationSettingItems"]},{dataField:"notificationCategoryId",mapping:["notificationCategoryId"]},{dataField:"title",queryStringKey:"Title",mapping:["title"]},{dataField:"subtitle",mapping:["subtitle"]},{dataField:"textContent",mapping:["textContent"]},{dataField:"notificationDataFetchEndpoint",queryStringKey:"NotificationDataFetchEndpoint",mapping:["notificationDataFetchEndpoint"]},{dataField:"isFetchNotificationDataByEachReceiver",mapping:["isFetchNotificationDataByEachReceiver"]},{dataField:"hookEndpoint",queryStringKey:"HookEndpoint",mapping:["hookEndpoint"]},{dataField:"htmlContent",mapping:["htmlContent"]},{dataField:"notificationSchedulePlans",mapping:["notificationSchedulePlans"]}],h=[{itemType:"group",name:"basicGroup",caption:"\u57fa\u672c",colCount:2,items:[{dataField:"notificationProviderDefinitionIds"},{itemType:"group",name:"receiverGroup",colCount:2,items:[{dataField:"isForAllReceivers",editorType:"dxCheckBox"},{itemType:"empty"},{dataField:"receiverIds",label:{visible:!1}},{dataField:"receiverGroupIds",label:{visible:!1}}]}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u8a2d\u5b9a",colCount:2,items:[{dataField:"notificationSettingRadioGroup",label:{visible:!1}},{dataField:"notificationSettingItems",label:{visible:!1}}]},{itemType:"group",name:"notificationSettingGroup",caption:"\u9810\u7d04\u6642\u9593\u8a08\u756b",items:[{dataField:"notificationSchedulePlans",label:{visible:!1}}]},{itemType:"group",name:"notificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",colCount:2,items:[{dataField:"notificationCategoryId",editorType:"dxSelectBox"},{dataField:"title",editorType:"dxTextBox"},{itemType:"group",name:"textboxGroup",items:[{dataField:"subtitle",editorType:"dxTextBox"},{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox"},{dataField:"hookEndpoint",editorType:"dxTextBox"}]},{itemType:"group",name:"textareaGroup",items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"100px"}},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox"}]},{dataField:"htmlContent",colSpan:2,editorType:"dxHtmlEditor",editorOptions:{imageUpload:{fileUploadMode:"both",tabs:["url","file"]},toolbar:{items:[{name:"undo"},{name:"redo"},{name:"separator"},{name:"size",acceptedValues:["8pt","10pt","12pt","14pt","18pt","24pt","36pt"]},{name:"font",acceptedValues:["Arial","Georgia","Tahoma","Times New Roman","Verdana"]},{name:"separator"},{name:"bold"},{name:"italic"},{name:"strike"},{name:"underline"},{name:"separator"},{name:"alignLeft"},{name:"alignCenter"},{name:"alignRight"},{name:"alignJustify"},{name:"separator"},{name:"orderedList"},{name:"bulletList"},{name:"separator"},{name:"header",acceptedValues:[!1,1,2,3,4,5]},{name:"separator"},{name:"color"},{name:"background"},{name:"separator"},{name:"link"},{name:"image"},{name:"separator"},{name:"clear"},{name:"codeBlock"},{name:"blockquote"},{name:"separator"},{name:"insertTable"},{name:"deleteTable"},{name:"insertRowAbove"},{name:"insertRowBelow"},{name:"deleteRow"},{name:"insertColumnLeft"},{name:"insertColumnRight"},{name:"deleteColumn"},{name:"cellProperties"},{name:"tableProperties"}]},height:"250px"}}]}],O={form:{colCount:1,items:h}},J={form:{colCount:1,items:h}};var e=o(19212),Q=o(67),y=o(72783),p=o(16358),_=o(20843),u=o(2173),F=o(25012),B=o(69420),I=o(20481),G=o(10313),S=o(46203),P=o(38653),N=o(36744),R=o(90962),D=o(98991),v=o(6990),M=o(11430),k=o(87899),A=o(98179),E=o(66782);const U=["popup"];function K(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div")(2,"label",5)(3,"span",6)(4,"span",7),e._uU(5," \u9810\u7d04\u6642\u9593 "),e.qZA()()(),e.TgZ(6,"dx-date-box",8,9),e.NdJ("valueChange",function(n){e.CHM(t);const s=e.oxw();return e.KtG(s.pushTime=n)}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(6),e.Q6J("value",t.pushTime)}}function H(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"dx-button",12),e.NdJ("onClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.confirm())}),e.qZA()(),e.TgZ(3,"dx-button",13),e.NdJ("onClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancel())}),e.qZA()()}}const L=()=>({toolbar:"bottom",template:"bottom-toolbar",location:"after"}),j=i=>[i];let $=(()=>{class i{constructor(){this.isCreatePushTimeVisible=!1,this.isCreatePushTimeVisibleChange=new e.vpe,this.selectPushTime=new e.vpe}onHidden(){this.isCreatePushTimeVisibleChange.emit(!1)}confirm(){this.selectPushTime.emit(this.pushTime),this.popup.instance.toggle(!1)}cancel(){this.popup.instance.toggle(!1)}static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plan-create-push-time"]],viewQuery:function(a,n){if(1&a&&e.Gf(U,5),2&a){let s;e.iGM(s=e.CRH())&&(n.popup=s.first)}},inputs:{pushTime:"pushTime",isCreatePushTimeVisible:"isCreatePushTimeVisible"},outputs:{isCreatePushTimeVisibleChange:"isCreatePushTimeVisibleChange",selectPushTime:"selectPushTime"},decls:4,vars:7,consts:[["title","\u9810\u7d04\u6642\u9593\u8a08\u756b","width","450","height","300","contentTemplate","content",3,"visible","toolbarItems","visibleChange","onHidden"],["popup",""],["class","d-flex",4,"dxTemplate","dxTemplateOf"],["class","d-flex align-items-center",4,"dxTemplate","dxTemplateOf"],[1,"d-flex"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["type","datetime","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange"],["dateBox",""],[1,"d-flex","align-items-center"],[1,"me-2"],["type","primary","text","\u78ba\u5b9a",3,"onClick"],["type","primary","text","\u53d6\u6d88",3,"onClick"]],template:function(a,n){1&a&&(e.TgZ(0,"dx-popup",0,1),e.NdJ("visibleChange",function(r){return n.isCreatePushTimeVisible=r})("onHidden",function(){return n.onHidden()}),e.YNc(2,K,8,1,"div",2)(3,H,4,0,"div",3),e.qZA()),2&a&&(e.Q6J("visible",n.isCreatePushTimeVisible)("toolbarItems",e.VKq(5,j,e.DdM(4,L))),e.xp6(2),e.Q6J("dxTemplateOf","content"),e.xp6(),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[p.K,_.p6,A.x,E.M],encapsulation:2})}return i})();function Y(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",11),e.NdJ("onClick",function(){e.CHM(t);const n=e.oxw(),s=n.index,r=n.$implicit,Pe=e.oxw();return e.KtG(Pe.edit(s,r))}),e.qZA()}}function q(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",12),e.NdJ("onClick",function(){e.CHM(t);const n=e.oxw().index,s=e.oxw();return e.KtG(s.remove(n))}),e.qZA()}}function z(i,l){if(1&i&&(e.TgZ(0,"div",7)(1,"div"),e._uU(2),e.qZA(),e.TgZ(3,"div",8),e.YNc(4,Y,1,0,"dx-button",9)(5,q,1,0,"dx-button",10),e.qZA()()),2&i){const t=l.$implicit,a=e.oxw();e.xp6(2),e.hij(" ",a.renderFormatPushTime(t.pushTime)," "),e.xp6(2),e.Q6J("ngIf",!t.id),e.xp6(),e.Q6J("ngIf",!1!==t.isDeletable)}}let X=(()=>{class i{constructor(){this.isCreatePushTimeVisible=!1,this.notificationSchedulePlans=[],this.currentSelectedPlanIndex=null,this.pushTime=(new Date).toISOString(),this.renderFormatPushTime=g}ngOnInit(){this.notificationSchedulePlans=(0,v.cloneDeep)(this.cellInfo.value||[])}selectPushTime(t){null!==this.currentSelectedPlanIndex?this.notificationSchedulePlans[this.currentSelectedPlanIndex].pushTime=t:this.notificationSchedulePlans.push({pushTime:t}),this.cellInfo.setValue((0,v.cloneDeep)(this.notificationSchedulePlans)),this.pushTime=(new Date).toISOString(),this.currentSelectedPlanIndex=null}edit(t,a){this.isCreatePushTimeVisible=!0,this.currentSelectedPlanIndex=t,this.pushTime=a.pushTime}remove(t){this.notificationSchedulePlans.splice(t,1),this.cellInfo.setValue((0,v.cloneDeep)(this.notificationSchedulePlans))}trackBy(t){return t}static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plans"]],inputs:{cellInfo:"cellInfo"},decls:13,vars:4,consts:[[1,"paper-1","d-flex","flex-column"],[1,"d-flex","justify-content-between"],[1,"mb-1"],["icon","add","type","default","stylingMode","contained",3,"onClick"],[1,"d-flex","justify-content-between","align-plans-center","mb-1","pb-1","border-bottom"],["class","d-flex justify-content-between align-items-center pb-1 pt-1 border-bottom",4,"ngFor","ngForOf","ngForTrackBy"],[3,"isCreatePushTimeVisible","pushTime","isCreatePushTimeVisibleChange","selectPushTime"],[1,"d-flex","justify-content-between","align-items-center","pb-1","pt-1","border-bottom"],[1,"d-flex","justify-content-end"],["appGridEditButton","",3,"onClick",4,"ngIf"],["appGridDeleteButton","",3,"onClick",4,"ngIf"],["appGridEditButton","",3,"onClick"],["appGridDeleteButton","",3,"onClick"]],template:function(a,n){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),e._uU(4,"\u9810\u8a08\u63a8\u9001\u9078\u64c7"),e.qZA()(),e.TgZ(5,"dx-button",3),e.NdJ("onClick",function(){return n.isCreatePushTimeVisible=!0}),e.qZA()(),e.TgZ(6,"div")(7,"div",4)(8,"div"),e._uU(9,"\u9810\u8a08\u63a8\u9001\u6642\u9593"),e.qZA(),e._UZ(10,"div"),e.qZA(),e.YNc(11,z,6,3,"div",5),e.qZA()(),e.TgZ(12,"app-notification-schedule-plan-create-push-time",6),e.NdJ("isCreatePushTimeVisibleChange",function(r){return n.isCreatePushTimeVisible=r})("selectPushTime",function(r){return n.selectPushTime(r)}),e.qZA()),2&a&&(e.xp6(11),e.Q6J("ngForOf",n.notificationSchedulePlans)("ngForTrackBy",n.trackBy),e.xp6(),e.Q6J("isCreatePushTimeVisible",n.isCreatePushTimeVisible)("pushTime",n.pushTime))},dependencies:[c.sg,c.O5,p.K,M.R,k.o,$],encapsulation:2})}return i})();const W=[{type:"buttons",fixed:!0},{name:"pushTime",caption:"\u9810\u8a08\u63a8\u9001\u6642\u9593",dataType:"string",filterOperations:d.I.text,validationRules:[f.L]},{dataField:"isParsed",caption:"\u662f\u5426\u5df2\u89e3\u6790",dataType:"boolean"},{dataField:"isFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean"}],ee=[],te=[{name:"pushTime",mapping:["pushTime"]},{dataField:"isParsed",mapping:["isParsed"]},{dataField:"isFinished",mapping:["isFinished"]}];var ie=o(53009);const ne=["grid"];function ae(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"dx-button",5),e.NdJ("onClick",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closePopup())}),e.qZA()()}}const oe=()=>({toolbar:"bottom",template:"bottom-toolbar",location:"after"}),se=i=>[i];let le=(()=>{class i{constructor(t,a){this.templateStore=t,this.appRestService=a,this.notificationId="",this.isDetailsTableVisible=!1,this.isDetailsTableVisibleChange=new e.vpe,this.columns=W,this.dataFieldLookupSourceMapping=ee,this.relatedDataValueAndQueryStringKeyMapping=te,this.gridProperties={editing:{allowDeleting:!1,allowUpdating:!1},pager:{visible:!1},filterRow:{visible:!1}},this.gridDataSource=[]}ngOnChanges(){this.loadPlanDetails()}loadPlanDetails(){this.isDetailsTableVisible&&this.notificationId&&this.appRestService.request({method:"GET",url:`/api/app/reserve-notification-infos/notification-schedule-plans/${this.notificationId}`}).subscribe(t=>{this.gridDataSource=[...t],this.gridDataSource.forEach(a=>a.pushTime=g(a.pushTime))})}closePopup(){this.isDetailsTableVisibleChange.emit(!1)}static#e=this.\u0275fac=function(a){return new(a||i)(e.Y36(y.z),e.Y36(ie.$))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-notification-schedule-plan-details"]],viewQuery:function(a,n){if(1&a&&e.Gf(ne,5),2&a){let s;e.iGM(s=e.CRH())&&(n.grid=s.first)}},inputs:{notificationId:"notificationId",isDetailsTableVisible:"isDetailsTableVisible"},outputs:{isDetailsTableVisibleChange:"isDetailsTableVisibleChange"},features:[e.TTD],decls:6,vars:11,consts:[["title","\u6642\u9593\u8a08\u756b\u7d30\u7bc0",3,"visible","toolbarItems","visibleChange"],["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","columns","dataSource","gridProperties"],["grid",""],["name","applyFilterButton","cssClass","d-none"],[4,"dxTemplate","dxTemplateOf"],["type","primary","text","\u95dc\u9589",3,"onClick"]],template:function(a,n){1&a&&(e.TgZ(0,"dx-popup",0),e.NdJ("visibleChange",function(r){return n.isDetailsTableVisible=r}),e.TgZ(1,"dx-data-grid",1,2)(3,"dxo-toolbar"),e._UZ(4,"dxi-item",3),e.qZA()(),e.YNc(5,ae,2,0,"div",4),e.qZA()),2&a&&(e.Q6J("visible",n.isDetailsTableVisible)("toolbarItems",e.VKq(9,se,e.DdM(8,oe))),e.xp6(),e.Q6J("datafieldValueQueryStringKeyMapping",n.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",n.dataFieldLookupSourceMapping)("columns",n.columns)("dataSource",n.gridDataSource)("gridProperties",n.gridProperties),e.xp6(4),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[p.K,_.p6,u.ZT3,A.x,F.e,u.y1f,I._],encapsulation:2})}return i})();const re=["grid"];function de(i,l){if(1&i&&e._UZ(0,"app-grid-general-filter",13),2&i){e.oxw();const t=e.MAs(1);e.Q6J("grid",t)}}function ce(i,l){1&i&&e.GkF(0)}const pe=i=>({$implicit:i});function ue(i,l){if(1&i&&(e.ynx(0),e.YNc(1,ce,1,0,"ng-container",15),e.BQk()),2&i){const t=l.$implicit,a=e.oxw().$implicit,n=e.oxw();e.xp6(),e.Q6J("ngTemplateOutlet",n.templateStore.getGridTemplates(a.key))("ngTemplateOutletContext",e.VKq(2,pe,t))}}function me(i,l){if(1&i&&(e.ynx(0),e.YNc(1,ue,2,4,"ng-container",14),e.BQk()),2&i){const t=l.$implicit;e.xp6(),e.Q6J("dxTemplateOf",t.key)}}function fe(i,l){1&i&&e._UZ(0,"app-notification-provider-definitions",16),2&i&&e.Q6J("cellInfo",l.$implicit)}function ge(i,l){if(1&i&&e._UZ(0,"app-receiver-tag-box",17),2&i){const t=l.$implicit,a=e.oxw();e.Q6J("cellInfo",t)("hideReceiverTagBox",a.isForAllReceivers)}}function he(i,l){if(1&i&&e._UZ(0,"app-receiver-group-tree-view",18),2&i){const t=l.$implicit,a=e.oxw();e.Q6J("cellInfo",t)("hideReceiverTreeView",a.isForAllReceivers)}}function _e(i,l){1&i&&e._UZ(0,"app-notification-setting-items-radio-group",16),2&i&&e.Q6J("cellInfo",l.$implicit)}function ve(i,l){if(1&i&&e._UZ(0,"app-notification-setting-items",19),2&i){const t=l.$implicit,a=e.oxw();e.Q6J("isUseCustomSetting",a.isUseCustomSetting)("cellInfo",t)}}function Te(i,l){1&i&&e._UZ(0,"app-notification-schedule-plans",16),2&i&&e.Q6J("cellInfo",l.$implicit)}function be(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"dx-button",20),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.openDetailsTable(s.data.id))}),e.qZA()}}const xe=()=>({type:"default",stylingMode:"contained"}),Ce=[{path:"",component:(()=>{class i{constructor(t,a,n){this.gridDataSourceService=t,this.templateStore=a,this.configStateService=n,this.columns=Z,this.cRUDEndpoints=x,this.dataFieldLookupSourceMapping=w,this.relatedDataValueAndQueryStringKeyMapping=C,this.editingPropertiesForCreating=O,this.editingPropertiesForUpdating=J,this.isForAllReceivers=!1,this.isUseCustomSetting=!1,this.tenantId="",this.isDetailsTableVisible=!1,this.notificationId=""}ngOnInit(){this.gridDataSource=this.gridDataSourceService.getDataSource(x,C),this.configStateService.getOne$("currentUser").subscribe(t=>{this.tenantId=t.tenantId})}onInitNewRow(t){t.data.tenantId=this.tenantId,t.data.isForAllReceivers=!1,t.data.isFetchNotificationDataByEachReceiver=!1,t.data.receiverIds=[],t.data.receiverGroupIds=[]}onRowValidating(t){this.validateIsForAllReceivers(t)}onOptionChanged(t){"editing.changes"!==t.fullName&&"editing.editRowKey"!==t.fullName||"object"!=typeof t.value||!t.value||Array.isArray(t.value)&&0===t.value.length||(this.checkIsForAllReceivers(t),this.checkIsUseCustomSetting(t))}checkIsForAllReceivers(t){"editing.changes"===t.fullName&&!("isForAllReceivers"in t.value[0].data)||"editing.editRowKey"===t.fullName&&!("isForAllReceivers"in t.value)||"editing.changes"===t.fullName&&this.isForAllReceivers===t.value[0].data.isForAllReceivers||"editing.editRowKey"===t.fullName&&this.isForAllReceivers===t.value.isForAllReceivers||(this.isForAllReceivers="editing.changes"===t.fullName?t.value[0].data.isForAllReceivers:t.value.isForAllReceivers)}checkIsUseCustomSetting(t){"editing.editRowKey"!==t.fullName&&t.value[0].data.notificationSettingRadioGroup&&(this.isUseCustomSetting&&"custom"===t.value[0].data.notificationSettingRadioGroup||(this.isUseCustomSetting="custom"===t.value[0].data.notificationSettingRadioGroup))}validateIsForAllReceivers(t){!t.newData.isForAllReceivers||(t.newData.receiverIds=[],t.newData.receiverGroupIds=[],!t.brokenRules.find(n=>"custom"===n.type&&"receiverTagBoxValidationCallback"===n.validationCallback.name)||1!==t.brokenRules.length)||(t.isValid=!0)}resetOption(){this.isForAllReceivers=!1,this.isUseCustomSetting=!1}openDetailsTable(t){this.isDetailsTableVisible=!0,this.notificationId=t}static#e=this.\u0275fac=function(a){return new(a||i)(e.Y36(Q.I),e.Y36(y.z),e.Y36(m.XJE))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-instant-notification"]],viewQuery:function(a,n){if(1&a&&e.Gf(re,5),2&a){let s;e.iGM(s=e.CRH())&&(n.grid=s.first)}},decls:17,vars:21,consts:[["appGridFeature","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","isEditingDataAsync","onEditCanceled","onRowInserted","onInitNewRow","onOptionChanged","onRowValidating"],["grid",""],["name","addRowButton","location","before","widget","dxButton","cssClass","mb-1",3,"options"],["location","after"],[3,"grid",4,"dxTemplate"],["name","applyFilterButton","cssClass","d-none"],[4,"ngFor","ngForOf"],[3,"cellInfo",4,"dxTemplate","dxTemplateOf"],[3,"cellInfo","hideReceiverTagBox",4,"dxTemplate","dxTemplateOf"],[3,"cellInfo","hideReceiverTreeView",4,"dxTemplate","dxTemplateOf"],[3,"isUseCustomSetting","cellInfo",4,"dxTemplate","dxTemplateOf"],["appGridViewButton","",3,"click",4,"dxTemplate","dxTemplateOf"],[3,"isDetailsTableVisible","notificationId","isDetailsTableVisibleChange"],[3,"grid"],[4,"dxTemplate","dxTemplateOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"cellInfo"],[3,"cellInfo","hideReceiverTagBox"],[3,"cellInfo","hideReceiverTreeView"],[3,"isUseCustomSetting","cellInfo"],["appGridViewButton","",3,"click"]],template:function(a,n){1&a&&(e.TgZ(0,"dx-data-grid",0,1),e.NdJ("onEditCanceled",function(){return n.resetOption()})("onRowInserted",function(){return n.resetOption()})("onInitNewRow",function(r){return n.onInitNewRow(r)})("onOptionChanged",function(r){return n.onOptionChanged(r)})("onRowValidating",function(r){return n.onRowValidating(r)}),e.TgZ(2,"dxo-toolbar"),e._UZ(3,"dxi-item",2),e.TgZ(4,"dxi-item",3),e.YNc(5,de,1,1,"app-grid-general-filter",4),e.qZA(),e._UZ(6,"dxi-item",5),e.qZA(),e.YNc(7,me,2,1,"ng-container",6),e.ALo(8,"keyvalue"),e.YNc(9,fe,1,1,"app-notification-provider-definitions",7)(10,ge,1,2,"app-receiver-tag-box",8)(11,he,1,2,"app-receiver-group-tree-view",9)(12,_e,1,1,"app-notification-setting-items-radio-group",7)(13,ve,1,2,"app-notification-setting-items",10)(14,Te,1,1,"app-notification-schedule-plans",7)(15,be,1,0,"dx-button",11),e.qZA(),e.TgZ(16,"app-notification-schedule-plan-details",12),e.NdJ("isDetailsTableVisibleChange",function(r){return n.isDetailsTableVisible=r}),e.qZA()),2&a&&(e.Q6J("datafieldValueQueryStringKeyMapping",n.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",n.dataFieldLookupSourceMapping)("editingPropertiesForCreating",n.editingPropertiesForCreating)("editingPropertiesForUpdating",n.editingPropertiesForUpdating)("columns",n.columns)("dataSource",n.gridDataSource)("isEditingDataAsync",!0),e.xp6(3),e.Q6J("options",e.DdM(20,xe)),e.xp6(4),e.Q6J("ngForOf",e.lcZ(8,18,n.templateStore.gridTemplates)),e.xp6(2),e.Q6J("dxTemplateOf","notification-provider-definition"),e.xp6(),e.Q6J("dxTemplateOf","receivers-tag-box"),e.xp6(),e.Q6J("dxTemplateOf","receiver-groups-tag-box"),e.xp6(),e.Q6J("dxTemplateOf","notification-setting-radio-group"),e.xp6(),e.Q6J("dxTemplateOf","notification-setting-items"),e.xp6(),e.Q6J("dxTemplateOf","notification-schedule-plans"),e.xp6(),e.Q6J("dxTemplateOf","grid-details-button"),e.xp6(),e.Q6J("isDetailsTableVisible",n.isDetailsTableVisible)("notificationId",n.notificationId))},dependencies:[c.sg,c.tP,p.K,_.p6,u.ZT3,F.e,u.y1f,B.p,I._,G.w,S.J,P.k,N.b,R.b,D.D,X,le,c.Nd],encapsulation:2})}return i})(),canActivate:[m.a1M,m.nG9]}];let ye=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[b.Bz.forChild(Ce),b.Bz]})}return i})();var Fe=o(77490),Ie=o(68862);let Se=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[c.ez,ye,Fe.P,Ie.O,V.m,S.J,P.k,N.b,R.b,D.D]})}return i})()}}]);