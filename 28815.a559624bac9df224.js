"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[28815],{28815:(H,u,n)=>{n.r(u),n.d(u,{ReceiverGroupsModule:()=>j});var c=n(96814),h=n(31610),l=n(88762),m=n(23758),x=n(35461),g=n(85054);const b=[{type:"buttons",fixed:!0,buttons:[{name:"save",template:"grid-save-button"},{name:"edit",template:"grid-edit-button"},{name:"delete",template:"grid-delete-button"},{name:"cancel",template:"grid-cancel-button"}]},{dataField:"id",dataType:"string",visible:!1},{dataField:"idCode",dataType:"string",validationRules:[g.L],filterOperations:x.I.text},{dataField:"name",caption:"Name",dataType:"string",validationRules:[g.L]},{dataField:"sortingNumber",dataType:"number",visible:!1},{dataField:"tenantId",caption:"",dataType:"string",visible:!1},{dataField:"subTenantId",caption:"",dataType:"string",visible:!1},{name:"subTenantName",caption:"",dataType:"string",visible:!1},{dataField:"receiverIds",dataType:"string",visible:!1,calculateCellValue:a=>a.receiverIds.map(t=>({id:t.id,displayName:t.name}))},{dataField:"parentReceiverGroupId",caption:"",dataType:"string",visible:!1},{dataField:"concurrencyStamp",visible:!1}],v={index:"/api/app/receiver-groups",get:"/api/app/receiver-groups",create:"/api/app/receiver-groups",update:"/api/app/receiver-groups",delete:"/api/app/receiver-groups"},I=[{dataField:"subTenantId",path:"/api/app/receiver-groups/sub-tenant-lookup"},{dataField:"receiverIds",path:"/api/app/receiver-groups/receiver-lookup"}],R=[{dataField:"tenantId",translateKeys:["TenantId"]},{name:"tenantCode",translateKeys:["TenantId"]},{name:"tenantName",translateKeys:["TenantId"]},{dataField:"parentReceiverGroupId",translateKeys:["ParentReceiverGroupId"]},{name:"parentReceiverGroupCode",translateKeys:["ParentReceiverGroupId"]},{name:"parentReceiverGroupName",translateKeys:["ParentReceiverGroupId"]},{dataField:"name",translateKeys:["Name"]}],f=[{dataField:"id",mapping:["receiverGroup","id"]},{dataField:"concurrencyStamp",mapping:["receiverGroup","concurrencyStamp"]},{dataField:"receiverIds",queryStringKey:"receivers",mapping:["receivers"]},{dataField:"name",queryStringKey:"Name",mapping:["receiverGroup","name"]},{dataField:"idCode",queryStringKey:"IdCode",mapping:["receiverGroup","idCode"]},{dataField:"sortingNumber",queryStringKey:"SortingNumber",mapping:["receiverGroup","sortingNumber"]},{dataField:"subTenantId",queryStringKey:"SubTenantId",mapping:["subTenant","id"]},{dataField:"subTenantName",queryStringKey:"SubTenantName",mapping:["subTenant","name"]}],G={popup:{title:"::\u65b0\u589e",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:"85vw",height:"90vh"},form:{colCount:2,items:[{dataField:"idCode",editorType:"dxTextBox",colSpan:1},{dataField:"name",editorType:"dxTextBox",colSpan:1},{dataField:"sortingNumber",editorType:"dxNumberBox",colSpan:1},{dataField:"subTenantId",editorType:"dxSelectBox",colSpan:1,editorOptions:{displayExpr:"displayName"}},{dataField:"receiverIds",editorType:"dxTagBox",editorOptions:{displayExpr:"displayName"},colSpan:1}],elementAttr:{class:"basic-form basic-form-edit basic-form-edit-notification"}}},w={popup:{title:"::\u7de8\u8f2f",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}],width:"85vw",height:"90vh"},form:{colCount:2,items:[{dataField:"name",editorType:"dxTextBox",colSpan:1},{dataField:"sortingNumber",editorType:"dxNumberBox",colSpan:1},{dataField:"receiverIds",editorType:"dxTagBox",editorOptions:{displayExpr:"displayName"},colSpan:1}],elementAttr:{class:"basic-form basic-form-edit basic-form-edit-notification"}}};var e=n(19212),D=n(67),N=n(72783),M=n(67846),_=n(44347),P=n(65343),K=n(92931),A=n(16358),y=n(95051),O=n(20843),S=n(2173),V=n(25012),T=n(12305);const E=["grid"],B=["treeview"];function Q(a,p){1&a&&e.GkF(0)}const J=a=>({$implicit:a});function Z(a,p){if(1&a&&(e.ynx(0),e.YNc(1,Q,1,0,"ng-container",12),e.BQk()),2&a){const t=p.$implicit,r=e.oxw().$implicit,i=e.oxw();e.xp6(),e.Q6J("ngTemplateOutlet",i.templateStore.getGridTemplates(r.key))("ngTemplateOutletContext",e.VKq(2,J,t))}}function U(a,p){if(1&a&&(e.ynx(0),e.YNc(1,Z,2,4,"ng-container",10),e.BQk()),2&a){const t=p.$implicit;e.xp6(),e.Q6J("dxTemplateOf",t.key)}}function k(a,p){if(1&a&&(e.TgZ(0,"div"),e._UZ(1,"app-bottom-toolbar-btns",11),e.qZA()),2&a){e.oxw();const t=e.MAs(7);e.xp6(),e.Q6J("grid",t)}}const L=()=>({class:"custom-tree-view"}),Y=[{path:"",component:(()=>{class a{constructor(t,r,i,d){this.gridDataSourceService=t,this.templateStore=r,this.appRestService=i,this.configStateService=d,this.columns=b,this.cRUDEndpoints=v,this.dataFieldLookupSourceMapping=I,this.dataFieldTranslationKeysMapping=R,this.relatedDataValueAndQueryStringKeyMapping=f,this.editingPropertiesForCreating=G,this.editingPropertiesForUpdating=w,this.gridProperties={toolbar:{visible:!1}},this.breadCrumbData=[],this.treeViewDataSource=[],this.setGridDataSource=s=>{this.gridDataSource=this.gridDataSourceService.getDataSource(v,f),this.gridDataSource.filter([["SpecifiedTenantId","=",this.SpecifiedTenantId],["ParentReceiverGroupId","=",s]])},this.configStateService.getOne$("currentTenant").subscribe(s=>{this.SpecifiedTenantId=s.id})}ngOnInit(){this.setGridDataSource(),this.setTreeViewDataSource()}onInitNewRow(t){const r=this.configStateService.getOne("currentUser");t.data.parentReceiverGroupId=this.parentReceiverGroupId,t.data.tenantId=r.tenantId,t.data.receiverIds=[]}onRowClick(t){if(t.event.target.classList.contains("dx-button-content"))return;const r=this.treeViewDataSource.find(i=>i.id===t.data.id);this.setGridDataSource(t.data.id),this.treeview.instance.expandItem(r),this.treeview.instance.selectItem(r),this.parentReceiverGroupId=t.data.id}onRowInserted(t){this.treeViewDataSource.push({id:t.data.id,name:t.data.name,parentId:t.data.parentReceiverGroupId})}onRowRemoved(t){this.treeViewDataSource=this.treeViewDataSource.filter(r=>r.id!==t.data.id)}setTreeViewDataSource(){this.appRestService.request({method:"GET",url:"/api/app/receiver-groups"}).subscribe(t=>{const r=t.items.map(i=>i.receiverGroup).map(i=>({id:i.id,name:i.name,parentId:i.parentReceiverGroupId||"receiverGroups"}));this.treeViewDataSource=r,this.treeViewDataSource.unshift({id:"receiverGroups",name:"\u63a5\u6536\u8005\u7fa4\u7d44",parentId:null,selected:!0,expanded:!0})})}onTreeViewItemClick(t){this.setGridDataSource("receiverGroups"===t.itemData.id?null:t.itemData.id),this.treeview.instance.expandItem(t.itemData),this.treeview.instance.selectItem(t.itemData),this.parentReceiverGroupId=t.itemData.id}static#e=this.\u0275fac=function(r){return new(r||a)(e.Y36(D.I),e.Y36(N.z),e.Y36(l.vgb),e.Y36(l.XJE))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-receiver-groups"]],viewQuery:function(r,i){if(1&r&&(e.Gf(E,5),e.Gf(B,5)),2&r){let d;e.iGM(d=e.CRH())&&(i.grid=d.first),e.iGM(d=e.CRH())&&(i.treeview=d.first)}},decls:14,vars:20,consts:[[1,"receiver-groups"],[1,"receiver-groups-tree-view"],["appGridAddButton","",3,"onClick"],["selectionMode","single","dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId",3,"dataSource","elementAttr","focusStateEnabled","activeStateEnabled","hoverStateEnabled","onItemClick"],["treeview",""],[1,"receiver-groups-data-grid"],["appGridFeature","","appGridFeatureNotification","",3,"dataFieldTranslationKeysMapping","datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","gridProperties","isEditingDataAsync","onInitNewRow","onRowClick","onRowInserted","onRowRemoved"],["grid",""],["name","applyFilterButton","cssClass","d-none"],[4,"ngFor","ngForOf"],[4,"dxTemplate","dxTemplateOf"],[3,"grid"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,i){if(1&r){const d=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"dx-button",2),e.NdJ("onClick",function(){e.CHM(d);const o=e.MAs(7);return e.KtG(o.instance.addRow())}),e.qZA(),e.TgZ(3,"dx-tree-view",3,4),e.NdJ("onItemClick",function(o){return i.onTreeViewItemClick(o)}),e.qZA()(),e.TgZ(5,"div",5)(6,"dx-data-grid",6,7),e.NdJ("onInitNewRow",function(o){return i.onInitNewRow(o)})("onRowClick",function(o){return i.onRowClick(o)})("onRowInserted",function(o){return i.onRowInserted(o)})("onRowRemoved",function(o){return i.onRowRemoved(o)}),e.TgZ(8,"dxo-toolbar"),e._UZ(9,"dxi-item",8),e.qZA(),e.YNc(10,U,2,1,"ng-container",9),e.ALo(11,"keyvalue"),e.YNc(12,k,2,1,"div",10),e.qZA(),e._UZ(13,"app-notification-pager",11),e.qZA()()}if(2&r){const d=e.MAs(7);e.xp6(3),e.Q6J("dataSource",i.treeViewDataSource)("elementAttr",e.DdM(19,L))("focusStateEnabled",!1)("activeStateEnabled",!1)("hoverStateEnabled",!1),e.xp6(3),e.Q6J("dataFieldTranslationKeysMapping",i.dataFieldTranslationKeysMapping)("datafieldValueQueryStringKeyMapping",i.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",i.dataFieldLookupSourceMapping)("editingPropertiesForCreating",i.editingPropertiesForCreating)("editingPropertiesForUpdating",i.editingPropertiesForUpdating)("columns",i.columns)("dataSource",i.gridDataSource)("gridProperties",i.gridProperties)("isEditingDataAsync",!0),e.xp6(4),e.Q6J("ngForOf",e.lcZ(11,17,i.templateStore.gridTemplates)),e.xp6(2),e.Q6J("dxTemplateOf","bottom-toolbar"),e.xp6(),e.Q6J("grid",d)}},dependencies:[c.sg,c.tP,M.S,_._,P.f,K.R,A.K,O.p6,y.u,S.ZT3,V.e,S.y1f,T.D,c.Nd],styles:[".receiver-groups[_ngcontent-%COMP%]{margin-top:24px;padding-top:16px;display:flex;flex-wrap:wrap}.receiver-groups-tree-view[_ngcontent-%COMP%]{flex:1;border-right:1px solid var(--gray-3)}.receiver-groups-tree-view[_ngcontent-%COMP%]   dx-tree-view[_ngcontent-%COMP%]{margin-top:4px}.receiver-groups-data-grid[_ngcontent-%COMP%]{flex:2;padding:0 8px;margin-top:-13px;display:flex;flex-direction:column;justify-content:space-between}.receiver-groups-data-grid[_ngcontent-%COMP%]     .dx-datagrid-header-panel{display:none}.receiver-groups-data-grid[_ngcontent-%COMP%]     dx-data-grid{height:90%!important}.receiver-groups-data-grid[_ngcontent-%COMP%]     app-notification-pager .pager{margin-top:0}"]})}return a})(),canActivate:[l.a1M,l.nG9]}];let $=(()=>{class a{static#e=this.\u0275fac=function(r){return new(r||a)};static#t=this.\u0275mod=e.oAB({type:a});static#i=this.\u0275inj=e.cJS({imports:[m.Bz.forChild(Y),m.Bz]})}return a})();var z=n(5533);let j=(()=>{class a{static#e=this.\u0275fac=function(r){return new(r||a)};static#t=this.\u0275mod=e.oAB({type:a});static#i=this.\u0275inj=e.cJS({imports:[c.ez,$,h.m,z.P,y.V,T.D]})}return a})()}}]);