"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[42129],{68833:(_,u,l)=>{l.d(u,{d:()=>f});var p=l(86359),r=l(19212);let f=(()=>{class t{constructor(){this.selected=!0,this.notificationRadioButton=[]}ngOnInit(){this.initCellInfoItem()}initCellInfoItem(){return"isForAllReceivers"===this.cellInfo.item.dataField?this.initIsForAllReceivers():"isUsingSpecificNotificationSettings"===this.cellInfo.item.dataField?this.initIsUsingSpecificNotificationSettings():"isUsingTemplate"===this.cellInfo.item.dataField?this.initIsUsingTemplate():void 0}initIsForAllReceivers(){this.notificationRadioButton=[{name:"\u6240\u6709\u4eba",selected:!0},{name:"\u6307\u5b9a\u63a5\u6536\u8005",selected:!1}],(0!==this.cellInfo.data.receiverGroupIds.length||0!==this.cellInfo.data.receiverIds.length)&&(this.selected=this.cellInfo.value)}initIsUsingSpecificNotificationSettings(){this.notificationRadioButton=[{name:"\u5957\u7528\u5171\u7528\u8a2d\u5b9a",selected:!1},{name:"\u53e6\u884c\u8a2d\u5b9a",selected:!0}],this.selected=this.cellInfo.value}initIsUsingTemplate(){if(this.notificationRadioButton=[{name:"\u81ea\u8a02",selected:!1},{name:"\u6a21\u677f",selected:!0}],!this.cellInfo.data.notificationTemplateId||!this.cellInfo.data.notificationTemplateArgs)return this.selected=!1,void this.cellInfo.setValue(!1);this.selected=!0,this.cellInfo.setValue(!0)}onValueChanged(d){this.cellInfo.setValue(d.value)}static#t=this.\u0275fac=function(m){return new(m||t)};static#e=this.\u0275cmp=r.Xpm({type:t,selectors:[["app-notification-radio-button"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[r.jDz],decls:1,vars:5,consts:[["appRadioGroup","","layout","horizontal","displayExpr","name","valueExpr","selected",3,"dataSource","value","activeStateEnabled","hoverStateEnabled","focusStateEnabled","onValueChanged"]],template:function(m,n){1&m&&(r.TgZ(0,"dx-radio-group",0),r.NdJ("onValueChanged",function(s){return n.onValueChanged(s)}),r.qZA()),2&m&&r.Q6J("dataSource",n.notificationRadioButton)("value",n.selected)("activeStateEnabled",!1)("hoverStateEnabled",!1)("focusStateEnabled",!1)},dependencies:[p._,p.I]})}return t})()},44932:(_,u,l)=>{l.d(u,{h:()=>o});var p=l(61157),r=l(88762),f=l(96814),t=l(19212),g=l(53009);function d(s,i){1&s&&(t.TgZ(0,"span",7),t._uU(1,"\xa0*"),t.qZA())}function m(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",8)(1,"div",9),t._uU(2),t.qZA(),t.TgZ(3,"div",10),t.NdJ("click",function(){const h=t.CHM(e).$implicit,x=t.oxw();return t.KtG(x.removeProvider(h.id))}),t.qZA()()}if(2&s){const e=i.$implicit;t.xp6(2),t.hij(" ",e.name," ")}}const n=s=>({"notification-tag-box-list--show":s});let o=(()=>{class s{constructor(e){this.appRestService=e,this.label="",this.required=!1,this.fetchUrl="",this.notificationTagBoxList=[],this.notificationTagBoxItems=[]}ngOnInit(){this.initCellInfoItem(),this.fetchNotificationTagBoxList()}onValueChanged(e){this.selectNotificationTagBoxItems(e.value)}initCellInfoItem(){this.label=this.cellInfo.item.label.text,this.required=this.cellInfo.column.validationRules&&"required"===this.cellInfo.column.validationRules[0].type}fetchNotificationTagBoxList(){switch(this.cellInfo.item.dataField){case"notificationProviderDefinitionIds":this.fetchUrl="/api/app/notification-infos/assignable-notification-provider-definitions";break;case"receiverIds":this.fetchUrl="/api/app/notification-infos/assignable-receivers"}this.appRestService.request({method:"GET",url:this.fetchUrl}).subscribe(e=>{this.notificationTagBoxList=e.items,this.initNotificationTagBoxItems()})}initNotificationTagBoxItems(){!this.cellInfo.value||!Array.isArray(this.cellInfo.value)||0===this.cellInfo.value.length||(this.notificationTagBoxItems=this.notificationTagBoxList.filter(e=>this.cellInfo.value.includes(e.id)))}selectNotificationTagBoxItems(e){this.notificationTagBoxItems=e;const a=this.notificationTagBoxItems.map(c=>c.id);this.cellInfo.setValue(a)}removeProvider(e){const a=this.notificationTagBoxItems.findIndex(c=>c.id===e);this.notificationTagBoxItems.splice(a,1)}static#t=this.\u0275fac=function(a){return new(a||s)(t.Y36(g.$))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-notification-tag-box"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[t.jDz],decls:10,vars:10,consts:[[1,"notification-tag-box"],[1,"notification-tag-box-label","dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["class","dx-field-item-required-mark"],["appTagBox","","displayExpr","name","validationMessageMode","always","labelMode","outside","placeholder","\u9078\u64c7...",3,"dataSource","value","activeStateEnabled","focusStateEnabled","hoverStateEnabled","onValueChanged"],[1,"notification-tag-box-list",3,"ngClass"],[1,"dx-field-item-required-mark"],[1,"notification-tag-box-item"],[1,"notification-tag-box-item-name"],[1,"notification-tag-box-item-close",3,"click"],["class","notification-tag-box-item"]],template:function(a,c){1&a&&(t.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),t._uU(4),t.qZA(),t.YNc(5,d,2,0,"span",4),t.qZA()(),t.TgZ(6,"dx-tag-box",5),t.NdJ("onValueChanged",function(x){return c.onValueChanged(x)}),t.qZA(),t.TgZ(7,"div",6),t.SjG(8,m,4,1,"div",11,t.ikw),t.qZA()()),2&a&&(t.xp6(4),t.hij(" ",c.label," "),t.xp6(),t.um2(5,c.required?5:-1),t.xp6(),t.Q6J("dataSource",c.notificationTagBoxList)("value",c.notificationTagBoxItems)("activeStateEnabled",!1)("focusStateEnabled",!1)("hoverStateEnabled",!1),t.xp6(),t.Q6J("ngClass",t.VKq(8,n,c.notificationTagBoxItems.length)),t.xp6(),t.wJu(c.notificationTagBoxItems))},dependencies:[p._,p.U,r.vaR,f.ez,f.mk],styles:[".notification-tag-box{margin-top:16px}  .notification-tag-box-label{margin-bottom:8px}  .notification-tag-box-list{display:flex;flex-wrap:wrap;gap:16px}  .notification-tag-box-list--show{margin-top:16px}  .notification-tag-box-item{border-radius:16px;padding:4px 8px;background-color:var(--blue-2);display:flex;align-items:center;gap:4px;cursor:default}  .notification-tag-box-item:hover{box-shadow:1px 3px 3px #0000001a}  .notification-tag-box-item-close{content:url(remove-icon.17068bf6ca3a3713.svg)}"]})}return s})()},68545:(_,u,l)=>{l.d(u,{E:()=>n});var p=l(65437),r=l(74291),f=l(96814),t=l(19212),g=l(53009);const d=(o,s)=>s.key;function m(o,s){if(1&o){const i=t.EpF();t.TgZ(0,"dx-text-box",4),t.NdJ("valueChange",function(a){const h=t.CHM(i).$implicit;return t.KtG(h.value=a)})("onValueChanged",function(){t.CHM(i);const a=t.oxw();return t.KtG(a.onValueChanged())}),t.qZA()}if(2&o){const i=s.$implicit;t.Q6J("label",i.key)("value",i.value)}}let n=(()=>{class o{get renderNotificationTemplateContent(){return this.notificationTemplateContent&&0!==this.notificationTemplateArgs.length?this.notificationTemplateArgs.reduce((i,e)=>{const a=new RegExp(`\\{\\{\\s*${e.key}\\s*\\}\\}`,"g");return i.replace(a,e.value||`{{ ${e.key} }}`)},this.notificationTemplateContent):this.notificationTemplateContent}constructor(i){this.appRestService=i,this.notificationTemplateId="",this.notificationTemplateContent="",this.notificationTemplateArgs=[]}ngOnInit(){}ngOnChanges(i){this.fetchNotificationTemplateId(i)}onValueChanged(){this.stringfyNotificationTemplateArgs()}fetchNotificationTemplateId(i){!i.notificationTemplateId||!i.notificationTemplateId.currentValue||(this.appRestService.request({method:"GET",url:`/api/app/notification-templates/${this.notificationTemplateId}`}).subscribe(e=>{this.notificationTemplateContent=e.content}),this.appRestService.request({method:"GET",url:`/api/app/notification-templates/args/${this.notificationTemplateId}`}).subscribe(e=>{if(this.notificationTemplateArgs=e.map(a=>({key:a,value:""})),this.cellInfo.value){const a=JSON.parse(this.cellInfo.value);this.notificationTemplateArgs.forEach(c=>c.value=a[c.key])}}))}stringfyNotificationTemplateArgs(){const i=JSON.stringify(this.notificationTemplateArgs.reduce((e,a)=>(e[a.key]=a.value,e),{}));this.cellInfo.setValue(i)}static#t=this.\u0275fac=function(e){return new(e||o)(t.Y36(g.$))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-notification-template-args"]],inputs:{cellInfo:"cellInfo",notificationTemplateId:"notificationTemplateId"},standalone:!0,features:[t.TTD,t.jDz],decls:6,vars:3,consts:[[1,"notification-template",3,"hidden"],[1,"notification-template-content"],[3,"value","readOnly"],[1,"notification-template-args"],["labelMode","outside","valueChangeEvent","keyup",3,"label","value","valueChange","onValueChanged"],["labelMode","outside","valueChangeEvent","keyup",3,"label","value"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"dx-text-area",2),t.qZA(),t.TgZ(3,"div",3),t.SjG(4,m,1,2,"dx-text-box",5,d),t.qZA()()),2&e&&(t.Q6J("hidden",!a.notificationTemplateId),t.xp6(2),t.Q6J("value",a.renderNotificationTemplateContent)("readOnly",!0),t.xp6(2),t.wJu(a.notificationTemplateArgs))},dependencies:[p._,p.m,r.a,r.I,f.ez],styles:[".notification-template[_ngcontent-%COMP%]{display:flex;gap:16px}.notification-template-content[_ngcontent-%COMP%], .notification-template-args[_ngcontent-%COMP%]{flex:1}.notification-template-content[_ngcontent-%COMP%]   dx-text-area[_ngcontent-%COMP%]{height:100%}.notification-template-content[_ngcontent-%COMP%]   dx-text-area.dx-state-disabled[_ngcontent-%COMP%], .notification-template-content[_ngcontent-%COMP%]   dx-text-area.dx-state-readonly[_ngcontent-%COMP%]{opacity:1}.notification-template-content[_ngcontent-%COMP%]   dx-text-area.dx-state-disabled[_ngcontent-%COMP%]     textarea.dx-texteditor-input, .notification-template-content[_ngcontent-%COMP%]   dx-text-area.dx-state-readonly[_ngcontent-%COMP%]     textarea.dx-texteditor-input{color:var(--black-1);cursor:default}.notification-template-args[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}"]})}return o})()},65343:(_,u,l)=>{l.d(u,{f:()=>g});var p=l(14891),r=l(19212),f=l(25012),t=l(72783);let g=(()=>{class d{constructor(n,o,s){this.grid=n,this.viewContainerRef=o,this.templateStore=s,this.masterDetailRowCollapseKey="",this.editorPreparing=i=>{this.applyFilterRow(i)},this.rowExpanded=i=>{this.applyMasterDetailRowCollapse(i)}}ngOnInit(){this.basicFilterRowTemplate=this.templateStore.getGridTemplates("basicFilterRowTemplate")}ngAfterViewInit(){this.applyDataGridProperties(),this.grid.instance.on("editorPreparing",this.editorPreparing),this.grid.instance.on("rowExpanded",this.rowExpanded)}applyDataGridProperties(){const n=this.grid.instance.option("columns").map(o=>("string"!=typeof o&&!o.type&&!1!==o.visible&&(o.minWidth=132),o));n.push({type:"detailExpand",fixed:!0,fixedPosition:"right"}),this.grid.instance.option({masterDetail:{enabled:!0,template:"basic-master-detail-row-template"},elementAttr:{class:"basic-data-grid-table"},showColumnHeaders:!1,filterRow:{showOperationChooser:!1},columns:n}),this.gridProperties&&this.grid.instance.option(this.gridProperties)}applyFilterRow(n){if("filterRow"!==n.parentType)return;n.cancel=!0;const o=this.viewContainerRef.createEmbeddedView(this.basicFilterRowTemplate,{options:n,grid:this.grid});o.rootNodes.forEach(s=>{n.editorElement.appendChild(s)}),(0,p.J_)(n.editorElement,"dxremove",()=>{o.destroy()})}applyMasterDetailRowCollapse(n){setTimeout(()=>{const s=n.element.querySelector('[aria-label="Collapse"]').parentElement.ariaRowIndex;n.element.querySelector(`tr.dx-row.dx-data-row.dx-row-lines[aria-rowindex="${s}"]`).classList.add("master-detail-row-collapse")}),n.key!==this.masterDetailRowCollapseKey&&(n.component.collapseRow(this.masterDetailRowCollapseKey),this.masterDetailRowCollapseKey=n.key)}static#t=this.\u0275fac=function(o){return new(o||d)(r.Y36(f.e),r.Y36(r.s_b),r.Y36(t.z))};static#e=this.\u0275dir=r.lG2({type:d,selectors:[["","appGridFeatureNotification",""]],inputs:{gridProperties:"gridProperties"},standalone:!0})}return d})()}}]);