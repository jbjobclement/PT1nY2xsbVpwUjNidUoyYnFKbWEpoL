"use strict";(self.webpackChunkJBNotifier=self.webpackChunkJBNotifier||[]).push([[42318],{26600:(V,E,a)=>{a.d(E,{c:()=>w});var e=a(19212),f=a(77490),i=a(96814);const t=(_,x)=>{if(void 0===x)return[];const n=[];return function o(s){_.filter(I=>I.parentId===s).forEach(I=>{n.push(I.id),o(I.id)})}(x),n};var p=a(16358),T=a(20843),m=a(95051),c=a(98179),l=a(61157),h=a(37072),r=a(21137);const u=["tree"];function g(_,x){if(1&_){const n=e.EpF();e.TgZ(0,"dx-tree-view",8,9),e.NdJ("onItemSelectionChanged",function(s){e.CHM(n);const d=e.oxw(2);return e.KtG(d.onItemSelectionChanged(s))}),e.qZA()}if(2&_){const n=e.oxw(2);e.Q6J("dataSource",n._dataSource)("selectNodesRecursive",!1)}}function b(_,x){if(1&_){const n=e.EpF();e.TgZ(0,"dx-scroll-view")(1,"div",3)(2,"div",4)(3,"dx-button",5),e.NdJ("onClick",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.restore())}),e.qZA()(),e.TgZ(4,"dx-check-box",6),e.NdJ("onValueChanged",function(s){e.CHM(n);const d=e.oxw();return e.KtG(d.onCustomSelectNodesRecursiveChanged(s))}),e.qZA(),e.TgZ(5,"span"),e._uU(6,"\u5b50\u9805\u76ee\u9023\u52d5"),e.qZA()(),e.YNc(7,g,2,2,"dx-tree-view",7),e.qZA()}if(2&_){const n=e.oxw();e.xp6(4),e.Q6J("value",n.customSelectNodesRecursive),e.xp6(3),e.Q6J("ngIf",n.popupVisible)}}function R(_,x){if(1&_){const n=e.EpF();e.TgZ(0,"div")(1,"dx-button",10),e.NdJ("onClick",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.onConfirm())}),e.qZA()()}}let w=(()=>{class _{constructor(){this.customSelectNodesRecursive=!0,this.tagBoxSelected=[],this.treeViewselected=[],this._originSelected=[],this._dataSource=[],this.selected=[],this.dataSource=[],this.isViewMode=!1,this.selectedChange=new e.vpe,this.popupVisible=!1,this.popupButtonToolBars=[{toolbar:"bottom",template:"bottom-toolbar",location:"after"}],this.onCustomSelectNodesRecursiveChanged=n=>{this.customSelectNodesRecursive=n.value},this.restore=()=>{const n=this.customSelectNodesRecursive;this.customSelectNodesRecursive=!1,this.tree.instance.unselectAll(),this._originSelected.forEach(o=>{this.tree.instance.selectItem(o)}),this.customSelectNodesRecursive=n},this.onTagBoxFocusIn=()=>{const n=function v(_){const x=new Set;return _.filter(o=>!o.parentId).forEach(function n(o){if(o.selected){let d=o.parentId;for(;d;)x.add(d),d=_.find(I=>I.id===d)?.parentId}_.filter(d=>d.parentId===o.id).forEach(n)}),Array.from(x)}(this._dataSource);((_,x)=>{this._dataSource.forEach(n=>{const o=void 0!==x.find(s=>s===n.id);n.expanded=o})})(0,n),this.popupVisible=!0}}ngOnChanges(n){n.selected&&(this.treeViewselected=this.selected.map(o=>o),this.tagBoxSelected=this.selected.map(o=>o),this._originSelected=[...this.selected]),n.selected&&n.dataSource&&(this._dataSource=((_,x)=>this.dataSource.map(o=>{const s=void 0!==x.find(d=>d===o.id);return x.find(d=>d===o.id)?{...o,selected:s}:o}))(0,this.selected),this._originSelected=[...this.selected])}onItemSelectionChanged(n){if(this.customSelectNodesRecursive&&!0===n.itemData?.selected){const o=n.itemData?.id;t(this.dataSource,o).forEach(d=>{this.tree.instance.selectItem(d)})}if(this.customSelectNodesRecursive&&!1===n.itemData?.selected){const o=n.itemData?.id;t(this.dataSource,o).forEach(d=>{this.tree.instance.unselectItem(d)})}this.treeViewselected=this._dataSource.filter(o=>o.selected).map(o=>o.id)}onConfirm(){this.tagBoxSelected=this.treeViewselected.map(n=>n),this.popupVisible=!1,this.selectedChange.emit(this.treeViewselected)}onTagBoxSelectionChanged(n){if(n.removedItems.length){const o=n.removedItems.map(s=>s.id);this.treeViewselected=this.treeViewselected.filter(s=>void 0===o.find(d=>s===d)),this._dataSource.forEach(s=>{o.find(I=>s.id===I)&&(s.selected=!1)}),this.selectedChange.emit(this.treeViewselected)}}static#e=this.\u0275fac=function(o){return new(o||_)};static#t=this.\u0275cmp=e.Xpm({type:_,selectors:[["app-jb-tree-view"]],viewQuery:function(o,s){if(1&o&&e.Gf(u,5),2&o){let d;e.iGM(d=e.CRH())&&(s.tree=d.first)}},inputs:{selected:"selected",dataSource:"dataSource",isViewMode:"isViewMode"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[e.TTD,e.jDz],decls:4,vars:10,consts:[["valueExpr","id","displayExpr","name",3,"value","dataSource","openOnFieldClick","multiline","disabled","valueChange","onSelectionChanged","onFocusIn"],["contentTemplate","contentTemplate","width","35%","minWidth","300px",3,"toolbarItems","visible","showTitle"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","align-items-center","mb-1"],[1,"me-1"],["type","default","text","\u5fa9\u539f",3,"onClick"],[3,"value","onValueChanged"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged",4,"ngIf"],["dataStructure","plain","keyExpr","id","displayExpr","name","parentIdExpr","parentId","selectionMode","multiple","showCheckBoxesMode","normal",3,"dataSource","selectNodesRecursive","onItemSelectionChanged"],["tree",""],["text","\u78ba\u5b9a",3,"onClick"]],template:function(o,s){1&o&&(e.TgZ(0,"dx-tag-box",0),e.NdJ("valueChange",function(I){return s.tagBoxSelected=I})("onSelectionChanged",function(I){return s.onTagBoxSelectionChanged(I)})("onFocusIn",function(){return s.onTagBoxFocusIn()}),e.qZA(),e.TgZ(1,"dx-popup",1),e.YNc(2,b,8,2,"dx-scroll-view",2)(3,R,2,0,"div",2),e.qZA()),2&o&&(e.Q6J("value",s.tagBoxSelected)("dataSource",s._dataSource)("openOnFieldClick",!1)("multiline",!0)("disabled",s.isViewMode),e.xp6(),e.Q6J("toolbarItems",s.popupButtonToolBars)("visible",s.popupVisible)("showTitle",!1),e.xp6(),e.Q6J("dxTemplateOf","contentTemplate"),e.xp6(),e.Q6J("dxTemplateOf","bottom-toolbar"))},dependencies:[f.P,p.K,T.p6,m.u,c.x,l.U,h.N,r.v,i.ez,i.O5]})}return _})()},36744:(V,E,a)=>{a.d(E,{b:()=>i});var e=a(86359),f=a(19212);let i=(()=>{class v{constructor(){this.isViewMode=!1,this.notificationSettingRadioGroupDataSource=[],this.notificationSettingRadioGroupValue=null}ngOnInit(){this.notificationSettingRadioGroupDataSource=[{type:"share",text:"\u5957\u7528\u5171\u7528\u8a2d\u5b9a"},{type:"custom",text:"\u53e6\u884c\u8a2d\u5b9a"}],this.notificationSettingRadioGroupValue=this.notificationSettingRadioGroupDataSource[0]}onNotificationSettingRadioGroupChanged(C){this.cellInfo.setValue("share"===C.value.type?"share":"custom")}static#e=this.\u0275fac=function(S){return new(S||v)};static#t=this.\u0275cmp=f.Xpm({type:v,selectors:[["app-notification-setting-items-radio-group"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode"},standalone:!0,features:[f.jDz],decls:2,vars:3,consts:[["displayExpr","text","layout","horizontal",3,"dataSource","value","readOnly","valueChange","onValueChanged"],["radioGroup",""]],template:function(S,p){1&S&&(f.TgZ(0,"dx-radio-group",0,1),f.NdJ("valueChange",function(m){return p.notificationSettingRadioGroupValue=m})("onValueChanged",function(m){return p.onNotificationSettingRadioGroupChanged(m)}),f.qZA()),2&S&&f.Q6J("dataSource",p.notificationSettingRadioGroupDataSource)("value",p.notificationSettingRadioGroupValue)("readOnly",p.isViewMode)},dependencies:[e._,e.I]})}return v})()},90962:(V,E,a)=>{a.d(E,{b:()=>c});var e=a(6990),i=a(74291),v=a(10518),t=a(19212),C=a(53009);const S=(l,h)=>h.notificationSettingDefinitionId;function p(l,h){if(1&l){const r=t.EpF();t.TgZ(0,"dx-select-box",4),t.NdJ("valueChange",function(g){t.CHM(r);const b=t.oxw().$implicit;return t.KtG(b.value=g)})("onValueChanged",function(g){t.CHM(r);const b=t.oxw().$index,R=t.oxw();return t.KtG(R.onSettingValueChanged(g,b))}),t.qZA()}if(2&l){const r=t.oxw().$implicit,u=t.oxw();t.Q6J("dataSource",u.selectBoxDataSource)("value",r.value)}}function T(l,h){if(1&l){const r=t.EpF();t.TgZ(0,"dx-text-box",5),t.NdJ("valueChange",function(g){t.CHM(r);const b=t.oxw().$implicit;return t.KtG(b.value=g)})("onValueChanged",function(g){t.CHM(r);const b=t.oxw().$index,R=t.oxw();return t.KtG(R.onSettingValueChanged(g,b))}),t.qZA()}if(2&l){const r=t.oxw().$implicit;t.Q6J("value",r.value)}}function m(l,h){if(1&l&&(t.TgZ(0,"div",1)(1,"div",2),t._uU(2),t.qZA(),t.TgZ(3,"div"),t.YNc(4,p,1,2,"dx-select-box",3)(5,T,1,1),t.qZA()()),2&l){const r=h.$implicit,u=h.$index,g=t.oxw();t.xp6(2),t.hij(" ",g.displayNames[u]," "),t.xp6(2),t.um2(4,"b6b5fb16-6f45-f7ad-85e3-3a1229a3ead0"===r.notificationSettingDefinitionId?4:5)}}let c=(()=>{class l{constructor(r){this.appRestService=r,this.notificationSetting=[],this.displayNames=[],this.selectBoxDataSource=["A","M"]}ngOnChanges(){this.applyNotificationSettingItems(),this.fetchCustomNotificationSettingItems(),this.clearCustomNotificationSettingItems()}applyNotificationSettingItems(){if(0===this.notificationSetting.length)return;const r=(0,e.cloneDeep)(this.notificationSetting);this.cellInfo.setValue(r)}fetchCustomNotificationSettingItems(){this.notificationSetting.length>0||this.appRestService.request({method:"GET",url:"/api/app/notification-settings/current-tenant"}).subscribe(r=>{r.forEach(u=>{this.notificationSetting.push((0,e.cloneDeep)({notificationSettingDefinitionId:u.notificationSettingDefinition.id,value:u.notificationSetting.value||u.notificationSettingDefinition.defaultValue,isInherited:u.notificationSetting.isInherited})),this.displayNames.push(u.notificationSettingDefinition.displayName)}),this.applyNotificationSettingItems()})}clearCustomNotificationSettingItems(){0!==this.notificationSetting.length&&this.cellInfo.setValue(null)}onSettingValueChanged(r,u){this.notificationSetting[u].value=r.value,this.applyNotificationSettingItems()}static#e=this.\u0275fac=function(u){return new(u||l)(t.Y36(C.$))};static#t=this.\u0275cmp=t.Xpm({type:l,selectors:[["app-notification-setting-items"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[t.TTD,t.jDz],decls:3,vars:0,consts:[[1,"notification-setting-list"],[1,"notification-setting-item"],[1,"notification-setting-item-label"],["valueChangeEvent","keyup",3,"dataSource","value"],["valueChangeEvent","keyup",3,"dataSource","value","valueChange","onValueChanged"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","notification-setting-item"]],template:function(u,g){1&u&&(t.TgZ(0,"div",0),t.SjG(1,m,6,2,"div",6,S),t.qZA()),2&u&&(t.xp6(),t.wJu(g.notificationSetting))},dependencies:[i.a,i.I,v.D,v._],styles:[".notification-setting-list[_ngcontent-%COMP%]{margin-top:-8px;display:flex;flex-direction:column;gap:16px}.notification-setting-item-label[_ngcontent-%COMP%]{margin-bottom:8px}"]})}return l})()},98991:(V,E,a)=>{a.d(E,{D:()=>S});var e=a(26600),f=a(96814),i=a(19212),v=a(53009);function t(p,T){if(1&p){const m=i.EpF();i.TgZ(0,"div",6)(1,"div",7),i._uU(2),i.qZA(),i.TgZ(3,"div",8),i.NdJ("click",function(){const h=i.CHM(m).$implicit,r=i.oxw();return i.KtG(r.removeProvider(h))}),i.qZA()()}if(2&p){const m=T.$implicit;i.xp6(2),i.hij(" ",m," ")}}const C=p=>({"notification-tag-box-list--show":p});let S=(()=>{class p{constructor(m){this.appRestService=m,this.label="",this.selectedReceiverGroups=["1","1-1-1","2","2-1-2"],this.receiverGroups=[{id:"1",name:"1"},{id:"1-1",name:"1-1",parentId:"1"},{id:"1-1-1",name:"1-1-1",parentId:"1-1"},{id:"1-1-2",name:"1-1-2",parentId:"1-1"},{id:"2",name:"2"},{id:"2-1",name:"2-1",parentId:"2"},{id:"2-1-1",name:"2-1-1",parentId:"2-1"},{id:"2-1-2",name:"2-1-2",parentId:"2-1"},{id:"2-1-3",name:"2-1-3",parentId:"2-1"}]}ngOnInit(){this.label=this.cellInfo.item.label.text,this.appRestService.request({method:"GET",url:"/api/app/notification-infos/assignable-receiver-groups"}).subscribe(m=>{})}selectedChange(m){this.selectedReceiverGroups=m}removeProvider(m){this.selectedReceiverGroups=this.selectedReceiverGroups.filter(c=>m!==c)}static#e=this.\u0275fac=function(c){return new(c||p)(i.Y36(v.$))};static#t=this.\u0275cmp=i.Xpm({type:p,selectors:[["app-receiver-group-tree-view"]],inputs:{cellInfo:"cellInfo"},standalone:!0,features:[i.jDz],decls:9,vars:6,consts:[[1,"notification-tag-box"],[1,"notification-tag-box-label","dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],[3,"selected","dataSource","selectedChange"],[1,"notification-tag-box-list",3,"ngClass"],[1,"notification-tag-box-item"],[1,"notification-tag-box-item-name"],[1,"notification-tag-box-item-close",3,"click"],["class","notification-tag-box-item"]],template:function(c,l){1&c&&(i.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),i._uU(4),i.qZA()()(),i.TgZ(5,"app-jb-tree-view",4),i.NdJ("selectedChange",function(r){return l.selectedChange(r)}),i.qZA(),i.TgZ(6,"div",5),i.SjG(7,t,4,1,"div",9,i.ikw),i.qZA()()),2&c&&(i.xp6(4),i.hij(" ",l.label," "),i.xp6(),i.Q6J("selected",l.selectedReceiverGroups)("dataSource",l.receiverGroups),i.xp6(),i.Q6J("ngClass",i.VKq(4,C,l.selectedReceiverGroups.length)),i.xp6(),i.wJu(l.selectedReceiverGroups))},dependencies:[e.c,f.ez,f.mk]})}return p})()},38653:(V,E,a)=>{a.d(E,{k:()=>p});var e=a(96814),f=a(61157),i=a(37398),v=a(66648),t=a(19212),C=a(88762),S=a(24106);let p=(()=>{class T{constructor(c,l){this.restService=c,this.localizationService=l,this.isViewMode=!1,this.hideReceiverTagBox=!1,this.receiversDataSource$=null,this.currentDataField="",this.receivers=[]}ngOnChanges(c){window.component=this,!this.hideReceiverTagBox&&this.receivers.length>0&&this.cellInfo.setValue([...this.receivers])}ngOnInit(){this.currentDataField=this.cellInfo.column.dataField,this.cellInfo.column.validationRules=[{type:"custom",message:this.localizationService.instant("AbpValidation::ThisFieldIsRequired."),validationCallback:this.receiverTagBoxValidationCallback}],this.receiversDataSource$=this.restService.request({method:"GET",url:"/api/app/notification-infos/assignable-receivers"}).pipe((0,i.U)(c=>c.items))}onValueChanged(c){this.receivers=[...c.value],this.cellInfo.setValue(c.value)}receiverTagBoxValidationCallback(c){return!!(c.data.isForAllReceivers||c.data[c.column.dataField]&&0!==c.data[c.column.dataField].length)}static#e=this.\u0275fac=function(l){return new(l||T)(t.Y36(C.vgb),t.Y36(C.oQ8))};static#t=this.\u0275cmp=t.Xpm({type:T,selectors:[["app-receiver-tag-box"]],inputs:{cellInfo:"cellInfo",isViewMode:"isViewMode",hideReceiverTagBox:"hideReceiverTagBox"},standalone:!0,features:[t.TTD,t.jDz],decls:7,vars:6,consts:[[3,"hidden"],[1,"dx-field-item-label","dx-field-item-label-location-top"],[1,"dx-field-item-label-content"],[1,"dx-field-item-label-text"],["appTagBox","","receiverTagBox","","displayExpr","name","valueExpr","id","validationMessageMode","always",3,"dataSource","value","disabled","onValueChanged"]],template:function(l,h){1&l&&(t.TgZ(0,"div",0)(1,"label",1)(2,"span",2)(3,"span",3),t._uU(4," \u63a5\u6536\u8005 (\u591a\u7b46) "),t.qZA()()(),t.TgZ(5,"dx-tag-box",4),t.NdJ("onValueChanged",function(u){return h.onValueChanged(u)}),t.ALo(6,"async"),t.qZA()()),2&l&&(t.Q6J("hidden",h.hideReceiverTagBox),t.xp6(5),t.Q6J("dataSource",t.lcZ(6,4,h.receiversDataSource$))("value",h.cellInfo.value)("disabled",h.isViewMode))},dependencies:[f._,f.U,e.ez,e.Ov,v.m,S.x],styles:["dx-tag-box[apptagbox][receiverTagBox] .dx-overlay-wrapper.dx-invalid-message.dx-invalid-message-always{width:100%!important}"]})}return T})()}}]);