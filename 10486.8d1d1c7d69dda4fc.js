"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[10486],{10486:(lt,g,e)=>{e.r(g),e.d(g,{InstantNotificationInfosModule:()=>ot});var r=e(96814),C=e(31610),u=e(88762),m=e(23758),p=e(35461),c=e(85054);const I=[{type:"buttons",fixed:!0,buttons:[{name:"edit",template:"grid-view-button"},{name:"delete",template:"grid-delete-button",disabled:i=>!i.row?.data?.isDeletable}]},{dataField:"id",visible:!1},{dataField:"concurrencyStamp",visible:!1},{dataField:"name",caption:"\u901a\u77e5\u540d\u7a31",dataType:"string",filterOperations:p.I$.text,validationRules:[c.L]},{name:"tenantName",caption:"\u79df\u6236\u540d\u7a31",dataType:"string",filterOperations:p.I$.text},{name:"notificationCategoryName",caption:"\u5206\u985e\u540d\u7a31",dataType:"string",filterOperations:p.I$.text},{name:"notificationProviders",caption:"\u901a\u77e5\u63d0\u4f9b\u8005\u540d\u7a31",dataType:"string",filterOperations:p.I$.text,calculateDisplayValue:i=>i.notificationProviders?.map(l=>l.displayName).join("\u3001"),width:160},{name:"receiverDescription",caption:"\u63a5\u6536\u8005\u63cf\u8ff0",dataType:"string",filterOperations:p.I$.text},{type:"detailExpand",fixed:!0,fixedPosition:"right"},{dataField:"notificationDataFetchEndpoint",caption:"\u53d6\u5f97\u901a\u77e5\u8cc7\u6599 Endpoint",dataType:"string",filterOperations:p.I$.text,visible:!1},{dataField:"hookEndpoint",caption:"Hook",dataType:"string",filterOperations:p.I$.text,visible:!1},{name:"isFullyFinished",caption:"\u662f\u5426\u5df2\u5b8c\u6210",dataType:"boolean",visible:!1},{name:"isDeletable",caption:"\u662f\u5426\u53ef\u522a\u9664",dataType:"boolean",visible:!1},{name:"isEditable",caption:"\u662f\u5426\u53ef\u7de8\u8f2f",dataType:"boolean",visible:!1},{dataField:"notificationProviderIds",caption:"\u901a\u77e5\u63d0\u4f9b\u8005id (\u53ef\u8907\u9078)",dataType:"object",visible:!1,editCellTemplate:"notificationProviderIds",validationRules:[c.L]},{dataField:"isSendToAllReceivers",caption:"\u63a5\u6536\u8005",dataType:"boolean",visible:!1,editCellTemplate:"isSendToAllReceivers"},{dataField:"receiverIds",caption:"\u63a5\u6536\u8005 (\u53ef\u8907\u9078)",dataType:"object",visible:!1,editCellTemplate:"receiverIds"},{dataField:"receiverGroupIds",caption:"\u63a5\u6536\u7fa4\u7d44 (\u53ef\u8907\u9078)",dataType:"object",visible:!1,editCellTemplate:"receiverGroupIds"},{dataField:"topicIds",caption:"\u4e3b\u984c (\u53ef\u8907\u9078)",dataType:"object",visible:!1,editCellTemplate:"topicIds"},{dataField:"isIndependentNotificationSettingUsing",caption:"\u901a\u77e5\u8a2d\u5b9a",dataType:"boolean",visible:!1,editCellTemplate:"isIndependentNotificationSettingUsing"},{dataField:"notificationSettings",caption:"\u901a\u77e5\u8a2d\u5b9a\u9805\u76ee",dataType:"object",visible:!1,editCellTemplate:"notificationSettings"},{dataField:"notificationCategoryId",caption:"\u901a\u77e5\u5206\u985e Id",dataType:"string",visible:!1,validationRules:[c.L]},{dataField:"title",caption:"\u6a19\u984c",dataType:"string",visible:!1,validationRules:[c.L]},{dataField:"subtitle",caption:"\u5b50\u6a19\u984c",dataType:"string",visible:!1},{dataField:"textContent",caption:"\u6587\u5b57\u5167\u5bb9",dataType:"string",visible:!1},{dataField:"htmlContent",caption:"Html \u5167\u5bb9",dataType:"string",visible:!1},{dataField:"isFetchNotificationDataByEachReceiver",caption:"\u662f\u5426\u4f9d\u5404\u901a\u77e5\u63a5\u6536\u8005\u53d6\u5f97\u8cc7\u6599",dataType:"string",visible:!1},{dataField:"filePaths",dataType:"string",visible:!1},{dataField:"hyperlink",dataType:"string",visible:!1},{dataField:"isUsingTemplate",caption:"\u6a21\u677f",dataType:"boolean",visible:!1,editCellTemplate:"isUsingTemplate"},{dataField:"textContentNotificationTemplateId",caption:"\u901a\u77e5\u6a21\u677f Id",dataType:"string",visible:!1},{name:"textContentNotificationTemplateName",caption:"\u901a\u77e5\u6a21\u677f\u540d\u7a31",dataType:"string",visible:!1},{dataField:"textContentNotificationTemplateArgs",caption:"\u901a\u77e5\u6a21\u677f\u53c3\u6578",dataType:"string",visible:!1,editCellTemplate:"textContentNotificationTemplateArgs"}],y={index:"/api/app/instant-notifications",get:"/api/app/instant-notifications",create:"/api/app/instant-notifications",update:"/api/app/instant-notifications",delete:"/api/app/instant-notifications"},F=[{dataField:"notificationProviderIds",path:"/api/app/instant-notifications/notification-provider-lookup"},{dataField:"receiverIds",path:"/api/app/instant-notifications/receiver-lookup"},{dataField:"topicIds",path:"/api/app/instant-notifications/topic-lookup"},{dataField:"receiverGroupIds",path:"/api/app/notification-infos/receiver-group-treeview"},{dataField:"notificationCategoryId",path:"/api/app/instant-notifications/notification-category-lookup"},{dataField:"textContentNotificationTemplateId",path:"/api/app/instant-notifications/notification-template-lookup"}],v=[{dataField:"id",mapping:["notificationInfo","id"]},{dataField:"concurrencyStamp",mapping:["notificationInfo","concurrencyStamp"]},{dataField:"type",mapping:["notificationInfo","type"]},{dataField:"name",queryStringKey:"Name",mapping:["notificationInfo","name"]},{name:"tenantName",queryStringKey:"TenantName",mapping:["tenant","name"]},{name:"notificationCategoryName",queryStringKey:"NotificationCategoryName",mapping:["notificationCategory","name"]},{name:"notificationProviders",queryStringKey:"NotificationProviderNames",mapping:["notificationProviders"]},{name:"receiverDescription",queryStringKey:"ReceiverDescription",mapping:["receiverDescription"]},{dataField:"notificationDataFetchEndpoint",queryStringKey:"NotificationDataFetchEndpoint",mapping:["notificationInfo","notificationDataFetchEndpoint"]},{dataField:"hookEndpoint",queryStringKey:"HookEndpoint",mapping:["notificationInfo","hookEndpoint"]},{name:"isFullyFinished",queryStringKey:"IsFullyFinished",mapping:["notificationInfo","isFullyFinished"]},{name:"isDeletable",queryStringKey:"IsDeletable",mapping:["isDeletable"]},{name:"isEditable",queryStringKey:"IsEditable",mapping:["isEditable"]},{dataField:"notificationProviderIds",mapping:["notificationProviderIds"]},{dataField:"isSendToAllReceivers",mapping:["notificationInfo","isSendToAllReceivers"]},{dataField:"receiverIds",mapping:["receiverIds"]},{dataField:"receiverGroupIds",mapping:["receiverGroupIds"]},{dataField:"topicIds",mapping:["topicIds"]},{dataField:"isIndependentNotificationSettingUsing",mapping:["notificationInfo","isIndependentNotificationSettingUsing"]},{dataField:"notificationSettings",mapping:["notificationSettings"]},{dataField:"notificationCategoryId",mapping:["notificationCategory","id"]},{dataField:"title",queryStringKey:"Title",mapping:["notificationInfo","title"]},{dataField:"subtitle",mapping:["notificationInfo","subtitle"]},{dataField:"textContent",mapping:["notificationInfo","textContent"]},{dataField:"htmlContent",mapping:["notificationInfo","htmlContent"]},{dataField:"isFetchNotificationDataByEachReceiver",mapping:["notificationInfo","isFetchNotificationDataByEachReceiver"]},{dataField:"filePaths",mapping:["notificationInfo","filePaths"]},{dataField:"hyperlink",mapping:["notificationInfo","hyperlink"]},{dataField:"textContentNotificationTemplateId",mapping:["textContentNotificationTemplate","id"]},{name:"textContentNotificationTemplateName",mapping:["textContentNotificationTemplate","name"]},{dataField:"textContentNotificationTemplateArgs",mapping:["notificationInfo","textContentNotificationTemplateArgs"]},{name:"notificationSchedulePlans",mapping:["notificationSchedulePlans"]},{dataField:"receivers",mapping:["receivers"]},{dataField:"receiverGroups",mapping:["receiverGroups"]},{dataField:"topics",mapping:["topics"]}],f=[{itemType:"group",name:"TopGroup",cssClass:"TopGroup",colCount:8,items:[{itemType:"group",name:"BasicGroup",cssClass:"BasicGroup",caption:"\u57fa\u672c",colSpan:5,items:[{dataField:"name",editorType:"dxTextBox",label:{text:"\u901a\u77e5\u540d\u7a31"}},{dataField:"notificationProviderIds",label:{visible:!1}},{dataField:"isSendToAllReceivers"},{itemType:"group",name:"custom-validation-group",cssClass:"custom-validation-group recurring-notification-custom-validation-group",items:[{itemType:"group",name:"custom-validation-group-inputs",cssClass:"custom-validation-group-inputs",items:[{dataField:"receiverIds",label:{visible:!1}},{dataField:"receiverGroupIds",label:{visible:!1}},{dataField:"topicIds",label:{visible:!1}}]},{name:"error",cssClass:"custom-validation-group-error-message",template:"error"}]}]},{itemType:"group",name:"SettingGroup",cssClass:"SettingGroup",caption:"\u8a2d\u5b9a",colSpan:3,items:[{dataField:"isIndependentNotificationSettingUsing"},{dataField:"notificationSettings",label:{visible:!1}}]}]},{itemType:"group",name:"NotificationContentGroup",cssClass:"NotificationContentGroup",caption:"\u901a\u77e5\u5167\u5bb9",colCount:2,items:[{dataField:"isUsingTemplate",cssClass:"isUsingTemplate",label:{visible:!1}},{itemType:"empty"},{dataField:"notificationCategoryId",editorType:"dxSelectBox"},{itemType:"empty"},{dataField:"title",editorType:"dxTextBox"},{dataField:"subtitle",editorType:"dxTextBox"},{itemType:"group",name:"CustomContentGroup",cssClass:"CustomContentGroup",colSpan:2,colCount:8,items:[{dataField:"textContent",editorType:"dxTextArea",editorOptions:{height:"240px"},colSpan:3},{dataField:"htmlContent",editorType:"dxHtmlEditor",editorOptions:{...e(35130).W,height:"240px"},colSpan:5}]},{itemType:"group",name:"NotificationTemplateGroup",cssClass:"NotificationTemplateGroup NotificationTemplateGroup--inactive",colSpan:2,colCount:2,items:[{dataField:"textContentNotificationTemplateId",editorType:"dxSelectBox",cssClass:"textContentNotificationTemplateId"},{itemType:"empty"},{dataField:"textContentNotificationTemplateArgs",label:{visible:!1},colSpan:2}]},{itemType:"group",name:"EndpointGroup",cssClass:"EndpointGroup",colSpan:2,colCount:3,items:[{dataField:"notificationDataFetchEndpoint",editorType:"dxTextBox"},{dataField:"hookEndpoint",editorType:"dxTextBox"},{dataField:"isFetchNotificationDataByEachReceiver",editorType:"dxCheckBox",cssClass:"basic-form-checkbox"}]}]}],b={popup:{title:"",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}]},form:{colCount:1,items:f,elementAttr:{class:"custom-form custom-form--edit custom-form--edit-notification"}}},N={popup:{title:"JbNotifier::Permission:Notifications",wrapperAttr:{class:"basic-popup"},showCloseButton:!0,toolbarItems:[{toolbar:"bottom",template:"bottom-toolbar"}]},form:{colCount:1,items:f,elementAttr:{class:"custom-form custom-form--edit custom-form--edit-notification custom-form--edit-readonly"}}};var t=e(19212),S=e(67),D=e(72783),_=e(82310),E=e(59444),P=e(16358),A=e(20843),G=e(25012),R=e(67846),O=e(13443),B=e(65343),K=e(27310),k=e(60237),T=e(34906),Q=e(21194);const M=["grid"],J=()=>({class:"custom-button"});function U(i,l){if(1&i){const n=t.EpF();t.TgZ(0,"dx-button",10),t.NdJ("onClick",function(){t.CHM(n),t.oxw();const a=t.MAs(10);return t.KtG(a.instance.cancelEditData())}),t.qZA()}2&i&&t.Q6J("elementAttr",t.DdM(1,J))}function $(i,l){1&i&&t.GkF(0)}const x=i=>({$implicit:i});function w(i,l){if(1&i&&(t.ynx(0),t.YNc(1,$,1,0,"ng-container",9),t.BQk()),2&i){const n=l.$implicit,o=t.oxw().$implicit,a=t.oxw();t.xp6(),t.Q6J("ngTemplateOutlet",a.templateStore.getGridTemplates(o.key))("ngTemplateOutletContext",t.VKq(2,x,n))}}function Z(i,l){if(1&i&&(t.ynx(0),t.YNc(1,w,2,4,"ng-container",11),t.BQk()),2&i){const n=l.$implicit;t.xp6(),t.Q6J("dxTemplateOf",n.key)}}function L(i,l){1&i&&t.GkF(0)}const Y=(i,l,n)=>({$implicit:i,templateKey:l,notificationTemplateId:n});function j(i,l){if(1&i&&t.YNc(0,L,1,0,"ng-container",9),2&i){const n=t.oxw().$implicit,o=t.oxw().$implicit,a=t.oxw();t.Q6J("ngTemplateOutlet",a.notificationTemplateStore.getTemplates(o.key))("ngTemplateOutletContext",t.kEZ(2,Y,n,o.key,a.notificationTemplateId))}}function V(i,l){1&i&&t.GkF(0)}const H=(i,l)=>({$implicit:i,templateKey:l});function z(i,l){if(1&i&&t.YNc(0,V,1,0,"ng-container",9),2&i){const n=t.oxw().$implicit,o=t.oxw().$implicit,a=t.oxw();t.Q6J("ngTemplateOutlet",a.notificationTemplateStore.getTemplates(o.key))("ngTemplateOutletContext",t.WLB(2,H,n,o.key))}}function W(i,l){if(1&i&&(t.ynx(0),t.YNc(1,j,1,6,"ng-container")(2,z,1,5),t.BQk()),2&i){const n=t.oxw().$implicit;t.xp6(),t.um2(1,"textContentNotificationTemplateArgs"===n.key?1:2)}}function X(i,l){if(1&i&&(t.ynx(0),t.YNc(1,W,3,1,"ng-container",11),t.BQk()),2&i){const n=l.$implicit;t.xp6(),t.Q6J("dxTemplateOf",n.key)}}function q(i,l){1&i&&t.GkF(0)}const tt=[{path:"",component:(()=>{class i{constructor(n,o,a,s,d){this.gridDataSourceService=n,this.templateStore=o,this.notificationTemplateStore=a,this.router=s,this.tenantChooser=d,this.columns=I,this.cRUDEndpoints=y,this.dataFieldLookupSourceMapping=F,this.relatedDataValueAndQueryStringKeyMapping=v,this.editingPropertiesForCreating=b,this.editingPropertiesForUpdating=N,this.gridProperties={masterDetail:{enabled:!0,template:"basic-master-detail-row-template"},height:"85%"},this.tenantChooser.tenantId$.subscribe(dt=>{this.grid?.instance?.refresh()})}ngOnInit(){this.gridDataSource=this.gridDataSourceService.getDataSource(y,v)}onRowExpanded(n){this.applyNotificationMasterDetailRowCollapse(n)}applyNotificationMasterDetailRowCollapse(n){setTimeout(()=>{const a=n.element.querySelector('[aria-label="Collapse"]').parentElement.ariaRowIndex;n.element.querySelector(`tr.dx-row.dx-data-row.dx-row-lines[aria-rowindex="${a}"]`).classList.add("master-detail-row-collapse")}),n.key!==this.masterDetailRowCollapseKey&&(n.component.collapseRow(this.masterDetailRowCollapseKey),this.masterDetailRowCollapseKey=n.key)}static#t=this.\u0275fac=function(o){return new(o||i)(t.Y36(S.I),t.Y36(D.z),t.Y36(_.P),t.Y36(m.F0),t.Y36(E.L))};static#i=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-instant-notification"]],viewQuery:function(o,a){if(1&o&&t.Gf(M,5),2&o){let s;t.iGM(s=t.CRH())&&(a.grid=s.first)}},decls:17,vars:22,consts:[[1,"custom-grid-container"],[1,"grid-tool-bar"],[3,"grid"],[1,"d-flex","justify-content-between"],["appGridAddButton","",3,"onClick"],["appGridFeature","","appGridFeatureNotification","",3,"datafieldValueQueryStringKeyMapping","dataFieldLookUpSourceMapping","editingPropertiesForCreating","editingPropertiesForUpdating","columns","dataSource","isEditingDataAsync","gridProperties","notificationTemplateId","notificationTemplateIdChange","onRowExpanded"],["grid",""],["appCustomButton","","text","\u95dc\u9589",3,"elementAttr","onClick",4,"dxTemplate","dxTemplateOf"],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["appCustomButton","","text","\u95dc\u9589",3,"elementAttr","onClick"],[4,"dxTemplate","dxTemplateOf"]],template:function(o,a){if(1&o&&(t.TgZ(0,"div",0),t._UZ(1,"app-tenant-chooser"),t.TgZ(2,"div",1)(3,"div"),t._UZ(4,"app-grid-filter-items",2),t.qZA(),t.TgZ(5,"div",3)(6,"div")(7,"dx-button",4),t.NdJ("onClick",function(){return a.router.navigate(["./instant-notification-infos/create-notification-info"])}),t.qZA()(),t._UZ(8,"app-grid-after-tool-bar",2),t.qZA()(),t.TgZ(9,"dx-data-grid",5,6),t.NdJ("notificationTemplateIdChange",function(d){return a.notificationTemplateId=d})("onRowExpanded",function(d){return a.onRowExpanded(d)}),t.YNc(11,U,1,2,"dx-button",7)(12,Z,2,1,"ng-container",8),t.ALo(13,"keyvalue"),t.YNc(14,X,2,1,"ng-container",8),t.ALo(15,"keyvalue"),t.qZA(),t.YNc(16,q,1,0,"ng-container",9),t.qZA()),2&o){const s=t.MAs(10);t.xp6(4),t.Q6J("grid",s),t.xp6(4),t.Q6J("grid",s),t.xp6(),t.Q6J("datafieldValueQueryStringKeyMapping",a.relatedDataValueAndQueryStringKeyMapping)("dataFieldLookUpSourceMapping",a.dataFieldLookupSourceMapping)("editingPropertiesForCreating",a.editingPropertiesForCreating)("editingPropertiesForUpdating",a.editingPropertiesForUpdating)("columns",a.columns)("dataSource",a.gridDataSource)("isEditingDataAsync",!0)("gridProperties",a.gridProperties)("notificationTemplateId",a.notificationTemplateId),t.xp6(2),t.Q6J("dxTemplateOf","bottom-toolbar"),t.xp6(),t.Q6J("ngForOf",t.lcZ(13,16,a.templateStore.gridTemplates)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(15,18,a.notificationTemplateStore.templates)),t.xp6(2),t.Q6J("ngTemplateOutlet",a.notificationTemplateStore.getTemplates("notificationPager"))("ngTemplateOutletContext",t.VKq(20,x,s))}},dependencies:[r.sg,r.tP,P.K,A.p6,G.e,R.S,O._,B.f,K.A,k.V,T.W,Q.D,r.Nd],styles:[".grid-tool-bar[_ngcontent-%COMP%]{padding:0 8px}  .custom-validation-group app-notification-tree-view .dx-overlay-content.dx-invalid-message-content{display:none}  .custom-validation-group app-notification-tree-view .dx-invalid.dx-texteditor.dx-show-invalid-badge .dx-texteditor-input-container:after{display:none}  .custom-validation-group app-notification-tag-box .dx-overlay-content.dx-invalid-message-content{display:none}  .custom-validation-group app-notification-tag-box .dx-invalid.dx-texteditor.dx-show-invalid-badge .dx-texteditor-input-container:after{display:none}  .custom-validation-group{border-radius:8px}  .custom-validation-group.error{border:1px solid red;padding:8px!important}  .custom-validation-group-error-message{border-top:1px solid red!important;display:none;color:red}  .custom-validation-group.error .custom-validation-group-error-message{padding-top:8px!important;display:block}"]})}return i})(),canActivate:[u.a1M,u.nG9]},{path:"create-notification-info",loadChildren:()=>Promise.all([e.e(68592),e.e(78488)]).then(e.bind(e,78488)).then(i=>i.CreateNotificationInfoModule)}];let it=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#i=this.\u0275mod=t.oAB({type:i});static#e=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(tt),m.Bz]})}return i})();var et=e(5533),nt=e(68862),at=e(41992);let ot=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#i=this.\u0275mod=t.oAB({type:i});static#e=this.\u0275inj=t.cJS({imports:[r.ez,it,et.P,nt.O,C.m,T.W,at.e]})}return i})()}}]);